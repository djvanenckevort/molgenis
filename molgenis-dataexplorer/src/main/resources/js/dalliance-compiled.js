(function e$$0(y,r,m){function e(k,p){if(!r[k]){if(!y[k]){var z="function"==typeof require&&require;if(!p&&z)return z(k,!0);if(s)return s(k,!0);throw Error("Cannot find module '"+k+"'");}z=r[k]={exports:{}};y[k][0].call(z.exports,function(d){var c=y[k][1][d];return e(c?c:d)},z,z.exports,e$$0,y,r,m)}return r[k].exports}for(var s="function"==typeof require&&require,k=0;k<m.length;k++)e(m[k]);return e})({1:[function(h,y,r){function m(){}function e(b,n,t){var w=new m;w.data=b;w.bai=n;w.bai.fetch(function(b){if(!b)return t(null,
    "Couldn't access BAI");var n=new Uint8Array(b),p=k(n,0);if(p!=u)return t(null,"Not a BAI file, magic=0x"+p.toString(16));p=k(n,4);w.indices=[];for(var e=8,F=1E9,f=0;f<p;++f){for(var q=e,l=k(n,e),e=e+4,g=0;g<l;++g){k(n,e);var v=k(n,e+4),e=e+(8+16*v)}for(var g=k(n,e),I=e+=4,C=0;C<g;++C)if(v=d(n,I),I+=8,v){I=v.block;0<v.offset&&(I+=65536);I<F&&(F=I);break}e+=8*g;0<l&&(w.indices[f]=new Uint8Array(b,q,e-q))}w.data.slice(0,F).fetch(function(g){if(!g)return t(null,"Couldn't access BAM");g=c(g,g.byteLength);
    g=new Uint8Array(g);var l=k(g,0);if(l!=a)return t(null,"Not a BAM file, magic=0x"+l.toString(16));for(var f=k(g,4),v="",l=0;l<f;++l)v+=String.fromCharCode(g[l+8]);v=k(g,f+8);f+=12;w.chrToIndex={};w.indexToChr=[];for(l=0;l<v;++l){for(var q=k(g,f),b="",C=0;C<q-1;++C)b+=String.fromCharCode(g[f+4+C]);k(g,f+q+4);w.chrToIndex[b]=l;0==b.indexOf("chr")?w.chrToIndex[b.substring(3)]=l:w.chrToIndex["chr"+b]=l;w.indexToChr.push(b);f=f+8+q}if(w.indices)return t(w)})})}function s(){}if("undefined"!==typeof h){h("./spans");
    r=h("./bin");var k=r.readInt,x=r.readShort,p=r.readByte,z=r.readFloat;h=h("./lh3utils");var d=h.readVob,c=h.unbgzf,b=h.reg2bins,n=h.Chunk}var a=21840194,u=21578050;h={MULTIPLE_SEGMENTS:1,ALL_SEGMENTS_ALIGN:2,SEGMENT_UNMAPPED:4,NEXT_SEGMENT_UNMAPPED:8,REVERSE_COMPLEMENT:16,NEXT_REVERSE_COMPLEMENT:32,FIRST_SEGMENT:64,LAST_SEGMENT:128,SECONDARY_ALIGNMENT:256,QC_FAIL:512,DUPLICATE:1024,SUPPLEMENTARY:2048};m.prototype.blocksForRange=function(a,c,t){var u=this.indices[a];if(!u)return[];a=b(c,t);for(var w=
    [],p=0;p<a.length;++p)w[a[p]]=!0;a=[];for(var e=[],p=k(u,0),h=4,E=0;E<p;++E){var f=k(u,h),q=k(u,h+4),h=h+8;if(w[f])for(var l=0;l<q;++l){var g=d(u,h),v=d(u,h+8);(4681>f?e:a).push(new n(g,v));h+=16}else h+=16*q}p=k(u,h);w=null;c=Math.min(c>>14,p-1);t=Math.min(t>>14,p-1);for(p=c;p<=t;++p)(c=d(u,h+4+8*p))&&(!w||c.block<w.block||c.offset<w.offset)&&(w=c);u=[];if(null!=w)for(p=0;p<e.length;++p)t=e[p],t.maxv.block>=w.block&&t.maxv.offset>=w.offset&&u.push(t);e=u;u=[];for(p=0;p<e.length;++p)u.push(e[p]);
    for(p=0;p<a.length;++p)u.push(a[p]);u.sort(function(g,l){var f=g.minv.block-l.minv.block;return 0!=f?f:g.minv.offset-l.minv.offset});a=[];if(0<u.length){e=u[0];for(p=1;p<u.length;++p)t=u[p],t.minv.block==e.maxv.block?e=new n(e.minv,t.maxv):(a.push(e),e=t);a.push(e)}return a};m.prototype.fetch=function(a,b,n,t,d){function u(){if(q>=e.length)return t(f);if(l){var g=new Uint8Array(l);w.readBamRecords(g,e[q].minv.offset,f,b,n,p,d);l=null;++q;return u()}var v=e[q],g=v.minv.block;w.data.slice(g,v.maxv.block+
    65536-g).fetch(function(g){l=c(g,v.maxv.block-v.minv.block+1);return u()})}var w=this;d=d||{};var p=this.chrToIndex[a],e;void 0===p?e=[]:(e=this.blocksForRange(p,b,n))||t(null,"Error in index fetch");var f=[],q=0,l;u()};var t="=ACxGxxxTxxxxxxN".split(""),w="MIDNSHP=X???????".split("");m.prototype.readBamRecords=function(b,a,c,n,d,u,e){for(;;){var h=k(b,a),h=a+h+4;if(h>=b.length)return c;var E=new s,f=k(b,a+4),q=k(b,a+8),l=k(b,a+12),g=(l&65280)>>8,v=l&255,l=k(b,a+16),I=(l&4294901760)>>16,C=l&65535,
    l=k(b,a+20),J=k(b,a+24),m=k(b,a+28);k(b,a+32);E.segment=this.indexToChr[f];E.flag=I;E.pos=q;E.mq=g;e.light&&(E.seqLength=l);if(!e.light){0<=J&&(E.nextSegment=this.indexToChr[J],E.nextPos=m);g="";for(q=0;q<v-1;++q)g+=String.fromCharCode(b[a+36+q]);E.readName=g;a=a+36+v;v="";for(q=0;q<C;++q)g=k(b,a),v=v+(g>>4)+w[g&15],a+=4;E.cigar=v;C="";v=l+1>>1;for(q=0;q<v;++q)g=b[a+q],C+=t[(g&240)>>4],C+=t[g&15];a+=v;E.seq=C;C="";for(q=0;q<l;++q)C+=String.fromCharCode(b[a+q]+33);a+=l;for(E.quals=C;a<h;){C=String.fromCharCode(b[a],
    b[a+1]);v=String.fromCharCode(b[a+2]);if("A"==v)v=String.fromCharCode(b[a+3]),a+=4;else if("i"==v||"I"==v)v=k(b,a+3),a+=7;else if("c"==v||"C"==v)v=b[a+3],a+=4;else if("s"==v||"S"==v)v=x(b,a+3),a+=5;else if("f"==v)v=z(b,a+3),a+=7;else if("Z"==v||"H"==v)for(a+=3,v="";q=b[a++],0!=q;)v+=String.fromCharCode(q);else if("B"==v){v=String.fromCharCode(b[a+3]);q=k(b,a+4);if("i"==v||"I"==v||"f"==v)g=4,I="f"==v?z:k;else if("s"==v||"S"==v)g=2,I=x;else if("c"==v||"C"==v)g=1,I=p;else throw"Unknown array type "+
    v;a+=8;v=[];for(J=0;J<q;++J)v.push(I(b,a)),a+=g}else throw"Unknown type "+v;E[C]=v}}if(!n||E.pos<=d&&E.pos+l>=n)void 0!==u&&f!=u||c.push(E);a=h}};"undefined"!==typeof y&&(y.exports={makeBam:e,BAM_MAGIC:a,BAI_MAGIC:u,BamFlags:h})},{"./bin":4,"./lh3utils":22,"./spans":33}],2:[function(h,y,r){function m(b){this.type=b}function e(b,c){this.parser=b;this.sink=c}function s(b,c){this.parser=b;this.sink=c;this.wigState=null}if("undefined"!==typeof h){var k=h("./sourceadapters").registerParserFactory;h=h("./das");
    var x=h.DASStylesheet,p=h.DASStyle,z=h.DASGroup}m.prototype.createSession=function(b){return"wig"==this.type?new s(this,b):new e(this,b)};var d=/([^=]+)=(.+)/,c=/\s/;e.prototype.parse=function(b){var n=b.split(c);if(!(3>n.length)){var a=parseInt(n[1])+1;b=parseInt(n[2]);b={segment:n[0],min:a,max:b};3<n.length&&"."!==n[3]&&(b.label=n[3]);4<n.length&&(b.score=parseFloat(n[4]));5<n.length&&(b.orientation=n[5]);if(8<n.length){var d=n[8];BED_COLOR_REGEXP.test(d)&&(b.itemRgb="rgb("+d+")")}if(12<=n.length){var d=
    parseInt(n[6]),t=parseInt(n[7]),w=parseInt(n[9]),p=n[10].split(",").map(function(a){return parseInt(a)}),e=n[11].split(",").map(function(a){return parseInt(a)});b.type="transcript";var k=new z;k.id=n[3];k.type="transcript";k.notes=[];b.groups=[k];if(12<n.length){var h=k=n[12];13<n.length&&(h=n[13]);n=new z;n.id=k;n.label=h;n.type="gene";b.groups.push(n)}n=null;for(k=0;k<w;++k)h=e[k]+a,h=new Range(h,h+p[k]),n=n?union(n,h):h;e=n.ranges();for(a=0;a<e.length;++a)w=e[a],p=shallowCopy(b),p.min=w.min(),
    p.max=w.max(),this.sink(p);if(t>d&&(d=intersection(n,new Range(d,t))))for(b.type="translation",d=d.ranges(),a=0;a<d.length;++a)w=d[a],p=shallowCopy(b),p.min=w.min(),p.max=w.max(),this.sink(p)}else this.sink(b)}};e.prototype.flush=function(){};s.prototype.parse=function(b){b=b.split(c);if("fixedStep"==b[0]){this.wigState="fixedStep";this.chr=this.pos=this.step=null;for(var n=this.span=1;n<b.length;++n){var a=d.exec(b[n]);a&&("chrom"==a[1]?this.chr=a[2]:"start"==a[1]?this.pos=parseInt(a[2]):"step"==
    a[1]?this.step=parseInt(a[2]):"span"==a[1]&&(this.span=parseInt(a[2])))}}else if("variableStep"==b[0])for(this.wigState="variableStep",this.chr=null,n=this.span=1;n<b.length;++n)a=d.exec(b[n]),"chrom"==a[1]?this.chr=a[2]:"span"==a[1]&&(this.span=parseInt(a[2]));else this.wigState?"fixedStep"==this.wigState?1==b.length&&(b=parseFloat(b[0]),b={segment:this.chr,min:this.pos,max:this.pos+this.span-1,score:b},this.pos+=this.step,this.sink(b)):"variableStep"==this.wigState&&2==b.length&&(n=parseInt(b[0]),
    b=parseFloat(b[1]),b={segment:this.chr,min:n,max:n+this.span-1,score:b},this.sink(b)):4>b.length||(b={segment:b[0],min:parseInt(b[1])+1,max:parseInt(b[2]),score:parseFloat(b[3])},this.sink(b))};s.prototype.flush=function(){};m.prototype.getStyleSheet=function(b){var c=new x;if("wig"==this.type){var a=new p;a.glyph="HISTOGRAM";a.BGCOLOR="blue";a.HEIGHT=30;c.pushStyle({type:"default"},null,a)}else a=new p,a.glyph="BOX",a.FGCOLOR="black",a.BGCOLOR="blue",a.HEIGHT=8,a.BUMP=!0,a.LABEL=!0,a.ZINDEX=20,c.pushStyle({type:"default"},
    null,a),a=new p,a.glyph="BOX",a.FGCOLOR="black",a.BGCOLOR="red",a.HEIGHT=10,a.BUMP=!0,a.ZINDEX=20,c.pushStyle({type:"translation"},null,a),a=new p,a.glyph="BOX",a.FGCOLOR="black",a.BGCOLOR="white",a.HEIGHT=10,a.ZINDEX=10,a.BUMP=!0,a.LABEL=!0,c.pushStyle({type:"transcript"},null,a),a=new p,a.glyph="HISTOGRAM",a.COLOR1="white",a.COLOR2="black",a.HEIGHT=30,c.pushStyle({type:"density"},null,a);return b(c)};k("bed",function(b){return new m(b)});k("wig",function(b){return new m(b)})},{"./das":10,"./sourceadapters":32}],
    3:[function(h,y,r){function m(a,f){return a[f]+a[f+1]*G+a[f+2]*A+a[f+3]*P+a[f+4]*D}function e(){}function s(a,f,q,l){this.bwg=a;this.cirTreeOffset=f;this.cirTreeLength=q;this.isSummary=l}function k(a,f,q){var l=new e;l.data=a;l.name=q;l.data.slice(0,512).salted().fetch(function(g){if(!g)return f(null,"Couldn't fetch file");var v=new Uint8Array(g),q=new Int16Array(g);g=new Int32Array(g);var a=v[0]+G*v[1]+A*v[2]+P*v[3];a==w?l.type="bigwig":a==B?l.type="bigbed":a==F||a==Q?f(null,"Currently don't support big-endian BBI files"):
        f(null,"Not a supported format, magic=0x"+a.toString(16));l.version=q[2];l.numZoomLevels=q[3];l.chromTreeOffset=m(v,8);l.unzoomedDataOffset=m(v,16);l.unzoomedIndexOffset=m(v,24);l.fieldCount=q[16];l.definedFieldCount=q[17];l.asOffset=m(v,36);l.totalSummaryOffset=m(v,44);l.uncompressBufSize=g[13];l.extHeaderOffset=m(v,56);l.zoomLevels=[];for(q=0;q<l.numZoomLevels;++q){var a=g[6*q+16],b=m(v,24*q+72),c=m(v,24*q+80);l.zoomLevels.push({reduction:a,dataOffset:b,indexOffset:c})}l.readChromTree(function(){l.getAutoSQL(function(g){l.schema=
        g;return f(l)})})})}function x(a,f,q,l,g){this.bbi=a;this.type=f;this.fieldCount=q;this.offset=l;this.field=g}if("undefined"!==typeof h){r=h("./spans");var p=r.Range,z=r.union,d=r.intersection;r=h("./das");var c=r.DASFeature,b=r.DASGroup,n=h("./utils").shallowCopy,a=h("./bin").readInt;h=h("jszlib");var u=h.inflateBuffer,t=h.arrayCopy}var w=2291137574,F=654086024,B=2273964779,Q=3958540679,G=256,A=65536,P=16777216,D=4294967296,O=/^[0-9]+,[0-9]+,[0-9]+/;e.prototype.readChromTree=function(a){var f=this;
        this.chromsToIDs={};this.idsToChroms={};this.maxID=0;var q=this.unzoomedDataOffset,q=q+4-(q-this.chromTreeOffset&3);this.data.slice(this.chromTreeOffset,q-this.chromTreeOffset).fetch(function(l){var g=new Uint8Array(l),v=new Int16Array(l),q=(new Int32Array(l))[2];m(g,16);var b=function(l){var a=g[l],c=v[l/2+1];l+=4;for(var n=0;n<c;++n)if(0==a){l+=q;var t=m(g,l);l+=8;t-=f.chromTreeOffset;b(t)}else{for(var t="",d=0;d<q;++d){var u=g[l++];0!=u&&(t+=String.fromCharCode(u))}d=g[l+3]<<24|g[l+2]<<16|g[l+
            1]<<8|g[l+0];l+=8;f.chromsToIDs[t]=d;0==t.indexOf("chr")&&(f.chromsToIDs[t.substr(3)]=d);f.idsToChroms[d]=t;f.maxID=Math.max(f.maxID,d)}};b(32);a(f)})};s.prototype.readWigData=function(a,f,q,l){a=this.bwg.chromsToIDs[a];if(void 0===a)return l([]);this.readWigDataById(a,f,q,l)};s.prototype.readWigDataById=function(a,f,q,l){var g=this;if(this.cirHeader){var v=[],b=0;Date.now();var c=function(g,l,v,b){return(0>a||g==a)&&l<=q&&v>=f},t=function(f,a){g.bwg.instrument&&console.log("level="+a+"; offset="+
        f+"; time="+(Date.now()|0));b+=f.length;if(1==f.length&&48==f[0]-g.cirTreeOffset&&g.cachedCirRoot)d(g.cachedCirRoot,0,a),--b,0==b&&g.fetchFeatures(c,v,l);else{for(var q=4+32*g.cirBlockSize,t,J=0;J<f.length;++J){var u=new p(f[J],f[J]+q);t=t?z(t,u):u}q=t.ranges();for(t=0;t<q.length;++t)n(f,q[t],a)}},n=function(f,a,q,t){a.max();a.min();g.bwg.data.slice(a.min(),a.max()-a.min()).fetch(function(t){for(var n=0;n<f.length;++n)a.contains(f[n])&&(d(t,f[n]-a.min(),q),48==f[n]-g.cirTreeOffset&&0==f[n]-a.min()&&
        (g.cachedCirRoot=t),--b,0==b&&g.fetchFeatures(c,v,l))})},d=function(g,l,b){var c=new Uint8Array(g),C=new Int16Array(g);g=new Int32Array(g);var n=c[l],C=C[l/2+1];l+=4;if(0!=n)for(n=0;n<C;++n){var d=l/4,I=g[d],H=g[d+1],u=g[d+2],d=g[d+3],p=m(c,l+16);b=m(c,l+24);(0>a||I<a||I==a&&H<=q)&&(0>a||u>a||u==a&&d>=f)&&v.push({offset:p,size:b});l+=32}else{for(var w=[],n=0;n<C;++n)d=l/4,I=g[d],H=g[d+1],u=g[d+2],d=g[d+3],p=m(c,l+16),(0>a||I<a||I==a&&H<=q)&&(0>a||u>a||u==a&&d>=f)&&w.push(p),l+=24;0<w.length&&t(w,
            b+1)}};t([g.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(v){g.cirHeader=v;v=new Int32Array(g.cirHeader);g.cirBlockSize=v[1];g.readWigDataById(a,f,q,l)})};s.prototype.fetchFeatures=function(a,f,q){var l=this;f.sort(function(g,l){return(g.offset|0)-(l.offset|0)});if(0==f.length)q([]);else{var g=[],v=function(f,v,a,q){q||(q={});var b=new c;b._chromId=f;b.segment=l.bwg.idsToChroms[f];b.min=v;b.max=a;b.type="bigwig";for(var t in q)b[t]=q[t];g.push(b)},b=function(){if(0==
        f.length)Date.now(),q(g);else{var c=f[0];if(c.data)l.parseFeatures(c.data,v,a),f.splice(0,1),b();else{for(var n=c.offset,d=c.size,c=1;c<f.length&&f[c].offset==n+d;)d+=f[c].size,++c;l.bwg.data.slice(n,d).fetch(function(g){for(var v=0,a=0;v<d;){var q=f[a],c;0<l.bwg.uncompressBufSize?c=u(g,v+2,q.size-2):(c=new Uint8Array(q.size),t(new Uint8Array(g,v,q.size),0,c,0,q.size),c=c.buffer);q.data=c;v+=q.size;++a}b()})}}};b()}};s.prototype.parseFeatures=function(a,f,q){var l=new Uint8Array(a);if(this.isSummary)for(var g=
        new Int16Array(a),v=new Int32Array(a),c=new Float32Array(a),l=a.byteLength/32,g=0;g<l;++g){a=v[8*g];var t=v[8*g+1],u=v[8*g+2],w=v[8*g+3],H=c[8*g+5],e=c[8*g+6];q(a,t+1,u)&&(w={type:"bigwig",score:e/w,maxScore:H},"bigbed"==this.bwg.type&&(w.type="density"),f(a,t+1,u,w))}else if("bigwig"==this.bwg.type)if(g=new Int16Array(a),v=new Int32Array(a),c=new Float32Array(a),a=v[0],t=v[1],H=v[3],w=v[4],u=l[20],l=g[11],3==u)for(g=0;g<l;++g)e=c[g+6],v=t+g*H+1,u=t+g*H+w,q(a,v,u)&&f(a,v,u,{score:e});else if(2==u)for(g=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0;g<l;++g)t=v[2*g+6]+1,u=t+w-1,e=c[2*g+7],q(a,t,u)&&f(a,t,u,{score:e});else if(1==u)for(g=0;g<l;++g)t=v[3*g+6]+1,u=v[3*g+7],e=c[3*g+8],t>u&&(t=u),q(a,t,u)&&f(a,t,u,{score:e});else console.log("Currently not handling bwgType="+u);else if("bigbed"==this.bwg.type)for(v=0,g=this.bwg.definedFieldCount,w=this.bwg.schema;v<l.length;){a=l[v+3]<<24|l[v+2]<<16|l[v+1]<<8|l[v+0];t=l[v+7]<<24|l[v+6]<<16|l[v+5]<<8|l[v+4];u=l[v+11]<<24|l[v+10]<<16|l[v+9]<<8|l[v+8];v+=12;for(e="";;)if(H=l[v++],0!=H)e+=String.fromCharCode(H);
    else break;var H={},k;k=0<e.length?e.split("\t"):[];0<k.length&&3<g&&(H.label=k[0]);1<k.length&&4<g&&(e=parseInt(k[1]),isNaN(e)||(H.score=e));2<k.length&&5<g&&(H.orientation=k[2]);5<k.length&&8<g&&(e=k[5],O.test(e)&&(H.itemRgb="rgb("+e+")"));if(k.length>g-3&&w)for(e=g-3;e<k.length;++e)H[w.fields[e+3].name]=k[e];if(q(a,t+1,u,k))if(12>g)f(a,t+1,u,H);else{var e=k[3]|0,h=k[4]|0,D=k[6]|0,m=k[7].split(","),F=k[8].split(",");H.type="transcript";var A=new b;for(c in H)A[c]=H[c];A.id=k[0];A.segment=this.bwg.idsToChroms[a];
        A.min=t+1;A.max=u;A.notes=[];H.groups=[A];if(9<k.length){var B=u=k[9];10<k.length&&(B=k[10]);k=n(A);k.id=u;k.label=B;k.type="gene";H.groups.push(k)}u=[];for(k=0;k<D;++k)A=(F[k]|0)+t,A=new p(A,A+(m[k]|0)),u.push(A);D=z(u);m=D.ranges();for(t=0;t<m.length;++t)u=m[t],f(a,u.min()+1,u.max(),H);if(h>e&&(t=d(D,new p(e,h))))for(H.type="translation",e=t.ranges(),t=0;t<e.length;++t)u=e[t],f(a,u.min()+1,u.max(),H)}}else throw Error("Don't know what to do with "+this.bwg.type);};s.prototype.getFirstAdjacent=function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     f,q,l){a=this.bwg.chromsToIDs[a];if(void 0===a)return l([]);this.getFirstAdjacentById(a,f,q,l)};s.prototype.getFirstAdjacentById=function(a,f,q,l){var g=this;if(this.cirHeader){var v=null,b=-1,c=-1,t=0;Date.now();var n=function(l,f){t+=l.length;for(var v=4+32*g.cirBlockSize,a,q=0;q<l.length;++q){var b=new p(l[q],l[q]+v);a=a?z(a,b):b}v=a.ranges();for(a=0;a<v.length;++a)d(l,v[a],f)},d=function(b,c,n,d){c.max();c.min();g.bwg.data.slice(c.min(),c.max()-c.min()).fetch(function(d){for(var C=0;C<b.length;++C)if(c.contains(b[C])&&
        (u(d,b[C]-c.min(),n),--t,0==t)){if(!v)return 0<q&&(0!=a||0<f)?g.getFirstAdjacentById(0,0,q,l):0>q&&(a!=g.bwg.maxID||1E9>f)?g.getFirstAdjacentById(g.bwg.maxID,1E9,q,l):l([]);g.fetchFeatures(function(g,l,v,b){return 0>q&&(g<a||v<f)||0<q&&(g>a||l>f)},[v],function(g){for(var f=null,v=-1,a=-1,b=0;b<g.length;++b){var c=g[b],t=c._chromId,n=c.min,d=c.max;if(null==f||0>q&&(t>v||d>a)||0<q&&(t<v||n<a))f=c,a=0>q?d:n,v=t}return null!=f?l([f]):l([])})}})},u=function(l,t,d){var u=new Uint8Array(l),H=new Int16Array(l);
        l=new Int32Array(l);var w=u[t],H=H[t/2+1];t+=4;if(0!=w)for(w=0;w<H;++w){var p=t/4,e=l[p],k=l[p+1],J=l[p+2],h=l[p+3],p=m(u,t+16);d=m(u,t+24);(0>q&&(e<a||e==a&&k<=f)||0<q&&(J>a||J==a&&h>=f))&&!/_random/.exec(g.bwg.idsToChroms[e])&&(null==v||0>q&&(J>b||J==b&&h>c)||0<q&&(e<b||e==b&&k<c))&&(v={offset:p,size:d},c=0>q?h:k,b=0>q?J:e);t+=32}else{for(var D=u=-1,w=0;w<H;++w){p=t/4;e=l[p];k=l[p+1];J=l[p+2];h=l[p+3];p=l[p+4]<<32|l[p+5];if(0>q&&(e<a||e==a&&k<=f)&&J>=a||0<q&&(J>a||J==a&&h>=f)&&e<=a)if(0>u||h>D)u=
            p,D=0>q?h:k;t+=24}0<=u&&n([u],d+1)}};n([g.cirTreeOffset+48],1)}else this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(v){g.cirHeader=v;v=new Int32Array(g.cirHeader);g.cirBlockSize=v[1];g.getFirstAdjacentById(a,f,q,l)})};e.prototype.readWigData=function(a,f,q,l){this.getUnzoomedView().readWigData(a,f,q,l)};e.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var a=4E3;this.zoomLevels[0]&&(a=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset);this.unzoomedView=new s(this,this.unzoomedIndexOffset,
        a,!1)}return this.unzoomedView};e.prototype.getZoomedView=function(a){a=this.zoomLevels[a];a.view||(a.view=new s(this,a.indexOffset,4E3,!0));return a.view};e.prototype._tsFetch=function(a,f,q,l,g){var v=this;if(a>=this.zoomLevels.length-1){if(this.topLevelReductionCache){for(var b=[],c=this.topLevelReductionCache,t=0;t<c.length;++t)c[t]._chromId==f&&b.push(c[t]);return g(b)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3E8,function(b){v.topLevelReductionCache=b;return v._tsFetch(a,
        f,q,l,g)})}else return(0>a?this.getUnzoomedView():this.getZoomedView(a)).readWigDataById(f,q,l,g)};e.prototype.thresholdSearch=function(a,f,q,l,g){function v(){if(0==c.length)return g(null);c.sort(function(g,l){var f=g.zoom-l.zoom;if(0!=f)return f;f=g.chrOrd-l.chrOrd;return 0!=f?f:g.min-l.min*q});var a=c.splice(0,1)[0];b._tsFetch(a.zoom,a.chr,a.min,a.max,function(b){var t=0<q?0:3E8;a.fromRef&&(t=f);for(var d=0;d<b.length;++d){var n=b[d],u;u=void 0!=n.maxScore?n.maxScore:n.score;if(0<q){if(u>l)if(0>
        a.zoom){if(n.min>t)return g(n)}else n.max>t&&c.push({chr:a.chr,chrOrd:a.chrOrd,zoom:a.zoom-2,min:n.min,max:n.max,fromRef:a.fromRef})}else if(u>l)if(0>a.zoom){if(n.max<t)return g(n)}else n.min<t&&c.push({chr:a.chr,chrOrd:a.chrOrd,zoom:a.zoom-2,min:n.min,max:n.max,fromRef:a.fromRef})}v()})}q=0>q?-1:1;var b=this;a=this.chromsToIDs[a];for(var c=[{chrOrd:0,chr:a,zoom:b.zoomLevels.length-4,min:0,max:3E8,fromRef:!0}],t=1;t<=this.maxID+1;++t){var d=(a+q*t)%(this.maxID+1);0>d&&(d+=this.maxID+1);c.push({chrOrd:t,
        chr:d,zoom:b.zoomLevels.length-1,min:0,max:3E8})}v()};e.prototype.getAutoSQL=function(a){if(!this.asOffset)return a(null);this.data.slice(this.asOffset,2048).fetch(function(f){var q=new Uint8Array(f);f="";for(var l=0;l<q.length&&0!=q[l];++l)f+=String.fromCharCode(q[l]);var q=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,g=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/.exec(f);if(g){l={declType:g[1],name:g[2],comment:g[4],fields:[]};f=f.substring(g[0]);for(g=q.exec(f);null!=g;g=q.exec(f))l.fields.push({type:g[1],
        name:g[2],comment:g[4]});return a(l)}})};e.prototype.getExtraIndices=function(a){var f=this;if(4>this.version||0==this.extHeaderOffset||"bigbed"!=this.type)return a(null);this.data.slice(this.extHeaderOffset,64).fetch(function(q){if(!q)return a(null,"Couldn't fetch extension header");var l=new Uint8Array(q),g=new Int16Array(q);new Int32Array(q);var v=g[1];q=m(l,4);if(0==v)return a(null);f.data.slice(q,20*v).fetch(function(g){if(!g)return a(null,"Couldn't fetch index info");var l=new Uint8Array(g),
        q=new Int16Array(g);new Int32Array(g);g=[];for(var b=0;b<v;++b){var c=q[10*b],t=q[10*b+1],n=m(l,20*b+4),c=new x(f,c,t,n,q[10*b+8]);g.push(c)}a(g)})})};x.prototype.lookup=function(b,f){var q=this;this.bbi.data.slice(this.offset,32).fetch(function(l){function g(l){q.bbi.data.slice(l,4+c*(t+n)).fetch(function(l){var v=new Uint8Array(l),c=new Uint16Array(l);new Uint32Array(l);c=c[1];l=4;if(0==v[0]){for(var d=null,u=0;u<c;++u){for(var p="",w=0;w<t;++w){var e=v[l++];0!=e&&(p+=String.fromCharCode(e))}w=
        m(v,l);l+=8;if(0>b.localeCompare(p)&&d){g(d);return}d=w}g(d)}else{for(u=0;u<c;++u){p="";for(w=0;w<t;++w)e=v[l++],0!=e&&(p+=String.fromCharCode(e));if(p==b)return c=m(v,l),v=a(v,l+8),q.bbi.getUnzoomedView().fetchFeatures(function(g,l,f,v){if(v&&v.length>q.field-3)return v[q.field-3]==b},[{offset:c,size:v}],f);l+=n}return f([])}})}var v=new Uint8Array(l);new Int16Array(l);l=new Int32Array(l);var c=l[1],t=l[2],n=l[3];m(v,16);g(q.offset+32)})};"undefined"!==typeof y&&(y.exports={makeBwg:k,BIG_BED_MAGIC:B,
        BIG_WIG_MAGIC:w})},{"./bin":4,"./das":10,"./spans":33,"./utils":45,jszlib:60}],4:[function(h,y,r){function m(a){this.blob=a}function e(a,b,c,n){n||("object"===typeof b?(n=b,b=void 0):n={});this.url=a;this.start=b||0;c&&(this.end=c);this.opts=n}function s(a){if(!a)return null;for(var b=new Uint8Array(a.length),c=0;c<b.length;++c)b[c]=a.charCodeAt(c);return b.buffer}function k(a,b){return a[b+7]<<24|a[b+6]<<16|a[b+5]<<8|a[b+4]}function x(a,b){return a[b+3]<<24|a[b+2]<<16|a[b+1]<<8|a[b]}function p(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            b){return a[b+1]<<8|a[b]}function z(a,b){return a[b]}function d(a,b){return a[b]<<24|a[b+1]<<16|a[b+2]<<8|a[b+3]}if("undefined"!==typeof h)var c=h("./utils").shallowCopy,b=h("./sha1").b64_sha1;m.prototype.slice=function(a,b){var c;c=this.blob.slice?b?this.blob.slice(a,a+b):this.blob.slice(a):b?this.blob.webkitSlice(a,a+b):this.blob.webkitSlice(a);return new m(c)};m.prototype.salted=function(){return this};m.prototype.fetch="undefined"!==typeof FileReader?function(a){var b=new FileReader;b.onloadend=
        function(c){a(s(b.result))};b.readAsBinaryString(this.blob)}:function(a){var b=new FileReaderSync;try{var c=b.readAsArrayBuffer(this.blob);a(c)}catch(n){a(null,n)}};e.prototype.slice=function(a,b){if(0>a)throw"Bad slice "+a;var c=this.start,n=this.end,c=c&&a?c+a:a||c;return new e(this.url,c,b&&c?c+b-1:n||b-1,this.opts)};var n=0,a=0<=navigator.userAgent.indexOf("Safari")&&0>navigator.userAgent.indexOf("Chrome");e.prototype.fetchAsText=function(c){var t=new XMLHttpRequest,d=this.url;if(a||this.opts.salt)d=
        d+"?salt="+b(""+Date.now()+","+ ++n);t.open("GET",d,!0);if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";t.setRequestHeader("Range","bytes="+this.start+"-"+this.end)}t.onreadystatechange=function(){if(4==t.readyState)return 200==t.status||206==t.status?c(t.responseText):c(null)};this.opts.credentials&&(t.withCredentials=!0);t.send("")};e.prototype.salted=function(){var a=c(this.opts);a.salt=!0;return new e(this.url,this.start,this.end,a)};e.prototype.fetch=function(c,t,d){var p=this;
        t=t||1;if(3<t)return c(null);var e=new XMLHttpRequest,k,h=this.url;if(a||this.opts.salt)h=h+"?salt="+b(""+Date.now()+","+ ++n);e.open("GET",h,!0);e.overrideMimeType("text/plain; charset=x-user-defined");if(this.end){if(1E8<this.end-this.start)throw"Monster fetch!";e.setRequestHeader("Range","bytes="+this.start+"-"+this.end);k=this.end-this.start+1}e.responseType="arraybuffer";e.onreadystatechange=function(){if(4==e.readyState){if(200==e.status||206==e.status){if(e.response){var a=e.response.byteLength;
            return!k||k==a||d&&a==d?c(e.response):p.fetch(c,t+1,a)}if(e.mozResponseArrayBuffer)return c(e.mozResponseArrayBuffer);a=e.responseText;return!k||k==a.length||d&&a.length==d?c(s(e.responseText)):p.fetch(c,t+1,a.length)}return p.fetch(c,t+1)}};this.opts.credentials&&(e.withCredentials=!0);e.send("")};(function(a){var b=new ArrayBuffer(8),c=new Uint8Array(b),n=new Float32Array(b);a.readFloat=function(a,b){c[0]=a[b];c[1]=a[b+1];c[2]=a[b+2];c[3]=a[b+3];return n[0]}})(this);"undefined"!==typeof y&&(y.exports=
    {BlobFetchable:m,URLFetchable:e,readInt:x,readIntBE:d,readInt64:k,readShort:p,readByte:z,readFloat:this.readFloat})},{"./sha1":31,"./utils":45}],5:[function(h,y,r){if("undefined"!==typeof h){var m=h("./cbrowser").Browser,e=h("./utils").makeElement,s=h("./numformats").formatLongInt;h("./tier-edit");h("./export-config");h("./export-ui");h("./svg-export");h("./session")}m.prototype.initUI=function(k,h){document.head.appendChild(e("link","",{rel:"stylesheet",href:this.resolveURL("$$css/bootstrap-scoped.css")}));
        document.head.appendChild(e("link","",{rel:"stylesheet",href:this.resolveURL("$$css/dalliance-scoped.css")}));document.head.appendChild(e("link","",{rel:"stylesheet",href:this.resolveURL("$$css/font-awesome.min.css")}));var p=this;p.disableDefaultFeaturePopup||this.addFeatureListener(function(a,l,g,f){p.featurePopup(a,l,g,f)});k.classList.add("dalliance");var m=p.toolbar=e("div",null,{className:"btn-toolbar toolbar"}),d=p.coordSystem.speciesName+" "+p.nameForCoordSystem(p.coordSystem);this.setDocumentTitle&&
        (document.title=d+" :: dalliance");var c=e("input","",{className:"loc-field"});p.makeTooltip(c,"Enter a genomic location or gene name");var b=e("p","",{className:"loc-status"}),n=e("a",[e("i",null,{className:"fa fa-search-plus"})],{className:"btn"}),a=e("input","",{type:"range",min:100,max:250},{className:"zoom-slider"},{width:"150px"}),u=e("a",[e("i",null,{className:"fa fa-search-minus"})],{className:"btn"}),t=e("a",[e("i",null,{className:"fa fa-eraser"})],{className:"btn"}),w=e("a",[e("i",null,
            {className:"fa fa-plus"})],{className:"btn"}),F=e("a",[e("i",null,{className:"fa fa-bookmark"})],{className:"btn"}),B=e("a",[e("i",null,{className:"fa fa-print"})],{className:"btn"});e("a",[e("i",null,{className:"fa fa-refresh"})],{className:"btn"});var Q=e("a",[e("i",null,{className:"fa fa-cogs"})],{className:"btn"}),G=e("a",[e("i",null,{className:"fa fa-question"})],{className:"btn"}),A=e("a",[e("i",null,{className:"fa fa-road"})],{className:"btn"});p.makeTooltip(A,"Configure currently selected track(s) (E)");
        var P=e("a",[e("i",null,{className:"fa fa-angle-left"})],{className:"btn"},{width:"5px"}),D=e("a",[e("i",null,{className:"fa fa-angle-right"})],{className:"btn pull-right"},{width:"5px"}),O=e("div",null,{className:"btn-group pull-right"});this.noTrackAdder||O.appendChild(w);this.noTrackEditor||O.appendChild(A);this.noExport||O.appendChild(B);this.noOptions||O.appendChild(Q);this.noHelp||O.appendChild(G);this.setUiMode=function(a){this.uiMode=a;var l={help:G,add:w,opts:Q,"export":B,tier:A},g;for(g in l)g==
        a?l[g].classList.add("active"):l[g].classList.remove("active")};this.noLeapButtons||m.appendChild(D);O.firstChild&&m.appendChild(O);this.noLeapButtons||m.appendChild(P);this.noTitle||m.appendChild(e("div",e("h4",d,{},{margin:"0px"}),{className:"btn-group title"}));this.noLocationField||m.appendChild(e("div",[c,b],{className:"btn-group loc-group"}));this.noClearHighlightsButton||m.appendChild(t);this.noZoomSlider||m.appendChild(e("div",[n,e("span",a,{className:"btn"}),u],{className:"btn-group"}));
        k.appendChild(m);k.appendChild(h);this.addViewListener(function(f,l,g,v,b){c.value=f+":"+s(l)+".."+s(g);a.min=b.min|0;a.max=b.max|0;a.value=b.current|0;p.storeStatus&&p.storeViewStatus();t.style.display=0<p.highlights.length?"inline-block":"none"});this.addTierListener(function(){p.storeStatus&&p.storeTierStatus()});c.addEventListener("keydown",function(a){40==a.keyCode&&(a.preventDefault(),a.stopPropagation(),p.setSelectedTier(0));if(10==a.keyCode||13==a.keyCode)a.preventDefault(),p.search(c.value,
            function(l){b.textContent=l?""+l:""})},!1);var E;w.addEventListener("click",function(a){E&&E.displayed?p.removeAllPopups():E=p.showTrackAdder(a)},!1);p.makeTooltip(w,"Add a new track from the registry or an indexed file. (A)");n.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();p.zoomStep(-10)},!1);p.makeTooltip(n,"Zoom in (+)");u.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();p.zoomStep(10)},!1);p.makeTooltip(u,"Zoom out (-)");a.addEventListener("change",
            function(f){p.zoomSliderValue=1*a.value;p.zoom(Math.exp(1*a.value/p.zoomExpt))},!1);F.addEventListener("click",function(a){a.stopPropagation();a.preventDefault()},!1);p.makeTooltip(F,"Favourite regions");B.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();p.openExportPanel()},!1);p.makeTooltip(B,"Export publication-quality SVG. (X)");Q.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();p.toggleOptsPopup(a)},!1);p.makeTooltip(Q,"Configure options.");
        G.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();p.toggleHelpPopup(a)});p.makeTooltip(G,"Help; Keyboard shortcuts. (H)");A.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();1==p.selectedTiers.length&&p.openTierPanel(p.tiers[p.selectedTiers[0]])},!1);P.addEventListener("click",function(a){p.leap(p.reverseKeyScrolling?-1:1,!1)},!1);p.makeTooltip(P,function(a){a=p.getSelectedTier();var l;0<=a&&(l=p.tiers[a]);return l&&l.featureSource&&p.sourceAdapterIsCapable(l.featureSource,
            "quantLeap")&&"number"==typeof l.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(l.config.name||l.dasSource.name)+'"" (ctrl+LEFT)':l&&l.featureSource&&p.sourceAdapterIsCapable(l.featureSource,"leap")?'Jump to the next feature in the selected track "'+(l.config.name||l.dasSource.name)+'" (ctrl+LEFT)':"Jump left (shift+LEFT)"});D.addEventListener("click",function(a){p.leap(p.reverseKeyScrolling?1:-1,!1)},!1);p.makeTooltip(D,function(a){a=p.getSelectedTier();
            var l;0<=a&&(l=p.tiers[a]);return l&&l.featureSource&&p.sourceAdapterIsCapable(l.featureSource,"quantLeap")&&"number"==typeof l.quantLeapThreshold?'Jump to the next region with a score above the threshold in the selected track "'+(l.config.name||l.dasSource.name)+'"" (ctrl+RIGHT)':l&&l.featureSource&&p.sourceAdapterIsCapable(l.featureSource,"leap")?'Jump to the next feature in the selected track "'+(l.config.name||l.dasSource.name)+'" (ctrl+RIGHT)':"Jump right (shift+RIGHT)"});p.addTierSelectionListener(function(){var a=
            p.getSelectedTier(),l;0<=a&&(l=p.tiers[a]);a=!1;l&&l.featureSource&&(p.sourceAdapterIsCapable(l.featureSource,"quantLeap")&&"number"==typeof l.quantLeapThreshold?a=!0:p.sourceAdapterIsCapable(l.featureSource,"leap")&&(a=!0));P.firstChild.className=a?"fa fa-angle-double-left":"fa fa-angle-left";D.firstChild.className=a?"fa fa-angle-double-right":"fa fa-angle-right"});t.addEventListener("click",function(a){p.clearHighlights()},!1);p.makeTooltip(t,"Clear highlights (C)");p.addTierSelectionWrapListener(function(a){0>
        a&&(p.setSelectedTier(null),c.focus())});p.addTierSelectionListener(function(a){"tier"===p.uiMode&&(0==a.length?(p.hideToolPanel(),p.manipulatingTier=null,p.uiMode="none"):(a=p.tiers[a[0]],a!=p.manipulatingTier&&p.openTierPanel(a)))});var f=function(a){if(65==a.keyCode||97==a.keyCode)a.preventDefault(),a.stopPropagation(),p.showTrackAdder();else if(72==a.keyCode||104==a.keyCode)a.stopPropagation(),a.preventDefault(),p.toggleHelpPopup(a);else if(69==a.keyCode||101==a.keyCode)a.stopPropagation(),a.preventDefault(),
            1==p.selectedTiers.length&&p.openTierPanel(p.tiers[p.selectedTiers[0]]);else if(88==a.keyCode||120==a.keyCode)a.stopPropagation(),a.preventDefault(),p.openExportPanel();else if(67==a.keyCode||99==a.keyCode)a.stopPropagation(),a.preventDefault(),p.clearHighlights()};k.addEventListener("focus",function(a){k.addEventListener("keydown",f,!1)},!1);k.addEventListener("blur",function(a){k.removeEventListener("keydown",f,!1)},!1);k.addEventListener("keydown",function(a){27===a.keyCode&&(a.preventDefault(),
            a.stopPropagation(),p.uiMode="none",p.hideToolPanel(),p.selectedTiers&&0<p.selectedTiers.length&&p.browserHolder.focus())},!1)};m.prototype.showToolPanel=function(k,h){var p=this;this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);var m;m=h?k:e("div",k,{},{overflowY:"auto",width:"100%"});var d=e("div",e("i",null,{className:"fa fa-caret-right"}),{className:"tool-divider"});d.addEventListener("click",function(c){p.hideToolPanel();p.setUiMode("none")},!1);this.makeTooltip(d,
        "Close tool panel (ESC)");this.activeToolPanel=e("div",[d,m],{className:"tool-holder"});this.svgHolder.appendChild(this.activeToolPanel);this.resizeViewer();p=this};m.prototype.hideToolPanel=function(){this.activeToolPanel&&this.activeToolPanel.parentElement.removeChild(this.activeToolPanel);this.svgHolder.style.width="100%";this.activeToolPanel=null;this.resizeViewer()};m.prototype.toggleHelpPopup=function(k){"help"===this.uiMode?(this.hideToolPanel(),this.setUiMode("none")):(k=e("iframe",null,{scrolling:"yes",
        seamless:"seamless",src:this.resolveURL("$$help/index.html"),className:"help-panel"}),this.showToolPanel(k,!1),this.setUiMode("help"))};m.prototype.toggleOptsPopup=function(k){var h=this;if("opts"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{k=e("div",null,{className:"form-horizontal"},{boxSizing:"border-box",MozBoxSizing:"border-box",display:"inline-block",verticalAlign:"top"});var p=e("table");p.cellPadding=5;var m=e("input","",{type:"checkbox",checked:h.reverseScrolling});m.addEventListener("change",
        function(b){h.reverseScrolling=m.checked;h.storeStatus()},!1);p.appendChild(e("tr",[e("td","Reverse trackpad scrolling",{align:"right"}),e("td",m)]));var d=e("input","",{type:"checkbox",checked:h.reverseKeyScrolling});d.addEventListener("change",function(b){h.reverseKeyScrolling=d.checked;h.storeStatus()},!1);p.appendChild(e("tr",[e("td","Reverse scrolling buttons and keys",{align:"right"}),e("td",d)]));var c=e("select");c.appendChild(e("option","Left",{value:"left"}));c.appendChild(e("option","Center",
        {value:"center"}));c.appendChild(e("option","Right",{value:"right"}));c.appendChild(e("option","None",{value:"none"}));c.value=h.rulerLocation;c.addEventListener("change",function(b){h.rulerLocation=c.value;h.positionRuler();for(b=0;b<h.tiers.length;++b)h.tiers[b].paintQuant();h.storeStatus()},!1);p.appendChild(e("tr",[e("td","Vertical guideline",{align:"right"}),e("td",c)]));k.appendChild(p);p=e("button","Reset browser",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});p.addEventListener("click",
        function(b){h.reset()},!1);k.appendChild(p);this.showToolPanel(k);this.setUiMode("opts")}}},{"./cbrowser":6,"./export-config":13,"./export-ui":14,"./numformats":24,"./session":30,"./svg-export":34,"./tier-edit":40,"./utils":45}],6:[function(h,y,r){function m(l,g,a){this.min=g;this.max=a;this.chr=l}function e(l){l||(l={});this.prefix="//www.biodalliance.org/release-0.12/";this.sources=[];this.tiers=[];this.featureListeners=[];this.featureHoverListeners=[];this.viewListeners=[];this.regionSelectListeners=
        [];this.tierListeners=[];this.tierSelectionListeners=[];this.tierSelectionWrapListeners=[];this.cookieKey="browser";this.registry="http://www.dasregistry.org/das/sources";this.chains={};this.pageName="svgHolder";this.maxExtra=2.5;this.minExtra=0.5;this.zoomFactor=1;this.zoomMin=10;this.origin=0;this.targetQuantRes=1;this.featurePanelWidth=750;this.zoomBase=100;this.zoomExpt=30;this.zoomSliderValue=100;this.entryPoints=null;this.currentSeqMax=-1;this.highlights=[];this.selectedTiers=[1];this.maxViewWidth=
        5E5;this.defaultSubtierMax=100;this.reverseScrolling=!1;this.rulerLocation="center";this.defaultHighlightFill="red";this.defaultHighlightAlpha=0.3;this.exportRuler=this.exportHighlights=!0;this.tierBackgroundColors=["rgb(245,245,245)","white"];this.minTierHeight=20;this.noDefaultLabels=!1;this.baseColors={A:"green",C:"blue",G:"black",T:"red"};this.availableSources=new n;this.defaultSources=[];this.mappableSources={};this.hubs=[];this.hubObjects=[];this.sourceCache=new b;this.useFetchWorkers=this.retina=
        !0;this.maxWorkers=2;this.workerPath="$$worker-all.js";this.assemblyNameUcsc=this.assemblyNamePrimary=!0;this.initListeners=[];if(void 0!==l.viewStart&&"number"!==typeof l.viewStart)throw Error("viewStart must be an integer");if(void 0!==l.viewEnd&&"number"!==typeof l.viewEnd)throw Error("viewEnd must be an integer");for(var g in l)this[g]=l[g];"string"===typeof l.uiPrefix&&"string"!==typeof l.prefix&&(this.prefix=l.uiPrefix);0===this.prefix.indexOf("//")&&"http:"!==window.location.prototol&&"https:"!==
        window.location.protocol&&(this.prefix="http:"+this.prefix);if(!this.coordSystem)throw Error("Coordinate system must be configured");if(void 0===this.chr||void 0===this.viewStart||void 0===this.viewEnd)throw Error("Viewed region (chr:start..end) must be defined");var a=this;"complete"===document.readyState?a.realInit():window.addEventListener("load",function(g){a.realInit()},!1)}function s(l,g,a){if(a)for(var f=0;f<g.length;++f)g[f].mapping=a;l.set(g)}function k(l){return l.uri?l.uri:l.blob?"file:"+
        l.blob.name:l.bwgBlob?"file:"+l.bwgBlob.name:l.bamBlob?"file:"+l.bamBlob.name:l.twoBitBlob?"file:"+l.twoBitBlob.name:l.bwgURI||l.bamURI||l.jbURI||l.twoBitURI||"http://www.biodalliance.org/magic/no_uri"}function x(l){return l.stylesheet_uri?l.stylesheet_uri:"sequence"==l.tier_type||l.twoBitURI||l.twoBitBlob?"http://www.biodalliance.org/magic/sequence":k(l)}function p(l,g){if(k(l)!=k(g)||x(l)!=x(g)||l.mapping!=g.mapping||l.tier_type!=g.tier_type)return!1;if(l.overlay){if(!g.overlay||g.overlay.length!=
        l.overlay.length)return!1;for(var a=0;a<l.overlay.length;++a)if(!p(l.overlay[a],g.overlay[a]))return!1}else if(g.overlay)return!1;return!0}function z(l,g,a,f){f=f||[];for(var b=l.length-1;0<=b;--b){var c=l[b];if(!c.notSelectable&&c.min()<=g&&c.max()>=g&&(!c.minY||!(a<c.minY()||a>c.maxY()))){c.feature?f.push(c.feature):c.group&&f.push(c.group);if(c.glyphs)return z(c.glyphs,g,a,f);if(c.glyph)return z([c.glyph],g,a,f);break}}return f}function d(l,g){var a=this;this.tagSeed=0;this.callbacks={};this.browser=
        l;this.worker=g;this.worker.onmessage=function(g){var l=a.callbacks[g.data.tag];l&&(l(g.data.result,g.data.error),delete a.callbacks[g.data.tag])}}function c(l){var g=l.resolveURL(l.workerPath);0==g.indexOf("//")&&(g="https:"===window.location.prototype?"https:"+g:"http:"+g);var a=new Blob(['importScripts("'+g+'");'],{type:"application/javascript"});return new D(function(g,f){var b=new Worker(URL.createObjectURL(a));b.onmessage=function(a){"init"===a.data.tag&&(console.log("Worker initialized"),g(new d(l,
        b)))};b.onerror=function(g){f(g.message)}})}function b(){this.sourcesByURI={}}if("undefined"!==typeof h){r=h("./utils");var n=r.Observed,a=r.makeElement,u=r.removeChildren,t=r.miniJSONify,w=r.shallowCopy,F=h("./tier").DasTier,B=h("./sha1").hex_sha1,Q=h("./thub").connectTrackHub,G=h("./version"),A=h("./numformats").formatQuantLabel,P=h("./chainset").Chainset,D=h("es6-promise").Promise}e.prototype.resolveURL=function(l){return l.replace("$$",this.prefix)};e.prototype.realInit=function(){if(this.wasInitialized)console.log("Attemping to call realInit on an already-initialized Dalliance instance");
    else{this.wasInitialized=!0;var l=navigator.userAgent||"dummy";0<=l.indexOf("Trident")&&0<=l.indexOf("rv:11")&&(this.disablePinning=!0);this.defaultChr=this.chr;this.defaultStart=this.viewStart;this.defaultEnd=this.viewEnd;this.defaultSources=[];for(l=0;l<this.sources.length;++l){var g=this.sources[l];g&&this.defaultSources.push(g)}this.restoreStatus&&(this.statusRestored=this.restoreStatus());var f=this;this.browserHolderHolder=document.getElementById(this.pageName);this.browserHolderHolder.classList.add("dalliance-injection-point");
        this.browserHolder=a("div",null,{className:"dalliance dalliance-root",tabIndex:-1});this.maxHeight?this.browserHolder.style.maxHeight=this.maxHeight+"px":void 0!=this.maxHeight&&(this.browserHolder.style.maxHeight=null);u(this.browserHolderHolder);this.browserHolderHolder.appendChild(this.browserHolder);this.svgHolder=a("div",null,{className:"main-holder"});this.initUI(this.browserHolder,this.svgHolder);this.pinnedTierHolder=a("div",null,{className:"tier-holder tier-holder-pinned"});this.tierHolder=
            a("div",this.makeLoader(24),{className:"tier-holder tier-holder-rest"});this.disablePinning?this.tierHolderHolder=this.tierHolder:(this.tierHolderHolder=a("div",[this.pinnedTierHolder,this.tierHolder],{className:"tier-holder-holder"}),this.svgHolder.appendChild(this.tierHolderHolder));this.svgHolder.appendChild(this.tierHolderHolder);this.bhtmlRoot=a("div");this.disablePoweredBy||this.bhtmlRoot.appendChild(a("span",["Powered by ",a("a","Biodalliance",{href:"http://www.biodalliance.org/"})," "+G],
            {className:"powered-by"}));this.browserHolder.appendChild(this.bhtmlRoot);window.addEventListener("resize",function(g){f.resizeViewer()},!1);this.ruler=a("div",null,{className:"guideline"});this.ruler2=a("div",null,{className:"guideline"},{backgroundColor:"gray",opacity:"0.5",zIndex:899});this.tierHolderHolder.appendChild(this.ruler);this.tierHolderHolder.appendChild(this.ruler2);this.chainConfigs=this.chains||{};this.chains={};for(var b in this.chainConfigs)l=this.chainConfigs[b],l instanceof P&&
            console.log('WARNING: Should no longer use "new Chainset" in Biodalliance configurations.'),this.chains[b]=new P(l);if(0<this.maxWorkers){b=[];for(l=0;l<this.maxWorkers;++l)b.push(c(this));b=D.all(b)}else b=D.resolve([]);this.fetchWorkers=null;this.nextWorker=0;b.then(function(g){console.log("Booted "+g.length+" workers");f.fetchWorkers=g},function(g){console.log("Failed to boot workers",g)}).then(function(){if("none"!=window.getComputedStyle(f.browserHolderHolder).display)setTimeout(function(){f.realInit2()},
            1);else var g=setInterval(function(){"none"!=window.getComputedStyle(f.browserHolderHolder).display&&(clearInterval(g),f.realInit2())},300)})}};e.prototype.realInit2=function(){var l=this;u(this.tierHolder);u(this.pinnedTierHolder);this.featurePanelWidth=this.tierHolder.getBoundingClientRect().width|0;this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.zoomMax||(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/
        10/this.zoomBase));this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);this.tierHolderHolder.addEventListener("mousewheel",function(g){g.stopPropagation();g.preventDefault();if(g.wheelDeltaX){var a=g.wheelDeltaX/5;l.reverseScrolling||(a=-a);l.move(a)}g.wheelDeltaY&&(a=g.wheelDeltaY,l.reverseScrolling&&(a=-a),l.tierHolder.scrollTop+=a)},!1);this.tierHolderHolder.addEventListener("MozMousePixelScroll",function(g){g.stopPropagation();g.preventDefault();1==g.axis?
        0!=g.detail&&(g=g.detail/4,l.reverseScrolling&&(g=-g),l.move(g)):(g=g.detail,l.reverseScrolling||(g=-g),l.tierHolder.scrollTop+=g)},!1);this.tierHolderHolder.addEventListener("touchstart",function(g){return l.touchStartHandler(g)},!1);this.tierHolderHolder.addEventListener("touchmove",function(g){return l.touchMoveHandler(g)},!1);this.tierHolderHolder.addEventListener("touchend",function(g){return l.touchEndHandler(g)},!1);this.tierHolderHolder.addEventListener("touchcancel",function(g){return l.touchCancelHandler(g)},
        !1);var g=function(g){if(13==g.keyCode){var a=!1;for(g=0;g<l.tiers.length;++g){var f=l.tiers[g];f.wantedLayoutHeight&&f.wantedLayoutHeight!=f.layoutHeight&&(f.layoutHeight=f.wantedLayoutHeight,f.clipTier(),a=!0)}a&&l.arrangeTiers()}else if(32==g.keyCode||32==g.charCode)l.isSnapZooming?(l.isSnapZooming=!1,a=(l.savedZoom||20)+l.zoomMin):(l.isSnapZooming=!0,a=(l.savedZoom||0)+l.zoomMin),l.savedZoom=l.zoomSliderValue-l.zoomMin,l.zoomSliderValue=a,l.zoom(Math.exp(1*a/l.zoomExpt)),l.snapZoomLockout=!0,
        g.stopPropagation(),g.preventDefault();else if(39==g.keyCode)g.stopPropagation(),g.preventDefault(),l.scrollArrowKey(g,-1);else if(37==g.keyCode)g.stopPropagation(),g.preventDefault(),l.scrollArrowKey(g,1);else if(38==g.keyCode||87==g.keyCode)if(g.stopPropagation(),g.preventDefault(),g.shiftKey)g=l.getSelectedTier(),0>g||(a=l.tiers[g],g=a.forceHeight||a.subtiers[0].height,40<=g&&a.mergeConfig({height:g-10}));else if(g.ctrlKey||g.metaKey){if(g=l.getSelectedTier(),!(0>g)&&(a=l.tiers[g],a.quantLeapThreshold)){var f=
        a.subtiers[0].height,v=a.subtiers[0].quant;v&&(g=1*v.min,v=1*v.max,f=(v-g)/f,a.mergeConfig({quantLeapThreshold:g+((Math.round((a.quantLeapThreshold-g)/f)|0)+1)*f}),a.notify("Threshold: "+A(a.quantLeapThreshold)))}}else if(g.altKey){if(v=l.selectedTiers.length,0!=v){g=l.selectedTiers[0];for(var b=!0,a=[],f=0;f<l.selectedTiers.length;++f)a.push(l.tiers[l.selectedTiers[f]]),0<f&&1!=l.selectedTiers[f]-l.selectedTiers[f-1]&&(b=!1);if(!(b&&0>=g)){for(f=l.selectedTiers.length-1;0<=f;--f)l.tiers.splice(l.selectedTiers[f],
        1);l.selectedTiers.splice(0,v);g=b?g-1:g;for(f=0;f<a.length;++f)l.tiers.splice(g+f,0,a[f]),l.selectedTiers.push(g+f);l.markSelectedTiers();l.notifyTierSelection();l.reorderTiers();l.notifyTier()}}}else if(g=l.getSelectedTier(),0<g){if(l.setSelectedTier(g-1),g=l.tiers[l.getSelectedTier()],a=g.row.offsetTop,g=a+g.row.offsetHeight,a<l.tierHolder.scrollTop||g>l.tierHolder.scrollTop+l.tierHolder.offsetHeight)l.tierHolder.scrollTop=a}else l.notifyTierSelectionWrap(-1);else if(40==g.keyCode||83==g.keyCode)if(g.stopPropagation(),
        g.preventDefault(),g.shiftKey)g=l.getSelectedTier(),0>g||(a=l.tiers[g],g=a.forceHeight||a.subtiers[0].height,a.mergeConfig({height:g+10}));else if(g.ctrlKey||g.metaKey){if(g=l.getSelectedTier(),!(0>g)&&(a=l.tiers[g],a.quantLeapThreshold&&(f=a.subtiers[0].height,v=a.subtiers[0].quant)))g=1*v.min,v=1*v.max,f=(v-g)/f,v=Math.round((a.quantLeapThreshold-g)/f)|0,1<v&&(a.mergeConfig({quantLeapThreshold:g+(v-1)*f}),a.notify("Threshold: "+A(a.quantLeapThreshold)))}else if(g.altKey){if(v=l.selectedTiers.length,
        0!=v){g=l.selectedTiers[0];for(var c=0,a=[],f=0;f<l.selectedTiers.length;++f)a.push(l.tiers[l.selectedTiers[f]]),0<f&&(c+=l.selectedTiers[f]-l.selectedTiers[f-1]-1);b=0==c;if(!(b&&g+v>=l.tiers.length)){for(f=l.selectedTiers.length-1;0<=f;--f)l.tiers.splice(l.selectedTiers[f],1);l.selectedTiers.splice(0,v);g=b?g+1:g+c;for(f=0;f<a.length;++f)l.tiers.splice(g+f,0,a[f]),l.selectedTiers.push(g+f);l.markSelectedTiers();l.notifyTierSelection();l.reorderTiers();l.notifyTier()}}}else{if(g=l.getSelectedTier(),
        g<l.tiers.length-1&&(l.setSelectedTier(g+1),g=l.tiers[l.getSelectedTier()],a=g.row.offsetTop,g=a+g.row.offsetHeight,a<l.tierHolder.scrollTop||g>l.tierHolder.scrollTop+l.tierHolder.offsetHeight))l.tierHolder.scrollTop=Math.min(a,g-l.tierHolder.offsetHeight)}else if(187==g.keyCode||61==g.keyCode)g.stopPropagation(),g.preventDefault(),l.zoomStep(-10);else if(189==g.keyCode||173==g.keyCode)g.stopPropagation(),g.preventDefault(),l.zoomStep(10);else if(73==g.keyCode||105==g.keyCode)g.stopPropagation(),
        g.preventDefault(),g=l.getSelectedTier(),0>g||(f=l.tiers[g],f.infoVisible?(f.infoElement.style.display="none",f.updateHeight(),f.infoVisible=!1):(f.infoElement.style.display="block",f.updateHeight(),f.infoVisible=!0));else if(84==g.keyCode||116==g.keyCode)if(g.shiftKey)for(g.stopPropagation(),g.preventDefault(),g=0;g<l.tiers.length;++g)f=l.tiers[g],f.dasSource.collapseSuperGroups&&(void 0===a&&(a=!f.bumped),f.bumped=a,f.layoutWasDone=!1,f.draw(),f.updateLabel());else g.ctrlKey||g.metaKey||(g.stopPropagation(),
        g.preventDefault(),g=l.getSelectedTier(),0>g||(f=l.tiers[g],f.dasSource.collapseSuperGroups&&(void 0===a&&(a=!f.bumped),f.bumped=a,f.layoutWasDone=!1,f.draw(),f.updateLabel())));else if(77==g.keyCode||109==g.keyCode)g.stopPropagation(),g.preventDefault(),(g.ctrlKey||g.metaKey)&&1<l.selectedTiers.length&&l.mergeSelectedTiers();else if(68==g.keyCode||100==g.keyCode){if(g.stopPropagation(),g.preventDefault(),g.ctrlKey||g.metaKey)g=l.getSelectedTier(),0>g||l.addTier(l.tiers[g].dasSource)}else if(80==
        g.keyCode||112==g.keyCode)if(g.ctrlKey||g.metaKey){a=[];for(g=0;g<l.selectedTiers.length;++g)a.push(l.tiers[l.selectedTiers[g]]);for(g=0;g<a.length;++g)a[g].mergeConfig({pinned:!a[g].pinned})}};this.browserHolder.addEventListener("focus",function(a){l.browserHolder.addEventListener("keydown",g,!1)},!1);this.browserHolder.addEventListener("blur",function(a){l.browserHolder.removeEventListener("keydown",g,!1)},!1);this.hPopupHolder=a("div");this.hPopupHolder.style["font-family"]="helvetica";this.hPopupHolder.style["font-size"]=
        "12pt";this.hPopupHolder.classList.add("dalliance");document.body.appendChild(this.hPopupHolder);for(var f=0;f<this.sources.length;++f){var b=this.sources[f];if(b){var c={};this.restoredConfigs&&(c=this.restoredConfigs[f]);b.disabled||this.makeTier(b,c)}}l.arrangeTiers();l.refresh();l.setSelectedTier(1);l.positionRuler();(f=this.getSequenceSource())&&f.getSeqInfo(this.chr,function(g){l.currentSeqMax=g.length});this.queryRegistry();for(var q in this.chains)this.queryRegistry(q,!0);if(this.hubs)for(q=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  0;q<this.hubs.length;++q)f=this.hubs[q],"string"==typeof f&&(f={url:f}),function(g){Q(g.url,function(a,f){if(f)console.log(f);else{var v;if(v=g.genome?a.genomes[g.genome]:a.genomes[l.coordSystem.ucscName])g.mapping&&(v.mapping=g.mapping),l.hubObjects.push(v)}},g)}(f);this.fullScreen&&this.setFullScreenHeight();!this.statusRestored&&this.storeStatus&&this.storeStatus();for(q=0;q<this.initListeners.length;++q)try{this.initListeners[q].call(this)}catch(n){console.log(n)}};e.prototype.touchStartHandler=
        function(a){this.touchOriginX=a.touches[0].pageX;this.touchOriginY=a.touches[0].pageY;2==a.touches.length&&(a=Math.abs(a.touches[0].pageX-a.touches[1].pageX),this.zooming=!0,this.zoomLastSep=this.zoomInitialSep=a,this.zoomInitialScale=this.scale)};e.prototype.touchMoveHandler=function(a){a.stopPropagation();a.preventDefault();if(1==a.touches.length){var g=a.touches[0].pageX;a=a.touches[0].pageY;this.touchOriginX&&g!=this.touchOriginX&&this.move(g-this.touchOriginX);this.touchOriginY&&a!=this.touchOriginY&&
    (this.tierHolder.scrollTop-=a-this.touchOriginY);this.touchOriginX=g;this.touchOriginY=a}else if(this.zooming&&2==a.touches.length){g=Math.abs(a.touches[0].pageX-a.touches[1].pageX);if(g!=this.zoomLastSep){a=(a.touches[0].pageX+a.touches[1].pageX)/2;var f=this.viewStart+a/this.scale|0;this.scale=g/this.zoomInitialSep*this.zoomInitialScale;this.viewStart=f-a/this.scale|0;for(a=0;a<this.tiers.length;++a)this.tiers[a].draw()}this.zoomLastSep=g}};e.prototype.touchEndHandler=function(a){};e.prototype.touchCancelHandler=
        function(a){};e.prototype.makeTier=function(a,g){try{return this.realMakeTier(a,g)}catch(f){console.log(f.stack||f)}};e.prototype.realMakeTier=function(a,g){var f=this,b=null;this.tierBackgroundColors&&(b=this.tierBackgroundColors[this.tiers.length%this.tierBackgroundColors.length]);var c=new F(this,a,g,b);c.oorigin=this.viewStart;var q=!1,n,d,t,e=function(g,a){var l=c.subtiers;if(l){var b=0;for(a-=c.padding;b<l.length&&a>l[b].height&&b<l.length-1;)a=a-l[b].height-c.padding,++b;if(!(b>=l.length))return l=
        l[b].glyphs,g-=(c.glyphCacheOrigin-f.viewStart)*f.scale,z(l,g,a)}},p=function(g){g.preventDefault();g.stopPropagation();g=g.clientX;g!=d&&(f.move(g-d),d=g);f.isDragging=!0},u=function(g){window.removeEventListener("mousemove",p,!0);window.removeEventListener("mouseup",u,!0)};c.viewport.addEventListener("mousedown",function(g){f.browserHolder.focus();g.preventDefault();c.row.getBoundingClientRect();g=g.clientX;window.addEventListener("mousemove",p,!0);window.addEventListener("mouseup",u,!0);n=d=g;
        f.isDragging=!1},!1);c.viewport.addEventListener("mousemove",function(g){var a=c.row.getBoundingClientRect(),l=g.clientX-a.left,b=g.clientY-a.top;t&&clearTimeout(t);q||(t=setTimeout(function(){var a=e(l,b);a&&0<a.length&&f.notifyFeatureHover(g,a[a.length-1],a,c)},1E3))});var k=null;c.viewport.addEventListener("mouseup",function(g){var a=c.row.getBoundingClientRect(),l=g.clientX-a.left,a=g.clientY-a.top,b=e(l,a);b&&0<b.length&&!f.isDragging&&(k?(clearTimeout(k),k=null,f.featureDoubleClick(b,l,a)):
        k=setTimeout(function(){k=null;f.notifyFeature(g,b[b.length-1],b,c)},500));if(f.isDragging&&l!=n&&c.sequenceSource){var a=f.viewStart+l/f.scale,q=f.viewStart+n/f.scale;a<q?(l=a|0,a=q|0):(l=q|0,a|=0);f.notifyRegionSelect(f.chr,l,a)}f.isDragging=!1},!1);c.viewport.addEventListener("mouseout",function(g){q=!1});c.removeButton.addEventListener("click",function(g){g.stopPropagation();g.preventDefault();for(g=0;g<f.tiers.length;++g)if(f.tiers[g]===c){f.removeTier({index:g});break}},!1);c.nameButton.addEventListener("click",
        function(g){g.stopPropagation();g.preventDefault();if(g.shiftKey){g=-1;for(var a=0;a<f.tiers.length;++a)if(f.tiers[a]===c){g=a;break}0<=g&&(a=f.selectedTiers.indexOf(g),0<=a?f.selectedTiers.splice(a,1):(f.selectedTiers.push(g),f.selectedTiers.sort()),f.markSelectedTiers(),f.notifyTierSelection(),0<f.selectedTiers.length?f.browserHolder.focus():f.notifyTierSelectionWrap(-1))}else{for(a=0;a<f.tiers.length;++a)if(f.tiers[a]===c&&(f.browserHolder.focus(),1!=f.selectedTiers.length||f.selectedTiers[0]!=
            a)){f.setSelectedTier(a);return}c.infoVisible?(c.infoElement.style.display="none",c.updateHeight(),c.infoVisible=!1):(c.infoElement.style.display="block",c.updateHeight(),c.infoVisible=!0)}},!1);c.bumpButton.addEventListener("click",function(g){g.stopPropagation();g.preventDefault();var a;c.dasSource.collapseSuperGroups&&(void 0===a&&(a=!c.bumped),c.bumped=a,c.layoutWasDone=!1,c.draw(),c.updateLabel())},!1);var w,h,m,D,A,O=!1,ja=function(g){var a=c.label;g.stopPropagation();g.preventDefault();if(!w){h=
        c.pinned?f.pinnedTierHolder:f.tierHolder;m=h.scrollHeight-h.offsetHeight;w=a.cloneNode(!0);w.style.cursor="pointer";h.appendChild(w);a.style.visibility="hidden";for(var l=0;l<f.tiers.length;++l)if(f.tiers[l]===c){D=l;break}A=g.clientY}var b=h.getBoundingClientRect();w.style.left=a.getBoundingClientRect().left-b.left+"px";w.style.top=g.clientY-b.top+h.scrollTop-10+"px";a=g.clientY-b.top+h.scrollTop;for(l=0;l<f.tiers.length;++l)if(b=f.tiers[l],!(b.pinned^c.pinned)&&(b=b.row.getBoundingClientRect(),
        a-=b.bottom-b.top,0>a)){if(l<D&&g.clientY<A||l>D&&g.clientY>A)f.withPreservedSelection(function(){f.tiers.splice(D,1);f.tiers.splice(l,0,c)}),D=l,A=g.clientY,f.reorderTiers(),h.appendChild(w),O=!0;break}w.offsetTop<h.scrollTop?h.scrollTop-=h.scrollTop-w.offsetTop:w.offsetTop+w.offsetHeight>h.scrollTop+h.offsetHeight&&(h.scrollTop=Math.min(h.scrollTop+(w.offsetTop+w.offsetHeight)-(h.scrollTop+h.offsetHeight),m))},Y=function(g){var a=c.label;g.stopPropagation();g.preventDefault();w&&(w.style.cursor=
        "auto",h.removeChild(w),w=null,a.style.visibility=null);document.removeEventListener("mousemove",ja,!1);document.removeEventListener("mouseup",Y,!1);if(O){for(g=0;g<f.tiers.length;++g)if(f.tiers[g]==c){f.setSelectedTier(g);break}f.notifyTier()}};c.label.addEventListener("mousedown",function(g){g.stopPropagation();g.preventDefault();O=!1;document.addEventListener("mousemove",ja,!1);document.addEventListener("mouseup",Y,!1)},!1);this.tiers.push(c);c.init();c.currentlyHeight=50;this.updateHeight();c.updateLabel();
        c.featureSource&&c.featureSource.addActivityListener&&c.featureSource.addActivityListener(function(g){c.loaderButton.style.display=0<g?"inline-block":"none";f.pingActivity()});c._updateFromConfig();this.reorderTiers();return c};e.prototype.reorderTiers=function(){u(this.tierHolder);u(this.pinnedTierHolder);this.disablePinning&&(this.tierHolder.appendChild(this.ruler),this.tierHolder.appendChild(this.ruler2));for(var a=!1,g=[],f=[],b=0;b<this.tiers.length;++b){var c=this.tiers[b];c.pinned&&!this.disablePinning?
        (g.push(c),this.pinnedTierHolder.appendChild(this.tiers[b].row),a=!0):(f.push(c),this.tierHolder.appendChild(this.tiers[b].row))}this.withPreservedSelection(function(){this.tiers.splice(0,this.tiers.length);for(var a=0;a<g.length;++a)this.tiers.push(g[a]);for(a=0;a<f.length;++a)this.tiers.push(f[a])});a?this.pinnedTierHolder.classList.add("tier-holder-pinned-full"):this.pinnedTierHolder.classList.remove("tier-holder-pinned-full");this.arrangeTiers()};e.prototype.withPreservedSelection=function(a){for(var g=
        [],f=0;f<this.selectedTiers.length;++f)g.push(this.tiers[this.selectedTiers[f]]);a.call(this);this.selectedTiers=[];for(a=0;a<this.tiers.length;++a)0<=g.indexOf(this.tiers[a])&&this.selectedTiers.push(a)};e.prototype.refreshTier=function(a){this.knownSpace&&this.knownSpace.invalidate(a)};e.prototype.arrangeTiers=function(){for(var a=[],g=0;g<this.tiers.length;++g){var f=this.tiers[g];f.pinned&&a.push(f)}for(g=0;g<this.tiers.length;++g)f=this.tiers[g],f.pinned||a.push(f);if(this.tierBackgroundColors)for(g=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        0;g<a.length;++g)f=a[g],f.setBackground(this.tierBackgroundColors[g%this.tierBackgroundColors.length])};e.prototype.refresh=function(){this.notifyLocation();var a=100/this.scale|0,g=1E3/this.scale|0,b=(this.viewStart+this.viewEnd)/2,c=b-this.origin;this.origin=b;this.scaleAtLastRedraw=this.scale;for(b=0;b<this.tiers.length;++b){var q=c;this.tiers[b].originHaxx&&(q+=this.tiers[b].originHaxx);this.tiers[b].originHaxx=q}c=this.targetQuantRes/this.scale;b=Math.max(1,(this.viewStart|0)-a);a=Math.min((this.viewEnd|
        0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);q=Math.max(1,(this.viewStart|0)-g);g=Math.min((this.viewEnd|0)+g,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9);if(!this.knownSpace||this.knownSpace.chr!==this.chr){var n=this.getSequenceSource();this.knownSpace=new f(this.tiers,this.chr,q,g,c,n)}(n=this.knownSpace.bestCacheOverlapping(this.chr,b,a))&&n.min<=b&&n.max>=a?(this.drawnStart=Math.max(n.min,q),this.drawnEnd=Math.min(n.max,g)):(this.drawnStart=q,this.drawnEnd=g);this.knownSpace.viewFeatures(this.chr,
        this.drawnStart,this.drawnEnd,c);this.drawOverlays()};e.prototype.queryRegistry=function(a,g){var f,b;a?(f=this.chains[a].coords,this.mappableSources[a]||(this.mappableSources[a]=new n),b=this.mappableSources[a]):(f=this.coordSystem,b=this.availableSources);var c=B(t(f));if(g){var d=localStorage["dalliance.registry."+c+".last_queried"];if(d)try{if(s(b,JSON.parse(localStorage["dalliance.registry."+c+".sources"]),a),432E5>(Date.now()|0)-(d|0))return}catch(e){console.log("Bad registry cache: "+e)}}(new q(this.registry)).sources(function(g){for(var q=
        [],n=0;n<g.length;++n){var d=g[n];if(d.coords&&0!=d.coords.length){var t=d.coords[0];t.taxon==f.taxon&&t.auth==f.auth&&t.version==f.version&&q.push(d)}}localStorage["dalliance.registry."+c+".sources"]=JSON.stringify(q);localStorage["dalliance.registry."+c+".last_queried"]=""+Date.now();s(b,q,a)},function(g){},f)};e.prototype.move=function(a){var g=this.viewEnd-this.viewStart;this.viewStart-=1*a/this.scale;this.viewEnd=this.viewStart+g;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&(this.viewEnd=
        this.currentSeqMax,this.viewStart=this.viewEnd-g);1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+g);this.notifyLocation();for(a=0;a<this.tiers.length;++a)this.tiers[a].viewportHolder.style.left=""+((-((this.viewStart-this.tiers[a].norigin)*this.scale)|0)-1E3)+"px",this.tiers[a].overlay.style.left=""+((-((this.viewStart-this.tiers[a].oorigin)*this.scale)|0)-1E3)+"px";this.spaceCheck()};e.prototype.zoomStep=function(a){var g=1*this.zoomSliderValue;a=g+a;a<this.zoomMin&&(a=this.zoomMin);
        a>this.zoomMax&&(a=this.zoomMax);a!=g&&(this.zoomSliderValue=a,this.zoom(Math.exp(1*a/this.zoomExpt)))};e.prototype.zoom=function(a){this.zoomFactor=a;a=Math.round((this.viewStart+this.viewEnd)/2)|0;this.viewStart=a-this.zoomBase*this.zoomFactor/2;this.viewEnd=a+this.zoomBase*this.zoomFactor/2;0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax+5&&(a=this.viewEnd-this.viewStart+1,this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-a+1);1>this.viewStart&&(a=this.viewEnd-this.viewStart+1,
        this.viewStart=1,this.viewEnd=this.viewStart+a-1);this.scale=this.featurePanelWidth/(this.viewEnd-this.viewStart);this.refresh()};e.prototype.spaceCheck=function(a){this.knownSpace&&this.knownSpace.chr===this.chr?(a=100/this.scale|0,((this.drawnStart|0)>Math.max(1,(this.viewStart|0)-a|0)||(this.drawnEnd|0)<Math.min((this.viewEnd|0)+a,0<(this.currentSeqMax|0)?this.currentSeqMax|0:1E9))&&this.refresh()):this.refresh()};e.prototype.resizeViewer=function(a){var g=this.tierHolder.getBoundingClientRect().width|
        0;if(0!=g){var f=Math.max(this.featurePanelWidth,300);this.featurePanelWidth=g|0;f!=this.featurePanelWidth&&(this.zoomMax=this.zoomExpt*Math.log(this.maxViewWidth/this.zoomBase),this.zoomMin=this.zoomExpt*Math.log(this.featurePanelWidth/10/this.zoomBase),this.zoomSliderValue=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase),this.viewEnd=this.viewStart+(this.viewEnd-this.viewStart)*this.featurePanelWidth/f,g=this.viewEnd-this.viewStart+1,0<this.currentSeqMax&&this.viewEnd>this.currentSeqMax&&
        (this.viewEnd=this.currentSeqMax,this.viewStart=this.viewEnd-g+1),1>this.viewStart&&(this.viewStart=1,this.viewEnd=this.viewStart+g-1),this.positionRuler(),a||this.spaceCheck(),this.notifyLocation());this.fullScreen&&this.setFullScreenHeight()}};e.prototype.setFullScreenHeight=function(){this.browserHolder.style.maxHeight=Math.max(300,window.innerHeight-(document.body.offsetHeight-this.browserHolder.offsetHeight)-20)+"px"};e.prototype.addTier=function(a){a=w(a);a.disabled=!1;a=this.makeTier(a);this.markSelectedTiers();
        this.positionRuler();this.notifyTier();return a};e.prototype.removeTier=function(a,g){var f=-1;if("undefined"!==typeof a.index&&0<=a.index&&a.index<this.tiers.length)f=a.index;else for(var b=0;b<this.tiers.length;++b)if(p(a,this.tiers[b].dasSource)){f=b;break}if(0>f)throw"Couldn't find requested tier";this.tiers.splice(f,1);for(var b=[],c=0;c<this.selectedTiers.length;++c){var q=this.selectedTiers[c];q<f?b.push(q):q>f&&b.push(q-1)}this.selectedTiers=b;this.markSelectedTiers();this.reorderTiers();
        this.notifyTier()};e.prototype.getSequenceSource=function(){void 0===this._sequenceSource&&(this._sequenceSource=this._getSequenceSource());return this._sequenceSource};e.prototype._getSequenceSource=function(){for(var a=0;a<this.tiers.length;++a)if(this.tiers[a].sequenceSource)return this.tiers[a].sequenceSource;for(a=0;a<this.defaultSources.length;++a){var g=this.defaultSources[a];if(g.provides_entrypoints||"sequence"==g.tier_type||g.twoBitURI||g.twoBitBlob)return g.twoBitURI||g.twoBitBlob?new O(g):
        new E(g)}};e.prototype.setLocation=function(a,g,f,b){if("number"!==typeof g)throw Error("minimum must be a number (got "+JSON.stringify(g)+")");if("number"!==typeof f)throw Error("maximum must be a number (got "+JSON.stringify(f)+")");b||(b=function(g){if(g)throw g;});var c=this;if(a&&a!=this.chr){var q=this.getSequenceSource();if(!q)return b("Need a sequence source");q.getSeqInfo(a,function(n){if(n)return c._setLocation(a,g,f,n,b);var d;d=0==a.indexOf("chr")?a.substr(3):"chr"+a;q.getSeqInfo(d,function(q){return q?
        c._setLocation(d,g,f,q,b):b("Couldn't find sequence '"+a+"'")})})}else return this._setLocation(null,g,f,null,b)};e.prototype._setLocation=function(a,g,f,b,c){var q=!1;a&&(0==a.indexOf("chr")&&(a=a.substring(3)),this.chr!=a&&(q=!0),this.chr=a,this.currentSeqMax=b.length);g|=0;f|=0;a=Math.max(10,f-g+1);1>g&&(g=1,f=g+a-1);f>this.currentSeqMax&&(f=this.currentSeqMax,g=Math.max(1,f-a+1));this.viewStart=g;this.viewEnd=f;g=Math.max(this.featurePanelWidth,50)/(this.viewEnd-this.viewStart);a=1E-4<Math.abs(g-
        this.scale);this.scale=g;f=this.zoomSliderValue;this.zoomSliderValue=g=this.zoomExpt*Math.log((this.viewEnd-this.viewStart+1)/this.zoomBase);if(a||q){for(q=0;q<this.tiers.length;++q)this.tiers[q].viewportHolder.style.left="5000px",this.tiers[q].overlay.style.left="5000px";this.refresh();this.savedZoom?(g-=this.zoomMin,f-=this.zoomMin,q=g-this.savedZoom,Math.abs(g-f)>Math.abs(q)&&(this.isSnapZooming=!this.isSnapZooming,this.savedZoom=f)):(this.isSnapZooming=!1,this.savedZoom=null)}else for(q=0;q<this.tiers.length;++q)this.tiers[q].viewportHolder.style.left=
        ""+((-((this.viewStart-this.tiers[q].norigin)*this.scale)|0)-1E3)+"px",this.tiers[q].overlay.style.left=""+((-((this.viewStart-this.tiers[q].oorigin)*this.scale)|0)-1E3)+"px";this.notifyLocation();this.spaceCheck();this.instrumentActivity&&(this.activityStartTime=Date.now()|0);return c()};e.prototype.pingActivity=function(){if(this.instrumentActivity&&this.activityStartTime){for(var a=0,g=0;g<this.tiers.length;++g)"none"!==this.tiers[g].loaderButton.style.display&&++a;0==a&&(a=Date.now()|0,console.log("Loading took "+
        (a-this.activityStartTime)+"ms"),this.activityStartTime=null)}};e.prototype.addInitListener=function(a){this.initListeners.push(a)};e.prototype.addFeatureListener=function(a,g){this.featureListeners.push(a)};e.prototype.notifyFeature=function(a,g,f,b){for(var c=0;c<this.featureListeners.length;++c)try{if(this.featureListeners[c](a,g,f,b))break}catch(q){console.log(q.stack)}};e.prototype.addFeatureHoverListener=function(a,g){this.featureHoverListeners.push(a)};e.prototype.notifyFeatureHover=function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                g,f,b){for(var c=0;c<this.featureHoverListeners.length;++c)try{this.featureHoverListeners[c](a,g,f,b)}catch(q){console.log(q.stack)}};e.prototype.addViewListener=function(a,g){this.viewListeners.push(a)};e.prototype.notifyLocation=function(){for(var a=0;a<this.viewListeners.length;++a)try{this.viewListeners[a](this.chr,this.viewStart|0,this.viewEnd|0,this.zoomSliderValue,{current:this.zoomSliderValue,min:this.zoomMin,max:this.zoomMax})}catch(g){console.log(g.stack)}};e.prototype.addTierListener=function(a){this.tierListeners.push(a)};
        e.prototype.notifyTier=function(){for(var a=0;a<this.tierListeners.length;++a)try{this.tierListeners[a]()}catch(g){console.log(g.stack)}};e.prototype.addRegionSelectListener=function(a){this.regionSelectListeners.push(a)};e.prototype.notifyRegionSelect=function(a,g,f){for(var b=0;b<this.regionSelectListeners.length;++b)try{this.regionSelectListeners[b](a,g,f)}catch(c){console.log(c.stack)}};e.prototype.highlightRegion=function(a,g,f){var b=this;if(a==this.chr)return this._highlightRegion(a,g,f);var c=
            this.getSequenceSource();if(!c)throw"Need a sequence source";c.getSeqInfo(a,function(q){if(q)return b._highlightRegion(a,g,f);var n;n=0==a.indexOf("chr")?a.substr(3):"chr"+a;c.getSeqInfo(n,function(a){if(a)return b._highlightRegion(n,g,f)})})};e.prototype._highlightRegion=function(a,g,f){for(var b=0;b<this.highlights.length;++b){var c=this.highlights[b];if(c.chr==a&&c.min==g&&c.max==f)return}this.highlights.push(new m(a,g,f));b=this.viewStart-1E3/this.scale;c=this.viewEnd+1E3/this.scale;(a==this.chr||
            a=="chr"+this.chr)&&g<c&&f>b&&this.drawOverlays();this.notifyLocation()};e.prototype.clearHighlights=function(){this.highlights=[];this.drawOverlays();this.notifyLocation()};e.prototype.drawOverlays=function(){for(var a=0;a<this.tiers.length;++a)this.tiers[a].drawOverlay()};e.prototype.featuresInRegion=function(a,g,f){var b=[];if(a!==this.chr)return[];for(a=0;a<this.tiers.length;++a)for(var c=this.tiers[a].currentFeatures||[],q=0;q<c.length;++q){var n=c[q];n.min<=f&&n.max>=g&&b.push(n)}return b};
        e.prototype.getSelectedTier=function(){return 0<this.selectedTiers.length?this.selectedTiers[0]:-1};e.prototype.setSelectedTier=function(a){this.selectedTiers=null==a?[]:[a];this.markSelectedTiers();this.notifyTierSelection()};e.prototype.markSelectedTiers=function(){for(var a=0;a<this.tiers.length;++a){var g=this.tiers[a].nameButton;0<=this.selectedTiers.indexOf(a)?g.classList.add("active"):g.classList.remove("active")}0<this.selectedTiers.length&&(a=this.browserHolder.offsetTop+this.browserHolder.offsetHeight/
            2,a>document.body.scrollTop&&a+100<document.body.scrollTop+window.innerHeight&&this.browserHolder.focus())};e.prototype.addTierSelectionListener=function(a){this.tierSelectionListeners.push(a)};e.prototype.notifyTierSelection=function(){for(var a=0;a<this.tierSelectionListeners.length;++a)try{this.tierSelectionListeners[a](this.selectedTiers)}catch(g){console.log(g.stack)}};e.prototype.addTierSelectionWrapListener=function(a){this.tierSelectionWrapListeners.push(a)};e.prototype.notifyTierSelectionWrap=
            function(a){for(var g=0;g<this.tierSelectionWrapListeners.length;++g)try{this.tierSelectionWrapListeners[g](a)}catch(f){console.log(f.stack)}};e.prototype.positionRuler=function(){var a="none",g="",f="";"center"==this.rulerLocation?(a="block",g=""+(this.featurePanelWidth/2|0)+"px"):"left"==this.rulerLocation?(a="block",g="0px"):"right"==this.rulerLocation?(a="block",f="0px"):a="none";this.ruler.style.display=a;this.ruler.style.left=g;this.ruler.style.right=f;this.ruler2.style.display="center"==this.rulerLocation?
            "none":"block";this.ruler2.style.left=""+(this.featurePanelWidth/2|0)+"px";for(var b=0;b<this.tiers.length;++b){var c=this.tiers[b],q=c.quantOverlay,n;c.subtiers&&0<c.subtiers.length&&(n=c.subtiers[0].quant);q&&(q.style.display=n?a:"none",q.style.left=g,q.style.right=f)}};e.prototype.featureDoubleClick=function(a,g,f){if(a&&0!=a.length&&(f=a[a.length-1],f.min&&f.max)){var b=((f.min|0)-(this.viewStart|0))*this.scale,c=(f.max-f.min+1)*this.scale;a=((f.min|0)+(f.max|0))/2;10<c&&(g=1*(g-b)/c,0.3>g?a=
            f.min|0:0.7<g&&(a=(f.max|0)+1));g=this.viewEnd-this.viewStart;this.setLocation(null,a-g/2,a+g/2)}};e.prototype.zoomForScale=function(a){return 0.2<a?"high":0.01<a?"medium":"low"};e.prototype.zoomForCurrentScale=function(){return this.zoomForScale(this.scale)};e.prototype.updateHeight=function(){for(var a=0,g=0;g<this.tiers.length;++g)a+=this.tiers[g].currentHeight||30;this.ruler.style.height=""+a+"px";this.ruler2.style.height=""+a+"px"};e.prototype.scrollArrowKey=function(a,g){this.reverseKeyScrolling&&
        (g=-g);if(a.ctrlKey||a.metaKey){var f=!1;a.shiftKey&&(f=!0);this.leap(g,f)}else this.move(a.shiftKey?100*g:25*g)};e.prototype.leap=function(a,g){var f=this,b=(f.viewStart+f.viewEnd+1)/2|0;0<a&&1>=f.viewStart?b-=1E8:0>a&&f.viewEnd>=f.currentSeqMax&&(b+=1E8);var c=f.getSelectedTier();0>c||((c=f.tiers[c])&&(c.featureSource&&this.sourceAdapterIsCapable(c.featureSource,"quantLeap")&&"number"==typeof c.quantLeapThreshold||c.featureSource&&this.sourceAdapterIsCapable(c.featureSource,"leap"))?c.findNextFeature(f.chr,
            b,-a,g,function(c){if(c){var q=c.min,n=c.max;g&&(0<a?q>b+1?n=q:(n++,q=n):n<b-1?(n++,q=n):n=q);var d=f.viewEnd-f.viewStart+1;parseFloat(d/2)==parseInt(d/2)&&d--;q=(q+n-d)/2+1;f.setLocation(c.segment,q,q+d-1)}else alert("no next feature")}):this.move(100*a))};e.prototype.nameForCoordSystem=function(a){var g=null,f=null;this.assemblyNamePrimary&&(g=""+a.auth,"undefined"!==typeof a.version&&(g+=a.version));this.assemblyNameUcsc&&(f=a.ucscName);return null!=g&&null!=f?g+"/"+f:g||f||"unknown"};e.prototype.makeLoader=
            function(f){var g=1<window.devicePixelRatio;return 20>(f||16)?a("img",null,{src:this.resolveURL("$$img/spinner_"+(g?16:32)+".gif"),width:"16",height:"16"}):a("img",null,{src:this.resolveURL("$$img/spinner_"+(g?24:48)+".gif"),width:"24",height:"24"})};e.prototype.getWorker=function(){if(!this.useFetchWorkers||!this.fetchWorkers||0==this.fetchWorkers.length)return null;this.nextWorker>=this.fetchWorkers.length&&(this.nextWorker=0);return this.fetchWorkers[this.nextWorker++]};d.prototype.postCommand=
            function(a,g,f){var b="x"+ ++this.tagSeed;a.tag=b;this.callbacks[b]=g;this.worker.postMessage(a,f)};if("undefined"!==typeof y){y.exports={Browser:e,sourcesAreEqual:p,sourceDataURI:k};h("./browser-ui");h("./track-adder");h("./feature-popup");h("./tier-actions");h("./domui");h("./search");y=h("./sourceadapters");var O=y.TwoBitSequenceSource,E=y.DASSequenceSource,f=h("./kspace").KnownSpace,q=h("./das").DASRegistry}b.prototype.get=function(a){var g=this.sourcesByURI[k(a)];if(g)for(var f=0;f<g.configs.length;++f)if(p(g.configs[f],
            a))return g.sources[f]};b.prototype.put=function(a,g){var f=k(a),b=this.sourcesByURI[f];b||(b={configs:[],sources:[]},this.sourcesByURI[f]=b);b.configs.push(a);b.sources.push(g)}},{"./browser-ui":5,"./chainset":7,"./das":10,"./domui":11,"./feature-popup":17,"./kspace":21,"./numformats":24,"./search":28,"./sha1":31,"./sourceadapters":32,"./thub":38,"./tier":41,"./tier-actions":39,"./track-adder":42,"./utils":45,"./version":47,"es6-promise":48}],7:[function(h,y,r){function m(a,b,n,d){"string"==typeof a?
        (this.uri=a,this.srcTag=b,this.destTag=n,this.coords=d):(this.uri=a.uri,this.srcTag=a.srcTag,this.destTag=a.destTag,this.coords=c(a.coords),this.type=a.type,this.credentials=a.credentials);this.chainsBySrc={};this.chainsByDest={};this.postFetchQueues={};this.chainFetcher="bigbed"==this.type?new s(this.uri,this.credentials):new e(this.uri,this.srcTag,this.destTag)}function e(a,b,c){this.source=new p(a);this.srcTag=b;this.destTag=c}function s(b,c){var d=this;this.uri=b;this.credentials=c;this.bwg=new u(function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           c){a(new n(d.uri,{credentials:d.credentials}),function(a,n){a?b(a):c(n)})});this.bwg.then(function(a,b){b&&console.log(b)})}function k(a){return parseInt(a)}function x(a){var b={srcChr:a.srcChrom,srcMin:parseInt(a.srcStart),srcMax:parseInt(a.srcEnd),srcOri:a.srcOri,destChr:a.segment,destMin:a.min-1,destMax:a.max,destOri:a.ori,blocks:[]},c=a.srcStarts.split(",").map(k),n=a.destStarts.split(",").map(k);a=a.blockLens.split(",").map(k);for(var d=0;d<c.length;++d)b.blocks.push([c[d],n[d],a[d]]);return b}
        if("undefined"!==typeof h){r=h("./das");var p=r.DASSource,z=r.DASSegment;r=h("./utils");var d=r.pusho,c=r.shallowCopy,b=h("./cigar").parseCigar,n=h("./bin").URLFetchable,a=h("./bigwig").makeBwg,u=h("es6-promise").Promise}m.prototype.exportConfig=function(){return{uri:this.uri,srcTag:this.srcTag,destTag:this.destTag,coords:this.coords,type:this.type,credentials:this.credentials}};m.prototype.mapPoint=function(a,b){for(var c=this.chainsBySrc[a]||[],n=0;n<c.length;++n){var d=c[n];if(b>=d.srcMin&&b<=
            d.srcMax){var e;e="-"==d.srcOri?d.srcMax-b:b-d.srcMin;for(var p=d.blocks,u=0;u<p.length;++u){var k=p[u],h=k[0],m=k[1],k=k[2];if(e>=h&&e<=h+k)return c=e-h,{seq:d.destChr,pos:"-"==d.destOri?d.destMax-m-c:c+m+d.destMin,flipped:d.srcOri!=d.destOri}}}}return null};m.prototype.unmapPoint=function(a,b){for(var c=this.chainsByDest[a]||[],n=0;n<c.length;++n){var d=c[n];if(b>=d.destMin&&b<=d.destMax){var e;e="-"==d.srcOri?d.destMax-b:b-d.destMin;for(var p=d.blocks,u=0;u<p.length;++u){var k=p[u],h=k[0],m=k[1],
            k=k[2];if(e>=m&&e<=m+k)return c=e-m,n=c+h+d.srcMin,n="-"==d.destOri?d.srcMax-h-c:c+h+d.srcMin,{seq:d.srcChr,pos:n,flipped:d.srcOri!=d.destOri}}}}return null};m.prototype.sourceBlocksForRange=function(a,b,c,n){if(this.chainsByDest[a]){for(var e=[],p=this.chainsByDest[a]||[],u=0;u<p.length;++u){var k=p[u];if(b<=k.destMax&&c>=k.destMin){var h,m;"-"==k.srcOri?(h=k.destMax-c,m=k.destMax-b):(h=b-k.destMin,m=c-k.destMin);for(var s=k.blocks,f=0;f<s.length;++f){var q=s[f],l=q[0],g=q[1],v=q[2];m>=g&&h<=g+v&&
        (q=Math.max(h,g)-g,g=Math.min(m,g+v)-g,"-"==k.destOri?e.push(new z(k.srcChr,k.srcMax-l-g,k.srcMax-l-q)):e.push(new z(k.srcChr,k.srcMin+q+l,k.srcMin+g+l)))}}}n(e)}else{var e=!this.postFetchQueues[a],I=this;d(this.postFetchQueues,a,function(){I.sourceBlocksForRange(a,b,c,n)});e&&this.chainFetcher.fetchChains(a).then(function(g,f){I.chainsByDest||(I.chainsByDest[a]=[]);for(var b=0;b<g.length;++b){var c=g[b];d(I.chainsBySrc,c.srcChr,c);d(I.chainsByDest,c.destChr,c)}if(I.postFetchQueues[a]){b=I.postFetchQueues[a];
            for(c=0;c<b.length;++c)b[c]();I.postFetchQueues[a]=null}})}};e.prototype.fetchChains=function(a,c,n){var d=this;return new u(function(c,n){d.source.alignments(a,{},function(a){for(var n=[],t=0;t<a.length;++t)for(var e=a[t],p=0;p<e.blocks.length;++p){for(var f=e.blocks[p],q,l,g=0;g<f.segments.length;++g){var v=f.segments[g],u=e.objects[v.object];u.dbSource===d.srcTag?q=v:u.dbSource===d.destTag&&(l=v)}if(q&&l){for(var f={srcChr:e.objects[q.object].accession,srcMin:q.min|0,srcMax:q.max|0,srcOri:q.strand,
            destChr:e.objects[l.object].accession,destMin:l.min|0,destMax:l.max|0,destOri:l.strand,blocks:[]},g=b(q.cigar),v=b(l.cigar),k=u=0,h=0,w=0;h<g.length&&w<v.length;)if("M"==g[h].op&&"M"==v[w].op){var m=Math.min(g[h].cnt,v[w].cnt);f.blocks.push([u,k,m]);g[h].cnt==m?++h:g[h].cnt-=m;v[w].cnt==m?++w:v[w]-=m;u+=m;k+=m}else"I"==g[h].op?k+=g[h++].cnt:"I"==v[w].op&&(u+=v[w++].cnt);n.push(f)}}c(n)})})};s.prototype.fetchChains=function(a,b,c){return this.bwg.then(function(b,c){if(!b)throw Error("No BWG");return new u(function(c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   n){b.getUnzoomedView().readWigData(a,1,3E10,function(a){c(a.map(x))})})})};"undefined"!==typeof y&&(y.exports={Chainset:m})},{"./bigwig":3,"./bin":4,"./cigar":8,"./das":10,"./utils":45,"es6-promise":48}],8:[function(h,y,r){function m(h){for(var k=[],m;null!=(m=e.exec(h));){var p=m[1];0==p.length&&(p=1);k.push({cnt:p|0,op:m[2]})}return k}var e=RegExp("([0-9]*)([MIDS])","g");"undefined"!==typeof y&&(y.exports={parseCigar:m})},{}],9:[function(h,y,r){function m(c,b,n,a){this.red=c|0;this.green=b|0;this.blue=
        n|0;a&&(this.name=a)}function e(c){c="00"+c.toString(16);return c.substring(c.length-2)}function s(c){var b=p[c];b||((b=z.exec(c))?b=new m("0x"+b[1]|0,"0x"+b[2]|0,"0x"+b[3]|0,c):(b=d.exec(c))?b=new m(b[1]|0,b[2]|0,b[3]|0,c):(console.log("couldn't handle color: "+c),b=p.black),p[c]=b);return b}function k(c,b,n){for(var a=[],d=0;d<n.length;++d)a.push(s(n[d]));n=[];d=0;a:for(;d<c;++d){for(var t=b[0]+1*d/(c-1)*(b[b.length-1]-b[0]),e=0;e<b.length-1;++e)if(t>=b[e]&&t<=b[e+1]){var t=(t-b[e])/(b[e+1]-b[e]),
        p=a[e],e=a[e+1],e=(new m(p.red*(1-t)+e.red*t|0,p.green*(1-t)+e.green*t|0,p.blue*(1-t)+e.blue*t|0)).toSvgString();n.push(e);continue a}throw"Bad step";}return n}function x(c,b,d,a){return a?k(c,[0,0.5,1],[b,d,a]):k(c,[0,1],[b,d])}m.prototype.toSvgString=function(){this.name||(this.name="rgb("+this.red+","+this.green+","+this.blue+")");return this.name};m.prototype.toHexString=function(){return"#"+e(this.red)+e(this.green)+e(this.blue)};var p={red:new m(255,0,0,"red"),green:new m(0,255,0,"green"),blue:new m(0,
        0,255,"blue"),yellow:new m(255,255,0,"yellow"),white:new m(255,255,255,"white"),black:new m(0,0,0,"black"),gray:new m(180,180,180,"gray"),grey:new m(180,180,180,"grey")},z=/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/,d=/rgb\(([0-9]+),([0-9]+),([0-9]+)\)/;"undefined"!==typeof y&&(y.exports={makeColourSteps:k,makeGradient:x,dasColourForName:s})},{}],10:[function(h,y,r){function m(a,b,c,f){this.name=a;this.start=b;this.end=c;this.description=f}function e(a,b){var c;"string"==typeof a?(this.uri=
        a,c=b||{}):c=a||{};for(var f in c)"function"!=typeof c[f]&&(this[f]=c[f]);this.coords||(this.coords=[]);this.props||(this.props={});(this.dasBaseURI=this.uri)&&"/"!=this.dasBaseURI.substr(this.uri.length-1)&&(this.dasBaseURI+="/")}function s(){}function k(a,b,c,f,q){this.name=a;this.start=b;this.end=c;this.alphabet=f;this.seq=q}function x(){}function p(a){a&&(this.id=a)}function z(a,b){this.desc=a;this.uri=b}function d(a){this.type=a;this.objects={};this.blocks=[]}function c(){this.styles=[]}function b(){}
        function n(a,b){b=b||{};this.uri=a;this.opts=b}function a(a,b){var c=a.getElementsByTagName(b);if(0<c.length&&c[0].firstChild){c=c[0];if(1==c.childNodes.length)return c.firstChild.nodeValue;for(var f="",q=0;q<c.childNodes.length;++q)f+=c.childNodes[q].nodeValue;return f}return null}function u(a){for(var b=[],c=a.getElementsByTagName("LINK"),f=0;f<c.length;++f){var q=c[f];q.parentNode==a&&b.push(new z(q.firstChild?q.firstChild.nodeValue:"Unknown",q.getAttribute("href")))}return b}function t(a){var b=
            [];a=a.getElementsByTagName("NOTE");for(var c=0;c<a.length;++c)a[c].firstChild&&b.push(a[c].firstChild.nodeValue);return b}function w(a,b,c,f){if(window.XDomainRequest){var q=new XDomainRequest;q.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(q.responseText);b(a)};q.open("get",a)}else Date.now(),q=new XMLHttpRequest,q.onreadystatechange=function(){4==q.readyState&&(200<=q.status||0==q.status)&&b(q.responseXML,q)},q.open("get",a,!0),c&&(q.withCredentials=!0),f&&
            q.setRequestHeader("X-DAS-Authorisation",f),q.setRequestHeader("Accept","application/xml,*/*");q.send("")}function F(a){a=(""+a).toLowerCase();return"yes"===a||"true"===a}function B(a){if(!a)return!1;a=(""+a).toLowerCase();return"no"!==a||"false"!==a}function Q(a){var b=G(a);b.styles=[];for(var c=0;c<a.styles.length;++c){var f=b.styles[c]=G(a.styles[c]);f._methodRE=f._labelRE=f._typeRE=void 0;f.style=G(f.style);f.style.id=void 0;f.style._gradient=void 0}return b}if("undefined"!==typeof h){r=h("./utils");
            var G=r.shallowCopy,A=r.pusho,P=h("./color").makeColourSteps}m.prototype.toString=function(){return this.name+":"+this.start+".."+this.end};m.prototype.isBounded=function(){return this.start&&this.end};m.prototype.toDASQuery=function(){var a="segment="+this.name;this.start&&this.end&&(a+=":"+this.start+","+this.end);return a};e.prototype.entryPoints=function(a){this.doCrossDomainRequest(this.dasBaseURI+"entry_points",function(b){if(!b)return a([]);var c=[];b=b.getElementsByTagName("SEGMENT");for(var f=
            0;f<b.length;++f){var q=b[f],l=q.getAttribute("id"),g=q.getAttribute("size"),d;g?(d=1,g|=0):((d=q.getAttribute("start"))&&(d|=0),(g=q.getAttribute("stop"))&&(g|=0));var n=null;q.firstChild&&(n=q.firstChild.nodeValue);c.push(new m(l,d,g,n))}a(c)})};e.prototype.sequence=function(a,b){var c=this.dasBaseURI+"sequence?"+a.toDASQuery();this.doCrossDomainRequest(c,function(a){if(a){var c=[];a=a.getElementsByTagName("SEQUENCE");for(var l=0;l<a.length;++l){var g=a[l],d=g.getAttribute("id"),n=g.getAttribute("start"),
            t=g.getAttribute("stop"),e=null;if(g.firstChild)for(var g=g.firstChild.nodeValue,e="",p=0;;){var u=g.indexOf("\n",p);if(0<=u)e+=g.substring(p,u),p=u+1;else{e+=g.substring(p);break}}c.push(new k(d,n,t,"DNA",e))}b(c)}else b([])})};e.prototype.features=function(b,c,d){c=c||{};var f;if(this.features_uri)f=this.features_uri;else{var q=[];if(b)q.push(b.toDASQuery());else if(c.group)if(b=c.group,"string"==typeof b)q.push("group_id="+b);else for(var l=0;l<b.length;++l)q.push("group_id="+b[l]);if(c.adjacent)for(b=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            c.adjacent,"string"==typeof b&&(b=[b]),l=0;l<b.length;++l)q.push("adjacent="+b[l]);if(c.type)if("string"==typeof c.type)q.push("type="+c.type);else for(b=0;b<c.type.length;++b)q.push("type="+c.type[b]);c.maxbins&&q.push("maxbins="+c.maxbins);0<q.length?f=this.dasBaseURI+"features?"+q.join(";"):d([],"No filters specified")}this.doCrossDomainRequest(f,function(g,f){if(g){for(var b=[],c={},l=g.getElementsByTagName("SEGMENT"),q=0;q<l.length;++q){var n=l[q],e=n.getAttribute("id");c[e]={min:n.getAttribute("start"),
            max:n.getAttribute("stop")};for(var n=n.getElementsByTagName("FEATURE"),k=0;k<n.length;++k){var h=n[k],w=new x;w.segment=e;w.id=h.getAttribute("id");w.label=h.getAttribute("label");var m=a(h,"START"),z=a(h,"END");(m|0)>(z|0)?(w.min=z|0,w.max=m|0):(w.min=m|0,w.max=z|0);m=h.getElementsByTagName("TYPE");0<m.length&&(m=m[0],m.firstChild&&(w.type=m.firstChild.nodeValue),w.typeId=m.getAttribute("id"),w.typeCv=m.getAttribute("cvId"));w.type=a(h,"TYPE");!w.type&&w.typeId&&(w.type=w.typeId);w.method=a(h,"METHOD");
            (m=a(h,"ORIENTATION"))||(m="0");w.orientation=m;w.score=a(h,"SCORE");w.links=u(h);w.notes=t(h);m=h.getElementsByTagName("GROUP");for(z=0;z<m.length;++z){var A=m[z],F=new p;F.type=A.getAttribute("type");F.id=A.getAttribute("id");F.links=u(A);F.notes=t(A);w.groups?w.groups.push(F):w.groups=Array(F)}if(w.notes)for(m=0;m<w.notes.length;++m)z=w.notes[m],0==z.indexOf("Genename=")&&(A=new p,A.type="gene",A.id=z.substring(9),w.groups?w.groups.push(A):w.groups=Array(A));m=h.getElementsByTagName("PART");if(0<
                m.length){A=[];for(z=0;z<m.length;++z)A.push(m[z].getAttribute("id"));w.parts=A}m=h.getElementsByTagName("PARENT");if(0<m.length){h=[];for(z=0;z<m.length;++z)h.push(m[z].getAttribute("id"));w.parents=h}b.push(w)}}d(b,void 0,c)}else d([],"Failed request: "+(0==f.status?"server may not support CORS":"status="+f.status))},function(a){d([],a)})};e.prototype.alignments=function(b,c,n){var f=this.dasBaseURI+"alignment?query="+b;this.doCrossDomainRequest(f,function(b){if(b){var c=[];b=b.getElementsByTagName("alignment");
            for(var g=0;g<b.length;++g){for(var v=b[g],t=new d(v.getAttribute("alignType")),e=v.getElementsByTagName("alignObject"),p=0;p<e.length;++p){var k=e[p],k={id:k.getAttribute("intObjectId"),accession:k.getAttribute("dbAccessionId"),version:k.getAttribute("objectVersion"),dbSource:k.getAttribute("dbSource"),dbVersion:k.getAttribute("dbVersion")};t.objects[k.id]=k}v=v.getElementsByTagName("block");for(e=0;e<v.length;++e){for(var k=v[e],p={order:k.getAttribute("blockOrder"),segments:[]},k=k.getElementsByTagName("segment"),
                                                                                                                                                                                                                                                                                                                                                                                                                                                        u=0;u<k.length;++u){var h=k[u],h={object:h.getAttribute("intObjectId"),min:h.getAttribute("start"),max:h.getAttribute("end"),strand:h.getAttribute("strand"),cigar:a(h,"cigar")};p.segments.push(h)}t.blocks.push(p)}c.push(t)}n(c)}else n([],"Failed request "+f)})};c.prototype.pushStyle=function(a,b,c){a||(a={type:"default"});a=G(a);b&&(a.zoom=b);a.style=c;this.styles.push(a)};e.prototype.stylesheet=function(a,d){var n,f=this.credentials;this.stylesheet_uri?(n=this.stylesheet_uri,f=!1):n=this.dasBaseURI+
            "stylesheet";w(n,function(f){if(f){var l=new c;f=f.getElementsByTagName("TYPE");for(var g=0;g<f.length;++g){var n=f[g],t={};t.type=n.getAttribute("id");t.label=n.getAttribute("label");t.method=n.getAttribute("method");for(var n=n.getElementsByTagName("GLYPH"),e=0;e<n.length;++e){var k=n[e],p=k.getAttribute("zoom"),u;a:{if(k.hasChildNodes()){k=k.firstChild;do{if(k.nodeType==Node.ELEMENT_NODE){u=k;break a}k=k.nextSibling}while(null!=k)}u=null}k=new b;k.glyph=u.localName;for(u=u.firstChild;u;){if(u.nodeType==
            Node.ELEMENT_NODE)if("BGGRAD"==u.localName){var h=k,w=u.localName,m,z=u;m=(m=z.getAttribute("steps"))?m|0:50;for(var A=[],F=[],z=z.getElementsByTagName("STOP"),s=0;s<z.length;++s){var B=z[s];A.push(1*B.getAttribute("score"));F.push(B.firstChild.nodeValue)}m=P(m,A,F);h[w]=m}else k[u.localName]=u.firstChild.nodeValue;u=u.nextSibling}l.pushStyle(t,p,k)}}a(l)}else d&&d()},f)};n.prototype.sources=function(a,b,c){c||(c={});var f=[];c.taxon&&f.push("organism="+c.taxon);c.auth&&f.push("authority="+c.auth);
            c.version&&f.push("version="+c.version);c=this.uri;0<f.length&&(c=c+"?"+f.join("&"));w(c,function(f){if(!f&&b)b();else{var c=[];f=f.getElementsByTagName("SOURCE");for(var g=0;g<f.length;++g){var n=f[g],d=n.getElementsByTagName("VERSION");if(!(1>d.length)){for(var t=d[0],k=t.getElementsByTagName("COORDINATES"),d=[],p=0;p<k.length;++p){var u=k[p],h=new s;h.auth=u.getAttribute("authority");h.taxon=u.getAttribute("taxid");h.version=u.getAttribute("version");d.push(h)}for(var k=[],u=t.getElementsByTagName("CAPABILITY"),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        w,p=0;p<u.length;++p)h=u[p],k.push(h.getAttribute("type")),"das1:features"==h.getAttribute("type")&&(w=h.getAttribute("query_uri"),w=w.substring(0,w.length-8));p={};t=t.getElementsByTagName("PROP");for(u=0;u<t.length;++u)A(p,t[u].getAttribute("name"),t[u].getAttribute("value"));w&&(n=new e(w,{source_uri:n.getAttribute("uri"),name:n.getAttribute("title"),desc:n.getAttribute("description"),coords:d,props:p,capabilities:k}),c.push(n))}}a(c)}})};e.prototype.doCrossDomainRequest=function(a,b,c){var f;
            this.xUser&&(f="Basic "+btoa(this.xUser+":"+this.xPass));try{return w(a,b,this.credentials,f)}catch(n){if(c)c(n);else throw n;}};"undefined"!==typeof y&&(y.exports={DASGroup:p,DASFeature:x,DASStylesheet:c,DASStyle:b,DASSource:e,DASSegment:m,DASRegistry:n,DASSequence:k,DASLink:z,isDasBooleanTrue:F,isDasBooleanNotFalse:B,copyStylesheet:Q})},{"./color":9,"./utils":45}],11:[function(h,y,r){function m(e,k,h){function d(){h?(c.className="fa fa-caret-down",k.style.display="table"):(c.className="fa fa-caret-right",
        k.style.display="none")}var c=s("i");d();c.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();h=!h;d()},!1);e=s("h6",[c," ",e],{},{display:"block",background:"gray",color:"white",width:"100%",padding:"5px 2px",margin:"0px"});return s("div",[e,k],{})}if("undefined"!==typeof h){var e=h("./cbrowser").Browser;h=h("./utils");var s=h.makeElement,k=h.removeChildren}e.prototype.removeAllPopups=function(){k(this.hPopupHolder);k(this.popupHolder)};e.prototype.makeTooltip=function(e,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            k){var h=!1,d=this,c=null,b;b=function(a){h=!1;c&&(clearTimeout(c),c=null);e.removeEventListener("mouseout",b,!1)};var n=function(a){var b=a.clientX+window.scrollX,t=a.clientY+window.scrollY;c||(c=setTimeout(function(){var a;a="function"===typeof k?k():k;var m=s("div",[s("div",null,{className:"tooltip-arrow"}),s("div",a,{className:"tooltip-inner"})],{className:"tooltip bottom in"},{display:"block",top:""+(t+20)+"px",left:""+Math.max(b-30,20)+"px"});d.hPopupHolder.appendChild(m);var B;B=function(a){try{d.hPopupHolder.removeChild(m)}catch(b){}window.removeEventListener("mousemove",
        B,!1);h&&null!=e.offsetParent&&n(a)};window.addEventListener("mousemove",B,!1);c=null},1E3))};e.addEventListener("mouseover",function(a){h=!0;e.addEventListener("mouseout",b,!1);n(a)},!1);e.addEventListener("DOMNodeRemovedFromDocument",function(a){h=!1;c&&(clearTimeout(c),c=null)},!1)};e.prototype.popit=function(e,k,h,d){var c=this;d||(d={});e||(e={});var b=d.width||200,n;e.clientX?(d=e.clientX,n=e.clientY):(d=500,n=50);d+=document.documentElement.scrollLeft||document.body.scrollLeft;n+=document.documentElement.scrollTop||
        document.body.scrollTop;var a=window.innerWidth,u=n,t=Math.min(d-b/2-4,a-b-30),w=s("div");w.className="popover fade "+(e.clientX?"bottom ":"")+"in";w.style.display="block";w.style.position="absolute";w.style.top=""+u+"px";w.style.left=""+t+"px";w.style.width=b+"px";276<b&&(w.style.maxWidth=b+"px");w.appendChild(s("div",null,{className:"arrow"}));if(k){var m=s("button","",{className:"close"});m.innerHTML="&times;";m.addEventListener("mouseover",function(a){m.style.color="red"},!1);m.addEventListener("mouseout",
        function(a){m.style.color="black"},!1);m.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();c.removeAllPopups()},!1);e=s("h4",[s("span",k,null,{maxWidth:"200px"}),m],{},{paddingLeft:"10px",paddingRight:"10px"});var B,r,G,A;G=function(c){c.stopPropagation();c.preventDefault();t+=c.clientX-B;8>t&&(t=8);t>a-b-32&&(t=a-b-26);u+=c.clientY-r;u=Math.max(10,u);w.style.top=""+u+"px";w.style.left=""+Math.min(t,a-b-10)+"px";B=c.clientX;r=c.clientY};A=function(a){a.stopPropagation();
        a.preventDefault();window.removeEventListener("mousemove",G,!1);window.removeEventListener("mouseup",A,!1)};e.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();B=a.clientX;r=a.clientY;window.addEventListener("mousemove",G,!1);window.addEventListener("mouseup",A,!1)},!1);w.appendChild(e)}w.appendChild(s("div",h,{className:"popover-content"},{padding:"0px"}));this.hPopupHolder.appendChild(w);var P={node:w,displayed:!0};w.addEventListener("DOMNodeRemoved",function(a){a.target==
    w&&(P.displayed=!1)},!1);return P};"undefined"!==typeof y&&(y.exports={makeTreeTableSection:m})},{"./cbrowser":6,"./utils":45}],12:[function(h,y,r){function m(e){this.source=e;this.base=e.uri||"http://beta.rest.ensembl.org";this.species=e.species||"human";this.activityListeners=[];this.busy=0;this.type="string"===typeof e.type?[e.type]:e.type||["regulatory"]}if("undefined"!==typeof h){var e=h("./sourceadapters").registerSourceAdapterFactory;h=h("./das");var s=h.DASStylesheet,k=h.DASStyle,x=h.DASFeature,
        p=h.DASGroup}m.prototype.addActivityListener=function(e){this.activityListeners.push(e)};m.prototype.notifyActivity=function(){for(var e=0;e<this.activityListeners.length;++e)try{this.activityListeners[e](this.busy)}catch(d){console.log(d)}};m.prototype.getStyleSheet=function(e){var d=new s,c=new k;c.glyph="__NONE";0<=this.type.indexOf("exon")&&d.pushStyle({type:"transcript"},null,c);(0<=this.type.indexOf("exon")||0<=this.type.indexOf("transcript"))&&d.pushStyle({type:"gene"},null,c);c=new k;c.glyph=
        "BOX";c.FGCOLOR="black";c.BGCOLOR="red";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=10;d.pushStyle({type:"cds"},null,c);c=new k;c.glyph="SQUARE";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";d.pushStyle({type:"variation",method:".+_UTR_variant"},null,c);c=new k;c.glyph="TRIANGLE";c.DIRECTION="S";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";d.pushStyle({type:"variation",method:"missense_variant"},null,c);c=new k;c.glyph="TRIANGLE";c.DIRECTION="N";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";d.pushStyle({type:"variation",
        method:"splice_.+_variant"},null,c);c=new k;c.glyph="STAR";c.POINTS=6;c.BUMP="yes";c.LABEL="no";c.FGCOLOR="blue";d.pushStyle({type:"variation",method:"regulatory_region_variant"},null,c);c=new k;c.glyph="PLIMSOLL";c.BUMP="yes";c.LABEL="no";c.FGCOLOR="rgb(50,80,255)";c.STROKECOLOR="black";d.pushStyle({type:"variation"},null,c);c=new k;c.glyph="SQUARE";c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";d.pushStyle({type:"indel",method:".+_UTR_variant"},null,c);c=new k;c.glyph="TRIANGLE";
        c.DIRECTION="S";c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";d.pushStyle({type:"indel",method:"missense_variant"},null,c);c=new k;c.glyph="TRIANGLE";c.DIRECTION="N";c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";d.pushStyle({type:"indel",method:"splice_.+_variant"},null,c);c=new k;c.glyph="STAR";c.POINTS=6;c.BUMP="yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";d.pushStyle({type:"indel",method:"regulatory_region_variant"},null,c);c=new k;c.glyph="PLIMSOLL";c.BUMP=
            "yes";c.LABEL="no";c.BGCOLOR="#888888";c.FGCOLOR="red";c.STROKECOLOR="black";d.pushStyle({type:"indel"},null,c);c=new k;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="orange";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=20;d.pushStyle({type:"default"},null,c);return e(d)};m.prototype.getScales=function(){return[]};m.prototype.fetch=function(e,d,c,b,n,a,k){var t=this;d=this.base+"/feature/region/"+this.species+"/"+e+":"+d+"-"+c;c=[];for(b=0;b<this.type.length;++b)c.push("feature="+this.type[b]);c.push("content-type=application/json");
        d=d+"?"+c.join(";");var h=new XMLHttpRequest;h.onreadystatechange=function(){if(4==h.readyState)if(t.busy--,t.notifyActivity(),300<=h.status){var a="Error code "+h.status;try{var b=JSON.parse(h.response);b.error&&(a=b.error)}catch(c){}k(a,null)}else{for(var a=JSON.parse(h.response),b=[],n=0;n<a.length;++n){var d=a[n],m=[],s=new x;s.segment=e;s.min=d.start|0;s.max=d.end|0;s.type=d.feature_type||"unknown";s.id=d.ID;if(d.Parent){var r=new p;r.id=d.Parent;s.groups=[r]}d.strand&&(0>d.strand?s.orientation=
            "-":0<d.strand&&(s.orientation="+"));d.consequence_type&&(s.method=d.consequence_type);d.alt_alleles&&(m.push("Alleles="+d.alt_alleles.join("/")),1<d.alt_alleles.length&&(d.alt_alleles[1].length!=d.alt_alleles[0].length||"-"==d.alt_alleles[1])&&(s.type="indel"));0<m.length&&(s.notes=m);b.push(s)}k(null,b)}};t.busy++;t.notifyActivity();h.open("GET",d,!0);h.responseType="text";h.send("")};e("ensembl",function(e){return{features:new m(e)}})},{"./das":10,"./sourceadapters":32}],13:[function(h,y,r){if("undefined"!==
        typeof h)var m=h("./cbrowser").Browser,e=h("./utils").shallowCopy,s=h("./sha1").hex_sha1,k=h("./das").copyStylesheet;m.prototype.exportFullConfig=function(e){e={chr:this.chr,viewStart:this.viewStart|0,viewEnd:this.viewEnd|0,cookieKey:"dalliance_"+s(Date.now()),coordSystem:this.coordSystem,sources:this.exportSourceConfig(),chains:this.exportChains()};this.prefix&&(e.prefix=this.prefix);return e};m.prototype.exportChains=function(){var e={},k=this.chains||{},h;for(h in k)e[h]=k[h].exportConfig();return e};
        m.prototype.exportSourceConfig=function(h){h=[];for(var p=0;p<this.tiers.length;++p){var m=this.tiers[p],d=e(m.dasSource);d.noPersist||(d.coords=void 0,d.props=void 0,d.disabled||(d.disabled=void 0),m.config.stylesheet?(d.style=k(m.config.stylesheet).styles,d.stylesheet_uri=void 0):d.style&&(d.style=k({styles:d.style}).styles),"string"===typeof m.config.name&&(d.name=m.config.name),void 0!==m.config.height&&(d.forceHeight=m.config.height),void 0!==m.config.forceMin&&(d.forceMin=m.config.forceMin),
            m.config.forceMinDynamic&&(d.forceMinDynamic=m.config.forceMinDynamic),void 0!==m.config.forceMax&&(d.forceMax=m.config.forceMax),m.config.forceMaxDynamic&&(d.forceMaxDynamic=m.config.forceMaxDynamic),h.push(d))}return h};m.prototype.exportPageTemplate=function(e){e=e||{};return'<html>\n  <head>\n    <script language="javascript" src="'+this.resolveURL("$$dalliance-compiled.js")+'">\x3c/script>\n    <script language="javascript">\n      var dalliance_browser = new Browser('+JSON.stringify(this.exportFullConfig(e),
            null,2)+');\n    \x3c/script>\n  </head>\n  <body>\n    <div id="svgHolder">Dalliance goes here</div>\n  </body>\n<html>\n'}},{"./cbrowser":6,"./das":10,"./sha1":31,"./utils":45}],14:[function(h,y,r){if("undefined"!==typeof h){var m=h("./cbrowser").Browser;h=h("./utils");var e=h.makeElement,s=h.removeChildren}m.prototype.openExportPanel=function(){var k=this;if("export"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var h=e("div",null,{className:"export-form"}),p=e("select");p.appendChild(e("option",
        "SVG",{value:"svg"}));p.appendChild(e("option","Dalliance config",{value:"config"}));p.appendChild(e("option","Dalliance sources",{value:"sources"}));p.appendChild(e("option","Dalliance page",{value:"page"}));p.value="svg";p.addEventListener("change",function(a){s(b)},!1);h.appendChild(e("p",["Export as: ",p]));var m=e("input",null,{type:"checkbox",checked:this.exportHighlights});m.addEventListener("change",function(a){k.exportHighlights=m.checked;k.storeStatus()},!1);var d=e("input",null,{type:"checkbox",
        checked:this.exportRuler});d.addEventListener("change",function(a){k.exportRuler=d.checked;k.storeStatus()},!1);var c=e("button","Export",{className:"btn btn-primary"});c.addEventListener("click",function(a){s(b);var c,n,h;"svg"===p.value?(c=URL.createObjectURL(k.makeSVG({highlights:m.checked,ruler:d.checked?k.rulerLocation:"none"})),n="SVG",h="image/svg"):"config"===p.value?(h=JSON.stringify(k.exportFullConfig(),null,2),n=new Blob([h],{type:"text/plain"}),c=URL.createObjectURL(n),n="Configuration",
        h="text/plain"):"sources"===p.value?(h=JSON.stringify(k.exportSourceConfig(),null,2),n=new Blob([h],{type:"text/plain"}),c=URL.createObjectURL(n),n="Source array",h="text/plain"):"page"===p.value&&(n=k.exportPageTemplate(),h="text/html",n=new Blob([n],{type:h}),c=URL.createObjectURL(n),n="Page template");c&&(a=e("a","[Download]",{href:c,download:"dalliance-view.svg",type:h}),h=e("a","[Preview in browser]",{href:c,type:h,target:"_new"}),b.appendChild(e("p",[""+n+" created: ",a,h])))},!1);k.addViewListener(function(){s(b)});
        k.addTierListener(function(){s(b)});var b=e("p",""),n=e("table",[e("tr",[e("th","Include highlights",{},{width:"200px",textAlign:"right"}),e("td",m)]),e("tr",[e("th","Include vertical guideline"),e("td",d)])]);h.appendChild(n);h.appendChild(c);h.appendChild(b);"none"!==this.uiMode&&this.hideToolPanel();this.browserHolder.insertBefore(h,this.svgHolder);this.activeToolPanel=h;this.setUiMode("export")}}},{"./cbrowser":6,"./utils":45}],15:[function(h,y,r){y=h("./cbrowser");r=h("./chainset");var m=h("./sourceadapters"),
        e=h("./utils");h=h("./das");window.Browser=y.Browser;window.Chainset=r.Chainset;window.makeElement=e.makeElement;window.dalliance_registerSourceAdapterFactory=m.registerSourceAdapterFactory;window.dalliance_registerParserFactory=m.registerParserFactory;window.dalliance_makeParser=m.makeParser;window.DASFeature=h.DASFeature;window.DASGroup=h.DASGroup;window.DASStylesheet=h.DASStylesheet;window.DASStyle=h.DASStyle;window.DASSource=h.DASSource},{"./cbrowser":6,"./chainset":7,"./das":10,"./sourceadapters":32,
        "./utils":45}],16:[function(h,y,r){function m(){this.glyphs=[];this.height=0;this.quant=null}function e(a){Date.now();X=a.viewport.getContext("2d");c(a);a.padding="number"===typeof a.dasSource.padding?a.dasSource.padding:W;var g=[],f={},b={},l;for(l in a.ungroupedFeatures)for(var n=a.ungroupedFeatures[l],q=0;q<n.length;++q){var e=n[q];if(!e.parts){var t=a.styleForFeature(e);if(t)if("LINEPLOT"==t.glyph)d(f,t.id,e),b[t.id]=t;else{var h=k(e,0,t,a);h&&g.push(h)}}}for(var u in f)l=f[u],t=b[u],"LINEPLOT"==
        t.glyph&&g.push(x(l,t,a));if(a.dasSource.collapseSuperGroups&&!a.bumped)for(var p in a.superGroups){f=a.superGroups[p];a.groups[p]=z(a.groups[p]);a.groups[p].isSuperGroup=!0;b={};u=1E10;n=-1E10;q=null;for(h=0;h<f.length;++h)if(l=a.groupedFeatures[f[h]]){for(t=0;t<l.length;++t)e=l[t],d(b,e.type,e),u=Math.min(e.min,u),n=Math.max(e.max,n),e.segment&&!q&&(q=e.segment);if(a.groups[p]&&!a.groups[p].links||0==a.groups[p].links.length)a.groups[p].links=a.groups[f[0]].links;delete a.groupedFeatures[f[h]]}a.groups[p].max=
        n;a.groups[p].min=u;a.groups[p].segment=q;for(var w in b){l=b[w];u=l[0];n=null;for(t=0;t<l.length;++t)e=l[t],e=new V(e.min,e.max),n=n?H(n,e):e;n=n.ranges();for(q=0;q<n.length;++q){for(var C=n[q],I=((C.max()|0)-(C.min()|0)+1)*f.length,J=0,t=0;t<l.length;++t)if(e=l[t],(e.min|0)<=C.max()&&(e.max|0)>=C.min())var A=Math.max(e.min|0,C.min()),e=Math.min(e.max|0,C.max()),J=J+(e-A+1);var e=new M,F;for(F in u)e[F]=u[F];e.min=C.min();e.max=C.max();e.label&&1<f.length&&(e.label+=" ("+f.length+" vars)");e.visualWeight=
        1*J/I;d(a.groupedFeatures,p,e)}}delete a.superGroups[p]}F=[];for(var B in a.groupedFeatures)F.push(B);F.sort(function(g,f){var b=a.groupedFeatures[g][0].score-a.groupedFeatures[f][0].score;return 0<b?-1:0==b?0:1});w={};for(e=0;e<F.length;++e)if(B=F[e],h=s(a.groupedFeatures[B],0,a.groups[B],a,a.dasSource.collapseSuperGroups&&!a.bumped?"collapsed_gene":"tent"))h.group=a.groups[B],w[B]=h;for(p in a.superGroups){f=a.superGroups[p];B=[];u=1E10;n=-1E10;for(F=0;F<f.length;++F)e=w[f[F]],w[f[F]]=null,e&&(B.push(e),
        u=Math.min(u,e.min()),n=Math.max(n,e.max()));for(F=0;F<B.length;++F)e=B[F],g.push(new Q(e,u,n))}for(h in w)(e=w[h])&&g.push(e);p=new m;B=[];w=a.subtierMax||a.dasSource.subtierMax||a.browser.defaultSubtierMax;F=!1;e=0;a:for(;e<g.length;++e)if(h=g[e],h.bump&&(a.bumped||a.dasSource.collapseSuperGroups)){for(f=0;f<B.length;++f)if(b=B[f],b.hasSpaceFor(h)){b.add(h);continue a}B.length>=w?F=!0:(b=new m,b.add(h),B.push(b))}else p.add(h);0<p.glyphs.length&&(B=[p].concat(B));for(f=0;f<B.length;++f)b=B[f],b.quant&&
        b.glyphs.unshift(new v(b.height));for(f=0;f<B.length;++f)b=B[f],b.glyphs.sort(function(a,g){return(a.zindex||0)-(g.zindex||0)});a.subtiers=B;a.glyphCacheOrigin=a.browser.viewStart;F?a.notify("Bumping limit exceeded, use the track editor to see more features",0):a.notify()}function s(a,g,f,b,c){c=b.styleForFeature(f);var l,d=!1,q=[];g=null;for(var e=0;e<a.length;++e){var v=a[e];v.orientation&&null==g&&(g=v.orientation);!l&&v.label&&(l=v.label);var t=b.styleForFeature(v);t&&!v.parts&&(S(t.LABEL)&&(d=
        !0),(v=k(v,0,t,b,null,!0))&&q.push(v))}if(0==q.length)return null;a="flat";c&&"LINE"===c.glyph||(b.dasSource.collapseSuperGroups&&!b.bumped?"+"===g?a="collapsed+":"-"===g&&(a="collapsed-"):"+"===g?a="hat+":"-"===g&&(a="hat-"));b=null;if(l&&d||c&&(S(c.LABEL)||S(c.LABELS)))b=f.label||l;f=new n(q,a);b&&("+"===g?b=">"+b:"-"===g&&(b="<"+b),f=new u(X,f,b,!1));f.bump=!0;return f}function k(a,c,d,e,v,h){var k=e.browser.scale,p=e.browser.viewStart,m=d.glyph||"BOX",s=a.min,z=a.max,r=a.orientation,x=a.score,
        V=a.label||a.id,H=(s-p)*k,y=Math.max((z-p+1)*k,H+1),M=e.forceHeight||d.HEIGHT||v||12,L=M*=1,p=d.BUMP&&S(d.BUMP),R;if("CROSS"===m||"EX"===m||"TRIANGLE"===m||"DOT"===m||"SQUARE"===m||"STAR"===m||"PLIMSOLL"===m){var N=d.FGCOLOR||"black",s=d.BGCOLOR||"none",k=d.STROKECOLOR;d.BGITEM&&a.itemRgb?N=a.itemRgb:S(d.COLOR_BY_SCORE2)&&(z=d.BGGRAD||d._gradient,z||(z=J(50,d.COLOR1,d.COLOR2,d.COLOR3),d._gradient=z),M=a.score2,void 0==M&&N||(L=d.MIN2?1*d.MIN2:0,L=(1*(M||0)-L)/((d.MAX2?1*d.MAX2:1)-L)*z.length|0,0>
        L&&(L=0),L>=z.length&&(L=z.length-1),N=z[L]));M=e.forceHeight||d.HEIGHT||v||12;L=M*=1;v=d.SIZE||M;d.RSIZE&&(v=1*d.RSIZE*M);d.STROKETHRESHOLD&&v<1*d.STROKETHRESHOLD&&(k=null);v*=1;M=(H+y)/2;z=v/2;"EX"===m?k=new w(M,v,N):"TRIANGLE"===m?k=new F(M,v,d.DIRECTION||"N",d.LINEWIDTH||v,N,k):"DOT"===m?k=new B(M,v,N,k):"PLIMSOLL"===m?k=new C(M,v,0.2*v,N,k):"SQUARE"===m?k=new b(M-z,0,v,v,N,k):"STAR"===m?(m=5,d.POINTS&&(m=d.POINTS|0),k=new I(M,z,m,N,k)):k=new t(M,v,N);s&&"none"!=s&&5<y-H&&(H=new b(H,0,y-H,v,s),
        k=new n([H,k]));if(S(d.SCATTER)){s=e.quantMin(d);(N=e.quantMax(d))||(N=0>s?0:10);s||(s=0);e=(1*x-s)/(N-s);x=-1*s/(N-s);if(0>e||1<e)return null;e>=x?(M=Math.max(1,(e-x)*L),c=c+(1-x)*L-M):(Math.max(1,(e-x)*L),c+=(1-x)*L);R={min:s,max:N};H=0;y="undefined"!==typeof a.forceLabel?a.forceLabel:d.LABEL;Z(y)&&V&&!h&&(k=new u(X,k,V,!0,null,"above"==y?"above":"below"),"above"==y&&(H=k.textHeight+2),h=!0);k=new l(k,0,c-z-H,L)}}else if("HISTOGRAM"===m||"GRADIENT"===m&&"undefined"!==x)s=e.quantMin(d),(N=e.quantMax(d))||
        (N=0>s?0:10),s||(s=0),1*x<1*s&&(x=s),1*x>1*N&&(x=N),e=(1*x-s)/(N-s),x=-1*s/(N-s),"HISTOGRAM"===m&&(e>=x?(M=Math.max(1,(e-x)*L),c=c+(1-x)*L-M):(M=Math.max(1,(x-e)*L),c+=(1-x)*L),R={min:s,max:N}),N=d.FGCOLOR||null,s=d.BGCOLOR||d.COLOR1||"green",d.BGITEM&&a.itemRgb&&(s=a.itemRgb),x=d.ALPHA?1*d.ALPHA:null,d.BGGRAD&&(z=d.BGGRAD,L=e*z.length|0,0>L&&(L=0),L>=z.length&&(L=z.length-1),s=z[L]),d.COLOR2&&(z=d._gradient,z||(z=J(50,d.COLOR1,d.COLOR2,d.COLOR3),d._gradient=z),L=e*z.length|0,0>L&&(L=0),L>=z.length&&
        (L=z.length-1),s=z[L]),k=new b(H,c,y-H,M,s,N,x);else if("HIDDEN"===m)k=new Q(null,H,y),h=!0;else if("ARROW"===m)e=d.FGCOLOR||"purple",c=S(d.PARALLEL),s=S(d.SOUTHWEST),z=S(d.NORTHEAST),k=new O(H,y,M,e,c,s,z);else if("ANCHORED_ARROW"===m)N=d.FGCOLOR||"none",s=d.BGCOLOR||"green",k=new G(H,y,M,s,N,r),k.bump=!0;else if("SPAN"===m)N=d.FGCOLOR||"black",k=new A(H,y,M,N);else if("LINE"===m)N=d.FGCOLOR||"black",k=new P(H,y,M,d.STYLE||"solid",r,N);else if("PRIMERS"===m)N=d.FGCOLOR||"black",s=d.BGCOLOR||"red",
        k=new D(H,y,M,s,N);else if("TEXT"===m)e=d.STRING||"text",s=d.FGCOLOR||"black",k=new f(X,H,y,M,s,e);else if("TOOMANY"===m)N=d.FGCOLOR||"gray",s=d.BGCOLOR||"orange",k=new E(H,y,M,s,N);else if("POINT"===m)M=e.forceHeight||d.HEIGHT||30,s=e.quantMin(d),N=e.quantMax(d),e=(1*x-s)/(N-s),c=1*M/(N-s)*(x-1*s)|0,R={min:s,max:N},s=d.FGCOLOR||d.COLOR1||"black",d.COLOR2&&(z=d._gradient,z||(z=J(50,d.COLOR1,d.COLOR2,d.COLOR3),d._gradient=z),L=e*z.length|0,0>L&&(L=0),L>=z.length&&(L=z.length-1),s=z[L]),k=new g((H+
        y)/2,M-c,M,s);else if("__SEQUENCE"===m){m=N=a.seq;L=v=a.quals;c=S(d.__INSERTIONS);x=[];if(a.cigar)for(var r=fa(a.cigar),L=m="",W=0,la=0;la<r.length;++la){var U=r[la];if("M"==U.op)m+=N.substr(W,U.cnt),L+=v.substr(W,U.cnt),W+=U.cnt;else if("D"==U.op)for(var da=0;da<U.cnt;++da)m+="-",L+="Z";else if("I"==U.op){var pa=N.substr(W,U.cnt),da=new F(H+m.length*k,5,"S",5,"red");c&&(da=new u(X,da,pa,!1,"center","above","7px sans-serif"));da.feature={label:"Insertion: "+pa,type:"insertion",method:"insertion"};
        x.push(da);W+=U.cnt}else"S"==U.op?W+=U.cnt:console.log("unknown cigop"+U.op)}k=null;if(e.currentSequence&&(N=e.currentSequence.start|0,r=e.currentSequence.end|0,N<=z&&r>=s)){v=Math.max(s,N);r=Math.min(z,r);for(k=e.currentSequence.seq.substr(v-N,r-v+1);s<v;)k="N"+k,v--;for(;z>r;)k+="N",r++}k=new q(e.browser.baseColors,H,y,M,m,k,d.__SEQCOLOR,L);c&&(k=new l(k,0,7));0<x.length&&(x.splice(0,0,k),k=new n(x))}else if("__INSERTION"===m)da=new F(H,5,"S",5,"red"),k=new u(X,da,a.insertion||a.altAlleles[0],!1,
        "center","above","7px sans-serif"),1<y-H&&(s=d.BGCOLOR||d.COLOR1||"green",H=new b(H,5,y-H,M,s,N),k=new n([H,k]));else{if("__NONE"===m)return null;N=d.FGCOLOR||null;s=d.BGCOLOR||d.COLOR1||"green";d.BGITEM&&a.itemRgb&&(s=a.itemRgb);k=new b(H,0,y-H,M,s,N)}(S(d.LABEL)||a.forceLabel)&&V&&!h&&(k=new u(X,k,V,!1));p&&(k.bump=!0);k.feature=a;R&&(k.quant=R);d.ZINDEX&&(k.zindex=d.ZINDEX|0);return k}function x(g,f,b){var c=b.browser.viewStart,l=b.browser.scale,d=b.forceHeight||f.HEIGHT||30,n=b.quantMin(f);b=
        b.quantMax(f);for(var q=1*d/(b-n),e=f.FGCOLOR||f.COLOR1||"black",v=[],k=0;k<g.length;++k){var t=g[k],h=d-((t.score-1*n)*q|0);v.push((((t.min|0)+(t.max|0))/2-c)*l);v.push(h)}g=new a(v,e,d);g.quant={min:n,max:b};f.ZINDEX&&(g.zindex=f.ZINDEX|0);return g}if("undefined"!==typeof h){var p=h("./utils"),z=p.shallowCopy,d=p.pusho,p=h("./tier").DasTier,c=h("./features").sortFeatures;r=h("./glyphs");var b=r.BoxGlyph,n=r.GroupGlyph,a=r.LineGraphGlyph,u=r.LabelledGlyph,t=r.CrossGlyph,w=r.ExGlyph,F=r.TriangleGlyph,
        B=r.DotGlyph,Q=r.PaddedGlyph,G=r.AArrowGlyph,A=r.SpanGlyph,P=r.LineGlyph,D=r.PrimersGlyph,O=r.ArrowGlyph,E=r.TooManyGlyph,f=r.TextGlyph,q=r.SequenceGlyph,l=r.TranslatedGlyph,g=r.PointGlyph,v=r.GridGlyph,I=r.StarGlyph,C=r.PlimsollGlyph,J=h("./color").makeGradient;r=h("./spans");var V=r.Range,H=r.union;r=h("./das");var M=r.DASFeature,S=r.isDasBooleanTrue,Z=r.isDasBooleanNotFalse,fa=h("./cigar").parseCigar,R=h("./numformats").formatQuantLabel}var W=3;m.prototype.indexFor=function(a){a=a.min();for(var g=
        0,f=this.glyphs.length;f>g;){var b=(g+f)/2|0;if(b>=this.glyphs.length)return this.glyphs.length;a<this.glyphs[b].min()?f=b:g=b+1}return f};m.prototype.add=function(a){var g=this.indexFor(a);this.glyphs.splice(g,0,a);this.height=Math.max(this.height,a.height());a.quant&&null==this.quant&&(this.quant=a.quant)};m.prototype.hasSpaceFor=function(a){var g=this.indexFor(a);return 0<g&&this.glyphs[g-1].max()>=a.min()||g<this.glyphs.length&&this.glyphs[g].min()<=a.max()?!1:!0};var X;p.prototype.paint=function(){Date.now();
        var a=this.browser.retina&&1<window.devicePixelRatio,g=this.subtiers;if(g){var f=this.browser.featurePanelWidth+2E3;a&&(f*=2);var b=this.viewport.width|0;b<f-50&&(this.viewport.width=b=f);for(var c=this.padding,l=0;l<g.length;++l)c=c+g[l].height+this.padding;l=c=Math.max(c+6,this.browser.minTierHeight);a&&(l*=2);l!=this.viewport.height&&(this.viewport.height=l);Math.max(c,this.browser.minTierHeight);this.viewportHolder.style.left="-1000px";this.viewport.style.width=a?""+b/2+"px":""+b+"px";this.viewport.style.height=
            ""+c+"px";this.layoutHeight=Math.max(c,this.browser.minTierHeight);this.updateHeight();this.drawOverlay();this.norigin=this.browser.viewStart;f=this.viewport.getContext("2d");f.clearRect(0,0,b,l);f.save();a&&f.scale(2,2);var d=this.browser.viewStart-1E3/this.browser.scale,n=this.browser.viewEnd+1E3/this.browser.scale,l=[];if(this.knownCoverage)for(var q=this.knownCoverage.ranges(),e=0;e<q.length;++e){var v=q[e];0==e?v.min()>d&&l.push({min:d,max:v.min()-1}):l.push({min:q[e-1].max()+1,max:v.min()-1});
            e==q.length-1&&v.max()<n&&l.push({min:v.max()+1,max:n})}if(0<l.length)for(f.fillStyle="gray",d=0;d<l.length;++d)n=l[d],q=(n.min-this.browser.viewStart)*this.browser.scale+1E3,f.fillRect(q,0,(n.max-this.browser.viewStart)*this.browser.scale+1E3-q,c);c=(this.glyphCacheOrigin-this.browser.viewStart)*this.browser.scale+1E3;f.translate(c,this.padding);for(l=0;l<g.length;++l){for(var k=null,n=g[l].glyphs,d=0;d<n.length;++d)q=n[d],q.min()<b-c&&q.max()>-c&&(q=n[d],q.draw(f),q.quant&&(k=q.quant));f.translate(0,
                g[l].height+this.padding)}f.restore();k&&this.quantLeapThreshold&&this.featureSource&&this.browser.sourceAdapterIsCapable(this.featureSource,"quantLeap")&&(g=3+g[0].height*(1-(this.quantLeapThreshold-k.min)/(k.max-k.min)),f.save(),a&&f.scale(2,2),f.strokeStyle="red",f.lineWidth=0.3,f.beginPath(),f.moveTo(0,g),f.lineTo(5E3,g),f.stroke(),f.restore());this.paintQuant();Date.now()}};p.prototype.paintQuant=function(){if(this.quantOverlay){var a=this.browser.retina&&1<window.devicePixelRatio,g;this.subtiers&&
        0<this.subtiers.length&&(g=this.subtiers[0].quant);if(g){var f=this.subtiers[0].height;this.quantOverlay.height=this.viewport.height;this.quantOverlay.width=a?100:50;this.quantOverlay.style.height=""+(a?this.quantOverlay.height/2:this.quantOverlay.height)+"px";this.quantOverlay.style.width="50px";this.quantOverlay.style.display="block";var b=this.quantOverlay.getContext("2d");a&&b.scale(2,2);a=2;40<f&&(a=1+(f/20|0));var c=(f+2*this.padding)/(a-1),l=(g.max-g.min)/(a-1);b.fillStyle="white";b.globalAlpha=
        0.6;"right"==this.browser.rulerLocation?b.fillRect(20,0,30,f+2*this.padding):b.fillRect(0,0,30,f+2*this.padding);b.globalAlpha=1;b.strokeStyle="black";b.lineWidth=1;b.beginPath();if("right"==this.browser.rulerLocation){b.moveTo(42,this.padding);b.lineTo(50,this.padding);b.lineTo(50,f+this.padding);b.lineTo(42,f+this.padding);for(var d=1;d<a-1;++d){var n=d*c;b.moveTo(50,n);b.lineTo(45,n)}}else for(b.moveTo(8,this.padding),b.lineTo(0,this.padding),b.lineTo(0,f+this.padding),b.lineTo(8,f+this.padding),
                                                                                                                                                                                                                                                                                                                                                                                                                            d=1;d<a-1;++d)n=d*c,b.moveTo(0,n),b.lineTo(5,n);b.stroke();b.fillStyle="black";if("right"==this.browser.rulerLocation)for(b.textAlign="right",b.fillText(R(g.max),41,8),b.fillText(R(g.min),41,f+this.padding),d=1;d<a-1;++d)n=d*c,b.fillText(R(1*g.max-d*l),41,n+3);else for(b.textAlign="left",b.fillText(R(g.max),9,8),b.fillText(R(g.min),9,f+this.padding),d=1;d<a-1;++d)n=d*c,b.fillText(R(1*g.max-d*l),9,n+3)}else this.quantOverlay.style.display="none"}};p.prototype.styleForFeature=function(a){var g=this.browser.zoomForCurrentScale();
        if(!this.stylesheet)return null;for(var f=null,b=this.stylesheet.styles,c=0;c<b.length;++c){var l=b[c];if(!(l.zoom&&l.zoom!=g||l.orientation&&l.orientation!=a.orientation)){var d=l._labelRE;d&&d.test||(d=new RegExp("^"+l.label+"$"),l._labelRE=d);if(!l.label||d.test(a.label))if(d=l._methodRE,d&&d.test||(d=new RegExp("^"+l.method+"$"),l._methodRE=d),!l.method||d.test(a.method)){if(l.type)if("default"==l.type){f||(f=l.style);continue}else if(d=l._typeRE,d&&d.test||(d=new RegExp("^"+l.type+"$"),l._typeRE=
            d),!d.test(a.type))continue;return l.style}}}return f};p.prototype.quantMin=function(a){return this.forceMinDynamic?this.currentFeaturesMinScore||0:"number"===typeof this.forceMin?this.forceMin:a.MIN||this.currentFeaturesMinScore||0};p.prototype.quantMax=function(a){return this.forceMaxDynamic?this.currentFeaturesMaxScore||0:"number"===typeof this.forceMax?this.forceMax:a.MAX||this.currentFeaturesMaxScore||0};"undefined"!==typeof y&&(y.exports={drawFeatureTier:e})},{"./cigar":8,"./color":9,"./das":10,
        "./features":18,"./glyphs":19,"./numformats":24,"./spans":33,"./tier":41,"./utils":45}],17:[function(h,y,r){function m(d,c,b){var n=k(b.type,c.type),a=k(b.label,c.label,b.id,c.id);a&&0!=a.indexOf("__dazzle")&&(n=n+": "+a);this.hit=d;this.feature=c;this.group=b;this.title=n;this.sections=[]}function e(d,c){var b=[];if(d)for(var n=0;n<d.length;++n)x(b,d[n]);if(c)for(n=0;n<c.length;++n)x(b,c[n]);return b}if("undefined"!==typeof h){var s=h("./cbrowser").Browser;h=h("./utils");var k=h.pick,x=h.pushnew,
        p=h.makeElement}var z=/^([A-Za-z]+)=(.+)/;s.prototype.addFeatureInfoPlugin=function(d){this.featureInfoPlugins||(this.featureInfoPlugins=[]);this.featureInfoPlugins.push(d)};m.prototype.setTitle=function(d){this.title=d};m.prototype.add=function(d,c){"string"===typeof c&&(c=p("span",c));this.sections.push({label:d,info:c})};s.prototype.featurePopup=function(d,c,b,n){var a=b.length;c=0<=--a?b[a]:{};var k=0<=--a?b[a]:{};b=new m(b,c,k);b.tier=n;for(var a=this.featureInfoPlugins||[],t=0;t<a.length;++t)try{a[t](c,
        b)}catch(h){console.log(h.stack||h)}a=n.featureInfoPlugins||[];for(t=0;t<a.length;++t)try{a[t](c,b)}catch(s){console.log(s.stack||s)}this.removeAllPopups();n=p("table",null,{className:"table table-striped table-condensed"});n.style.width="100%";n.style.margin="0px";a=0;c.method&&(t=p("tr",[p("th","Method"),p("td",c.method)]),n.appendChild(t),++a);t=k.segment?k:c;t=p("tr",[p("th","Location"),p("td",t.segment+":"+t.min+"-"+t.max,{},{minWidth:"200px"})]);n.appendChild(t);++a;void 0!==c.score&&null!==
        c.score&&"-"!=c.score&&(t=p("tr",[p("th","Score"),p("td",""+c.score)]),n.appendChild(t),++a);(t=e(k.links,c.links))&&0<t.length&&(t=p("tr",[p("th","Links"),p("td",t.map(function(a){return p("div",p("a",a.desc,{href:a.uri,target:"_new"}))}))]),n.appendChild(t),++a);c=e(k.notes,c.notes);for(k=0;k<c.length;++k){var t="Note",B=c[k],r=B.match(z);r&&(t=r[1],B=r[2]);t=p("tr",[p("th",t),p("td",B)]);n.appendChild(t);++a}for(c=0;c<b.sections.length;++c)a=b.sections[c],n.appendChild(p("tr",[p("th",a.label),
        p("td",a.info)]));this.popit(d,b.title||"Feature",n,{width:450})}},{"./cbrowser":6,"./utils":45}],18:[function(h,y,r){function m(k){for(var h=k.browser.drawnStart,p=k.browser.drawnEnd,m={},d={},c={},b={},n={},a={},u={},t={},w=[],F,B,r,G=function(){r={};for(var a=0;a<k.currentFeatures.length;++a){var g=k.currentFeatures[a];g.id&&(r[g.id]=g)}},A=function(a){var g=[];if(a.parents)for(var f=0;f<a.parents.length;++f){var b=a.parents[f],c=r[b];c&&"SO:0000704"==c.typeCv&&pushnew(g,b)}return g},P=0;P<k.currentFeatures.length;++P){var D=
        k.currentFeatures[P];if(!D.parts){var y=D.min<=p&&D.max>=h;if(D.min&&D.max){if(D.score&&"."!=D.score&&"-"!=D.score){var E=1*D.score;if(!F||E<F)F=E;if(!B||E>B)B=E}var E=[],f=null;if(D.groups)for(var q=0;q<D.groups.length;++q){var l=D.groups[q],g=l.id;if("gene"==l.type)f=g,a[g]=l;else if("translation"!=l.type){e(d,g,D);a[g]=l;E.push(g);l=b[g];if(!l||D.min<l)b[g]=D.min;l=n[g];if(!l||D.max>l)n[g]=D.max}}if(D.parents)for(r||G(),q=0;q<D.parents.length;++q){var v=D.parents[q],I=r[v];if(I){I.parts||(I.parts=
        [D]);s(d,v,I);e(d,v,D);a[v]||(a[v]={type:I.type,id:I.id,label:I.label||I.id});E.push(v);l=b[v];if(!l||D.min<l)b[v]=D.min;l=n[v];if(!l||D.max>l)n[v]=D.max;l=A(I);0<l.length&&(f=l[0],v=r[l[0]],a[l[0]]={type:v.type,id:v.id,label:v.label||v.id},k.dasSource.collapseSuperGroups||(k.dasSource.collapseSuperGroups=!0))}}if(0==E.length)y&&e(m,D.type,D);else if(f)for(l=0;l<E.length;++l)g=E[l],s(u,f,g),t[g]=f}else w.push(D)}}for(g in d)w=a[g],"number"!==typeof w.min&&(w.min=b[g]),"number"!==typeof w.max&&(w.max=
        n[g]),n[g]>=h&&b[g]<=p&&(c[g]=d[g]);k.ungroupedFeatures=m;k.groupedFeatures=c;k.groups=a;k.superGroups=u;k.groupsToSupers=t;F&&(0<F?F=0:0>B&&(B=0),k.currentFeaturesMinScore=F,k.currentFeaturesMaxScore=B)}if("undefined"!==typeof h){h=h("./utils");var e=h.pusho,s=h.pushnewo}"undefined"!==typeof y&&(y.exports={sortFeatures:m})},{"./utils":45}],19:[function(h,y,r){function m(a,f){this._stroke=a;this._fill=f}function e(a,f,b,c,l,d,n,q){this.x=a;this.y=f;this._width=b;this._height=c;this.fill=l;this.stroke=
        d;this._alpha=n;this._radius=q||0}function s(a,f){this.glyphs=a;this.connector=f;this.h=a[0].height();for(var b=[],c=0;c<a.length;++c){var l=a[c];b.push(new E(l.min(),l.max()));this.h=Math.max(this.h,l.height())}this.coverage=O(b)}function k(a,f,b){this.points=a;this.color=f;this._height=b||50}function x(a,f,b,c,l,d,n){this.glyph=f;this.text=b;this.anchor=l||"left";this.align=d||"below";n&&(this.font=n);this.font&&(a.save(),a.font=this.font);b=a.measureText(b);this.font&&a.restore();this.textLen=
        b.width;this.textHeight=5;this.bump=f.bump;this.measured=!c}function p(a,f,b){this._x=a;this._height=f;this._stroke=b}function z(a,f,b){this._x=a;this._height=f;this._stroke=b}function d(a,f,b,c,l,d){m.call(this,d,l);this._x=a;this._height=f;this._dir=b;this._width=c}function c(a,f,b,c){this._x=a;this._height=f;this._fill=b;this._stroke=c}function b(a,f,b){this.glyph=a;this._min=f;this._max=b;a&&(this.bump=a.bump)}function n(a,f,b,c,l,d){m.call(this,l,c);this._min=a;this._max=f;this._height=b;this._ori=
        d}function a(a,f,b,c){m.call(this,c,null);this._min=a;this._max=f;this._height=b}function u(a,f,b,c,l,d){this._min=a;this._max=f;this._height=b;this._style=c;this._strand=l;this._stroke=d}function t(a,f,b,c,l){this._min=a;this._max=f;this._height=b;this._fill=c;this._stroke=l}function w(a,f,b,c,l,d,n){m.call(this,null,c);this._min=a;this._max=f;this._height=b;this._color=c;this._parallel=l;this._sw=d;this._ne=n}function F(a,f,b,c,l){this._min=a;this._max=f;this._height=b;this._fill=c;this._stroke=
        l}function B(a,f,b,c,l,d){this._min=f;this._max=b;this._height=c;this._fill=l;this._string=d;this._textLen=a.measureText(d).width}function Q(a,f,b,c){this.glyph=a;this._height=c;this._x=f;this._y=b}function G(a,f,b,c){this._x=a;this._y=f;this._height=b;this._fill=c}function A(a){this._height=a||50}function P(a,f,b,c,l){m.call(this,l,c);this._x=a;this._r=f;this._points=b}function D(a,f,b,c,l){this._x=a;this._height=f;this._overhang=b;this._fill=c;this._stroke=l;this._hh=f/2}if("undefined"!==typeof h){r=
        h("./spans");var O=r.union,E=r.Range,f=h("./utils").makeElementNS;h=h("./svg-utils");var q=h.NS_SVG,l=h.SVGPath}m.prototype.draw=function(a){a.beginPath();this.drawPath(a);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};m.prototype.toSVG=function(){var a=new l;this.drawPath(a);return f(q,"path",null,{d:a.toPathData(),fill:this._fill||"none",stroke:this._stroke||"none"})};m.prototype.drawPath=function(a){throw"drawPath method on PathGlyphBase must be overridden";
    };e.prototype.draw=function(a){var f=this._radius;0<f?(a.beginPath(),a.moveTo(this.x+f,this.y),a.lineTo(this.x+this._width-f,this.y),a.arcTo(this.x+this._width,this.y,this.x+this._width,this.y+f,f),a.lineTo(this.x+this._width,this.y+this._height-f),a.arcTo(this.x+this._width,this.y+this._height,this.x+this._width-f,this.y+this._height,f),a.lineTo(this.x+f,this.y+this._height),a.arcTo(this.x,this.y+this._height,this.x,this.y+this._height-f,f),a.lineTo(this.x,this.y+f),a.arcTo(this.x,this.y,this.x+
        f,this.y,f),a.closePath(),null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fill()),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.stroke())):(null!=this._alpha&&(a.save(),a.globalAlpha=this._alpha),this.fill&&(a.fillStyle=this.fill,a.fillRect(this.x,this.y,this._width,this._height)),this.stroke&&(a.strokeStyle=this.stroke,a.lineWidth=0.5,a.strokeRect(this.x,this.y,this._width,this._height)));null!=this._alpha&&a.restore()};e.prototype.toSVG=function(){var a=
        f(q,"rect",null,{x:this.x,y:this.y,width:this._width,height:this._height,stroke:this.stroke||"none",strokeWidth:0.5,fill:this.fill||"none"});null!=this._alpha&&a.setAttribute("opacity",this._alpha);return a};e.prototype.min=function(){return this.x};e.prototype.max=function(){return this.x+this._width};e.prototype.height=function(){return this.y+this._height};s.prototype.drawConnectors=function(a){for(var f=this.coverage.ranges(),b=1;b<f.length;++b){var c=f[b],l=f[b-1];if(l&&c.min()>l.max()){var l=
        l.max(),c=c.min(),d=(l+c)/2;"hat+"===this.connector?(a.moveTo(l,this.h/2),a.lineTo(d,0),a.lineTo(c,this.h/2)):"hat-"===this.connector?(a.moveTo(l,this.h/2),a.lineTo(d,this.h),a.lineTo(c,this.h/2)):"collapsed+"===this.connector?(a.moveTo(l,this.h/2),a.lineTo(c,this.h/2),4<c-l&&(a.moveTo(d-2,this.h/2-3),a.lineTo(d+2,this.h/2),a.lineTo(d-2,this.h/2+3))):"collapsed-"===this.connector?(a.moveTo(l,this.h/2),a.lineTo(c,this.h/2),4<c-l&&(a.moveTo(d+2,this.h/2-3),a.lineTo(d-2,this.h/2),a.lineTo(d+2,this.h/
        2+3))):(a.moveTo(l,this.h/2),a.lineTo(c,this.h/2))}}};s.prototype.draw=function(a){for(var f=0;f<this.glyphs.length;++f)this.glyphs[f].draw(a);a.strokeStyle="black";a.beginPath();this.drawConnectors(a);a.stroke()};s.prototype.toSVG=function(){for(var a=f(q,"g"),b=0;b<this.glyphs.length;++b)a.appendChild(this.glyphs[b].toSVG());b=new l;this.drawConnectors(b);0<b.toPathData().length&&(b=f(q,"path",null,{d:b.toPathData(),fill:"none",stroke:"black",strokeWidth:0.5}),a.appendChild(b));return a};s.prototype.min=
        function(){return this.coverage.min()};s.prototype.max=function(){return this.coverage.max()};s.prototype.height=function(){return this.h};k.prototype.min=function(){return this.points[0]};k.prototype.max=function(){return this.points[this.points.length-2]};k.prototype.height=function(){return this._height};k.prototype.draw=function(a){a.save();a.strokeStyle=this.color;a.lineWidth=2;a.beginPath();for(var f=0;f<this.points.length;f+=2){var b=this.points[f],c=this.points[f+1];0==f?a.moveTo(b,c):a.lineTo(b,
        c)}a.stroke();a.restore()};k.prototype.toSVG=function(){for(var a=new l,b=0;b<this.points.length;b+=2){var c=this.points[b],d=this.points[b+1];0==b?a.moveTo(c,d):a.lineTo(c,d)}return f(q,"path",null,{d:a.toPathData(),fill:"none",stroke:this.color,strokeWidth:"2px"})};x.prototype.toSVG=function(){var a=this.glyph.toSVG(),b={};"above"==this.align?(a=f(q,"g",a,{transform:"translate(0, "+(this.textHeight|2)+")"}),b.y=this.textHeight):b.y=this.glyph.height()+15;this.font&&(b.fontSize=7);b.x="center"==
        this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();return f(q,"g",[a,f(q,"text",this.text,b)])};x.prototype.min=function(){return this.glyph.min()};x.prototype.max=function(){return this.measured?Math.max(this.glyph.max(),1*this.glyph.min()+this.textLen+10):this.glyph.max()};x.prototype.height=function(){var a=this.glyph.height();this.measured&&(a="above"==this.align?a+(this.textHeight+2):a+20);return a};x.prototype.draw=function(a){"above"==this.align&&(a.save(),a.translate(0,
            this.textHeight+2));this.glyph.draw(a);"above"==this.align&&a.restore();a.fillStyle="black";this.font&&(a.save(),a.font=this.font);var f;f="center"==this.anchor?(this.glyph.min()+this.glyph.max()-this.textLen)/2:this.glyph.min();a.fillText(this.text,f,"above"==this.align?this.textHeight:this.glyph.height()+15);this.font&&a.restore()};p.prototype.draw=function(a){var f=this._height/2;a.beginPath();a.moveTo(this._x,0);a.lineTo(this._x,this._height);a.moveTo(this._x-f,f);a.lineTo(this._x+f,f);a.strokeStyle=
        this._stroke;a.lineWidth=1;a.stroke()};p.prototype.toSVG=function(){var a=this._height/2,b=new l;b.moveTo(this._x,0);b.lineTo(this._x,this._height);b.moveTo(this._x-a,a);b.lineTo(this._x+a,a);return f(q,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};p.prototype.min=function(){return this._x-this._height/2};p.prototype.max=function(){return this._x+this._height/2};p.prototype.height=function(){return this._height};z.prototype.draw=function(a){var f=this._height/
        2;a.beginPath();a.moveTo(this._x-f,0);a.lineTo(this._x+f,this._height);a.moveTo(this._x-f,this._height);a.lineTo(this._x+f,0);a.strokeStyle=this._stroke;a.lineWidth=1;a.stroke()};z.prototype.toSVG=function(){var a=this._height/2,b=new l;b.moveTo(this._x-a,0);b.lineTo(this._x+a,this._height);b.moveTo(this._x-a,this._height);b.lineTo(this._x+a,0);return f(q,"path",null,{d:b.toPathData(),fill:"none",stroke:this._stroke,strokeWidth:"1px"})};z.prototype.min=function(){return this._x-this._height/2};z.prototype.max=
        function(){return this._x+this._height/2};z.prototype.height=function(){return this._height};d.prototype=Object.create(m.prototype);d.prototype.drawPath=function(a){var f=this._height/2,b=this._width/2;"S"===this._dir?(a.moveTo(this._x,this._height),a.lineTo(this._x-b,0),a.lineTo(this._x+b,0)):"W"===this._dir?(a.moveTo(this._x+b,f),a.lineTo(this._x-b,0),a.lineTo(this._x-b,this._height)):"E"===this._dir?(a.moveTo(this._x-b,f),a.lineTo(this._x+b,0),a.lineTo(this._x+b,this._height)):(a.moveTo(this._x,
        0),a.lineTo(this._x+b,this._height),a.lineTo(this._x-b,this._height));a.closePath()};d.prototype.min=function(){return this._x-this._height/2};d.prototype.max=function(){return this._x+this._height/2};d.prototype.height=function(){return this._height};c.prototype.draw=function(a){var f=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,f,f,0,6.29);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};c.prototype.toSVG=function(){var a=
        this._height/2;return f(q,"circle",null,{cx:this._x,cy:a,r:a,fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};c.prototype.min=function(){return this._x-this._height/2};c.prototype.max=function(){return this._x+this._height/2};c.prototype.height=function(){return this._height};b.prototype.draw=function(a){this.glyph&&this.glyph.draw(a)};b.prototype.toSVG=function(){return this.glyph?this.glyph.toSVG():f(q,"g")};b.prototype.min=function(){return this._min};b.prototype.max=function(){return this._max};
        b.prototype.height=function(){return this.glyph?this.glyph.height():1};n.prototype=Object.create(m.prototype);n.prototype.min=function(){return this._min};n.prototype.max=function(){return this._max};n.prototype.height=function(){return this._height};n.prototype.drawPath=function(a){var f=this._max,b=this._min,c=this._height,l=0,d=0,n=this._height+2,q=0.333333*this._height;this._ori&&("+"===this._ori?d=0.5*this._height:"-"===this._ori&&(l=0.5*this._height));f-b<n&&(b=(f+b-n)/2,f=b+n);a.moveTo(b+l,
                0+q);a.lineTo(f-d,0+q);a.lineTo(f-d,0);a.lineTo(f,0+this._height/2);a.lineTo(f-d,0+c);a.lineTo(f-d,0+q+q);a.lineTo(b+l,0+q+q);a.lineTo(b+l,0+c);a.lineTo(b,0+c/2);a.lineTo(b+l,0);a.lineTo(b+l,0+q)};a.prototype=Object.create(m.prototype);a.prototype.min=function(){return this._min};a.prototype.max=function(){return this._max};a.prototype.height=function(){return this._height};a.prototype.drawPath=function(a){var f=this._min,b=this._max,c=this._height,l=c/2;a.moveTo(f,l);a.lineTo(b,l);a.moveTo(f,0);
            a.lineTo(f,c);a.moveTo(b,0);a.lineTo(b,c)};u.prototype.min=function(){return this._min};u.prototype.max=function(){return this._max};u.prototype.height=function(){return this._height};u.prototype.drawPath=function(a){var f=this._min,b=this._max,c=this._height,l=c/2;"hat"===this._style?(a.moveTo(f,l),a.lineTo((f+b)/2,"-"===this._strand?c:0)):a.moveTo(f,l);a.lineTo(b,l)};u.prototype.draw=function(a){a.beginPath();this.drawPath(a);a.strokeStyle=this._stroke;"dashed"===this._style&&a.setLineDash?(a.save(),
            a.setLineDash([3]),a.stroke(),a.restore()):a.stroke()};u.prototype.toSVG=function(){var a=new l;this.drawPath(a);a={d:a.toPathData(),stroke:this._stroke||"none"};"dashed"===this._style&&(a.strokeDasharray="3");return f(q,"path",null,a)};t.prototype.min=function(){return this._min};t.prototype.max=function(){return this._max};t.prototype.height=function(){return this._height};t.prototype.drawStemPath=function(a){var f=this._max,b=this._height/2;a.moveTo(this._min,b);a.lineTo(f,b)};t.prototype.drawTrigsPath=
            function(a){var f=this._min,b=this._max,c=this._height,l=c/2;a.moveTo(f,0);a.lineTo(f+c,l);a.lineTo(f,c);a.lineTo(f,0);a.moveTo(b,0);a.lineTo(b-c,l);a.lineTo(b,c);a.lineTo(b,0)};t.prototype.draw=function(a){a.beginPath();this.drawStemPath(a);a.strokeStyle=this._stroke;a.stroke();a.beginPath();this.drawTrigsPath(a);a.fillStyle=this._fill;a.fill()};t.prototype.toSVG=function(){var a=new l;this.drawStemPath(a);var b=new l;this.drawTrigsPath(b);return f(q,"g",[f(q,"path",null,{d:a.toPathData(),stroke:this._stroke||
            "none"}),f(q,"path",null,{d:b.toPathData(),fill:this._fill||"none"})])};w.prototype=Object.create(m.prototype);w.prototype.min=function(){return this._min};w.prototype.max=function(){return this._max};w.prototype.height=function(){return this._height};w.prototype.drawPath=function(a){var f=this._min,b=this._max,c=this._height;if(this._parallel){var l=c/2,d=0.4*c;this._sw?(a.moveTo(f+l,c-d),a.lineTo(f+l,c),a.lineTo(f,l),a.lineTo(f+l,0),a.lineTo(f+l,d)):(a.moveTo(f,c-d),a.lineTo(f,d));this._ne?(a.lineTo(b-
            l,d),a.lineTo(b-l,0),a.lineTo(b,l),a.lineTo(b-l,c),a.lineTo(b-l,c-d)):(a.lineTo(b,d),a.lineTo(b,c-d))}else{var l=(f+b)/2,d=0.4*(b-f),n=c/3;this._ne?(a.moveTo(f+d,n),a.lineTo(f,n),a.lineTo(l,0),a.lineTo(b,n),a.lineTo(b-d,n)):(a.moveTo(f+d,0),a.lineTo(b-d,0));this._sw?(a.lineTo(b-d,c-n),a.lineTo(b,c-n),a.lineTo(l,c),a.lineTo(f,c-n),a.lineTo(f+d,c-n)):(a.lineTo(b-d,c),a.lineTo(f+d,c))}a.closePath()};F.prototype.min=function(){return this._min};F.prototype.max=function(){return this._max};F.prototype.height=
            function(){return this._height};F.prototype.toSVG=function(){return f(q,"rect",null,{x:this._min,y:0,width:this._max-this._min,height:this._height,stroke:this._stroke||"none",fill:this._fill||"none"})};F.prototype.draw=function(a){this._fill&&(a.fillStyle=this._fill,a.fillRect(this._min,0,this._max-this._min,this._height));if(this._stroke){a.strokeStyle=this._stroke;a.strokeRect(this._min,0,this._max-this._min,this._height);a.beginPath();for(var f=2;f<this._height;f+=3)a.moveTo(this._min,f),a.lineTo(this._max,
            f);a.stroke()}};B.prototype.min=function(){return this._min};B.prototype.max=function(){return Math.max(this._max,this._min+this._textLen)};B.prototype.height=function(){return this._height};B.prototype.draw=function(a){a.fillStyle=this._fill;a.fillText(this._string,this._min,this._height-4)};B.prototype.toSVG=function(){return f(q,"text",this._string,{x:this._min,y:this._height-4})};(function(a){function b(a,f,c,g,l,d,n,q){this.baseColors=a;this._min=f;this._max=c;this._height=g;this._seq=l;this._ref=
            d;this._scheme=n;this._quals=q}var c=1<window.devicePixelRatio,l={};b.prototype.min=function(){return this._min};b.prototype.max=function(){return this._max};b.prototype.height=function(){return this._height};b.prototype.alphaForQual=function(a){return 0.1+0.9*Math.max(0,Math.min(1*a/30,1))};b.prototype.draw=function(a){for(var f=this._seq,b=f?f.length:this._max-this._min+1,g=(this._max-this._min+1)/b,d=0;d<b;++d){var n=f?f.substr(d,1).toUpperCase():"N",q=this.baseColors[n];q||(q="gray");"mismatch"===
        this._scheme&&this._ref&&(q=this._ref.substr(d,1).toUpperCase(),q="N"===q?"gray":q===n?"black":"red");if(this._quals){var e=this._quals.charCodeAt(d)-33,k=a.globalAlpha;a.globalAlpha=this.alphaForQual(e)}if(8<=g){var e=q+"_"+n,t=l[e];if(!t){t=document.createElement("canvas");c?(t.width=16,t.height=20):(t.width=8,t.height=10);var h=t.getContext("2d");c&&h.scale(2,2);h.fillStyle=q;h.fillText(n,0,8);l[e]=t}c?a.drawImage(t,this._min+d*g,0,8,10):a.drawImage(t,this._min+d*g,0)}else a.fillStyle=q,a.fillRect(this._min+
            d*g,0,g,this._height);this._quals&&(a.globalAlpha=k)}};b.prototype.toSVG=function(){for(var a=this._seq,b=(this._max-this._min+1)/this._seq.length,c=f(q,"g"),g=0;g<a.length;++g){var l=a.substr(g,1).toUpperCase(),d=baseColors[l];d||(d="gray");"mismatch"===this._scheme&&this._ref&&(d=this._ref.substr(g,1).toUpperCase(),d="N"===d?"gray":d===l?"black":"red");var n=1;this._quals&&(n=this._quals.charCodeAt(g)-33,n=this.alphaForQual(n));8<=b?c.appendChild(f(q,"text",l,{x:this._min+g*b,y:8,fill:d,fillOpacity:n})):
            c.appendChild(f(q,"rect",null,{x:this._min+g*b,y:0,width:b,height:this._height,fill:d,fillOpacity:n}))}return c};a.SequenceGlyph=b})(this);Q.prototype.height=function(){return this._height?this._height:this.glyph.height()+this._y};Q.prototype.min=function(){return this.glyph.min()+this._x};Q.prototype.max=function(){return this.glyph.max()+this._x};Q.prototype.minY=function(){return this._y};Q.prototype.maxY=function(){return this._y+this.glyph.height()};Q.prototype.draw=function(a){a.save();a.translate(this._x,
            this._y);this.glyph.draw(a);a.restore()};Q.prototype.toSVG=function(){var a=this.glyph.toSVG();a.setAttribute("transform","translate("+this._x+","+this._y+")");return a};G.prototype.min=function(){return this._x-2};G.prototype.max=function(){return this._x+2};G.prototype.height=function(){return this._height};G.prototype.draw=function(a){a.save();a.globalAlpha=0.3;a.fillStyle=this._fill;a.beginPath();a.arc(this._x,this._y,1.5,0,6.29);a.fill();a.restore()};G.prototype.toSVG=function(){return f(q,"circle",
            null,{cx:this._x,cy:this._y,r:2,fill:this._fill,stroke:"none"})};A.prototype.notSelectable=!0;A.prototype.min=function(){return-1E5};A.prototype.max=function(){return 1E5};A.prototype.height=function(){return this._height};A.prototype.draw=function(a){a.save();a.strokeStyle="black";a.lineWidth=0.1;a.beginPath();for(var f=0;f<=this._height;f+=10)a.moveTo(-5E3,f),a.lineTo(5E3,f);a.stroke();a.restore()};A.prototype.toSVG=function(){for(var a=new l,b=0;b<=this._height;b+=10)a.moveTo(-5E3,b),a.lineTo(5E3,
            b);return f(q,"path",null,{d:a.toPathData(),fill:"none",stroke:"black",strokeWidth:"0.1px"})};P.prototype=Object.create(m.prototype);P.prototype.min=function(){return this._x-this._r};P.prototype.max=function(){return this._x+this._r};P.prototype.height=function(){return 2*this._r};P.prototype.drawPath=function(a){for(var f=this._x,b=this._r,c=this._r,l=0;l<this._points;++l){var d=6.28*l/this._points,n=f+c*Math.sin(d),d=b-c*Math.cos(d);0==l?a.moveTo(n,d):a.lineTo(n,d);d=6.28*(l+0.5)/this._points;
            n=f+0.4*c*Math.sin(d);d=b-0.4*c*Math.cos(d);a.lineTo(n,d)}a.closePath()};D.prototype.draw=function(a){var f=this._height/2;a.fillStyle=this._stroke;a.beginPath();a.arc(this._x,f,f-this._overhang,0,6.29);a.moveTo(this._x,0);a.lineTo(this._x,this._height);this._fill&&(a.fillStyle=this._fill,a.fill());this._stroke&&(a.strokeStyle=this._stroke,a.stroke())};D.prototype.toSVG=function(){var a=this._hh;return f(q,"g",[f(q,"circle",null,{cx:this._x,cy:a,r:a-this._overhang}),f(q,"line",null,{x1:this._x,y1:0,
            x2:this._x,y2:this._height})],{fill:this._fill||"none",stroke:this._stroke||"none",strokeWidth:"1px"})};D.prototype.min=function(){return this._x-this._hh};D.prototype.max=function(){return this._x+this._hh};D.prototype.height=function(){return this._height};"undefined"!==typeof y&&(y.exports={BoxGlyph:e,GroupGlyph:s,LineGraphGlyph:k,LabelledGlyph:x,CrossGlyph:p,ExGlyph:z,TriangleGlyph:d,DotGlyph:c,PaddedGlyph:b,AArrowGlyph:n,SpanGlyph:a,LineGlyph:u,PrimersGlyph:t,ArrowGlyph:w,TooManyGlyph:F,TextGlyph:B,
            SequenceGlyph:this.SequenceGlyph,TranslatedGlyph:Q,GridGlyph:A,StarGlyph:P,PointGlyph:G,PlimsollGlyph:D})},{"./spans":33,"./svg-utils":35,"./utils":45}],20:[function(h,y,r){function m(e,k){this.base=e;this.query=k}if("undefined"!==typeof h)var e=h("./das").DASFeature;m.prototype.features=function(h,k,m){url=this.base+"/features/"+h.name;k=[];this.query&&k.push(this.query);h.isBounded&&(k.push("start="+h.start),k.push("end="+h.end));0<k.length&&(url=url+"?"+k.join("&"));var p=new XMLHttpRequest;p.onreadystatechange=
        function(){if(4==p.readyState)if(300<=p.status)m(null,"Error code "+p.status);else{var k=JSON.parse(p.response).features,d=[];for(fi=0;fi<k.length;++fi){var c=k[fi],b=new e;b.segment=h;b.min=(c.start|0)+1;b.max=c.end|0;c.name&&(b.label=c.name);b.type=c.type||"unknown";d.push(b)}m(d)}};p.open("GET",url,!0);p.responseType="text";p.send("")};"undefined"!==typeof y&&(y.exports={JBrowseStore:m})},{"./das":10}],21:[function(h,y,r){function m(){this.reqs=[];this.awaitedFeatures={}}function e(a,b,c,d,n,f,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  q){this.chr=a;this.min=b;this.max=c;this.coverage=q;this.scale=d;this.features=n||[];this.status=f}function s(a,b,c,d,n,f){this.tierMap=a;this.chr=b;this.min=c;this.max=d;this.scale=n;this.seqSource=f||new u;this.viewCount=0;this.featureCache={};this.latestViews={}}function k(a,b,c){for(var d=[],n={},f=0;f<a.length;++f){var q=a[f];q.min&&q.max?q.groups&&0<q.groups.length?p(n,q.groups[0].id,q):q.min<=c&&q.max>=b&&d.push(q):d.push(q)}for(var l in n){a=n[l];for(var g=1E11,e=-1E11,f=0;f<a.length;++f)q=
        a[f],g=Math.min(g,q.min),e=Math.max(e,q.max);if(g<=c||e>=b)for(f=0;f<a.length;++f)d.push(a[f])}return d}if("undefined"!==typeof h){r=h("./utils");var x=r.Awaited,p=r.pusho;r=h("./sourceadapters");var z=r.MappedFeatureSource,d=r.CachingFeatureSource,c=r.BWGFeatureSource,b=r.RemoteBWGFeatureSource,n=r.BAMFeatureSource,a=r.RemoteBAMFeatureSource,u=r.DummySequenceSource,t=r.DummyFeatureSource,w=h("./overlay").OverlayFeatureSource;r=h("./spans");var F=r.Range,B=r.intersection,Q=h("./sample").downsample,
        G=h("./das").DASSequence}m.prototype.addRequest=function(a){this.reqs.push(a)};m.prototype.abortAll=function(){for(var a=0;a<this.reqs.length;++a)this.reqs[a].abort()};e.prototype.toString=function(){return this.chr+":"+this.min+".."+this.max+";scale="+this.scale};s.prototype.bestCacheOverlapping=function(a,b,c){return(a=this.featureCache[this.tierMap[0]])?a:null};s.prototype.viewFeatures=function(a,b,c,d){if(d!=d)throw"viewFeatures called with silly scale";if(a!=this.chr)throw"Can't extend Known Space to a new chromosome";
        1>b&&(b=1);this.min=b;this.max=c;this.scale=d;this.pool&&this.pool.abortAll();this.pool=new m;this.awaitedSeq=new x;this.seqWasFetched=!1;this.viewCount++;this.startFetchesForTiers(this.tierMap)};s.prototype.invalidate=function(a){this.pool&&(this.featureCache[a]=null,this.startFetchesForTiers([a]))};s.prototype.startFetchesForTiers=function(a){for(var b=this,c=this.awaitedSeq,d=!1,n,f=0;f<a.length;++f)try{this.startFetchesFor(a[f],c)&&(d=!0)}catch(q){a[f].updateStatus(q),console.log("Error fetching tier source"),
        console.log(q),n=q}if(d&&!this.seqWasFetched){this.seqWasFetched=!0;var l=this.min,g=this.max;if(this.cs&&this.cs.start<=l&&this.cs.end>=g)return a=this.cs.start==l&&this.cs.end==g?this.cs:new G(this.cs.name,l,g,this.cs.alphabet,this.cs.seq.substring(l-this.cs.start,g+1-this.cs.start)),c.provide(a);this.seqSource.fetch(this.chr,l,g,this.pool,function(a,f){if(f){if(!b.cs||l<=b.cs.start&&g>=b.cs.end||l>=b.cs.end||g<=b.cs.start||g-l>b.cs.end-b.cs.start)b.cs=f;c.provide(f)}else console.log("Sequence loading failed",
        a),c.provide(null)})}if(n)throw n;};s.prototype.startFetchesFor=function(a,b){var c=this,d=this.viewCount,n=a.getSource()||new t,f=a.needsSequence(this.scale),q=c.featureCache[a],l=a.getDesiredTypes(this.scale),g=this.chr,h=this.min,p=this.max;if(void 0===l)return!1;if(q&&q.chr===this.chr&&q.min<=h&&q.max>=p){var u=q.features;if(q.min<h||q.max>p)u=k(u,h,p);c.provision(a,q.chr,B(q.coverage,new F(h,p)),q.scale,l,u,q.status,f?b:null);u=n.getScales();if(q.scale<=this.scale||!u)return f}n.instrument&&
    console.log("Starting  fetch "+d+" ("+h+", "+p+")");n.fetch(g,h,p,this.scale,l,this.pool,function(k,t,u,m){n.instrument&&console.log("Finishing fetch "+d);if(!((c.latestViews[a]||-1)>d)){m||(m=new F(h,p));if(!q||h<q.min||p>q.max)c.featureCache[a]=new e(g,h,p,u,t,k,m);c.latestViews[a]=d;c.provision(a,g,m,u,l,t,k,f?b:null)}});return f};s.prototype.provision=function(e,k,t,h,p,f,q,l){e.updateStatus(q);if(!q){q=!1;for(var g=e.getSource();z.prototype.isPrototypeOf(g)||d.prototype.isPrototypeOf(g)||w.prototype.isPrototypeOf(g);)g=
        w.prototype.isPrototypeOf(g)?g.sources[0]:g.source;if(c.prototype.isPrototypeOf(g)||b.prototype.isPrototypeOf(g)||n.prototype.isPrototypeOf(g)||a.prototype.isPrototypeOf(g))q=!0;if(!g.opts||!g.opts.forceReduction&&!g.opts.noDownsample)if(h<this.scale/2&&200<f.length||q&&p&&1==p.length&&0<=p.indexOf("density"))f=Q(f,this.scale);l?l.await(function(a){e.viewFeatures(k,t,h,f,a)}):e.viewFeatures(k,t,h,f)}};"undefined"!==typeof y&&(y.exports={KnownSpace:s})},{"./das":10,"./overlay":25,"./sample":27,"./sourceadapters":32,
        "./spans":33,"./utils":45}],22:[function(h,y,r){function m(c,b){this.block=c;this.offset=b}function e(c,b){var d=4294967296*(c[b+6]&255)+16777216*(c[b+5]&255)+65536*(c[b+4]&255)+256*(c[b+3]&255)+(c[b+2]&255),a=c[b+1]<<8|c[b];return 0==d&&0==a?null:new m(d,a)}function s(c,b){b=Math.min(b||1,c.byteLength-50);for(var n=[],a=[0],e=0;a[0]<b;){var k=new Uint8Array(c,a[0],12),k=k[11]<<8|k[10],k=z(c,12+k+a[0],Math.min(65536,c.byteLength-12-k-a[0]),a);a[0]+=8;e+=k.byteLength;n.push(k)}if(1==n.length)return n[0];
        a=new Uint8Array(e);for(k=e=0;k<n.length;++k){var h=new Uint8Array(n[k]);d(h,0,a,e,h.length);e+=h.length}return a.buffer}function k(c,b){this.minv=c;this.maxv=b}function x(c,b){--b;return c>>14==b>>14?4681+(c>>14):c>>17==b>>17?585+(c>>17):c>>20==b>>20?73+(c>>20):c>>23==b>>23?9+(c>>23):c>>26==b>>26?1+(c>>26):0}function p(c,b){var d,a=[];--b;a.push(0);for(d=1+(c>>26);d<=1+(b>>26);++d)a.push(d);for(d=9+(c>>23);d<=9+(b>>23);++d)a.push(d);for(d=73+(c>>20);d<=73+(b>>20);++d)a.push(d);for(d=585+(c>>17);d<=
        585+(b>>17);++d)a.push(d);for(d=4681+(c>>14);d<=4681+(b>>14);++d)a.push(d);return a}if("undefined"!==typeof h){h=h("jszlib");var z=h.inflateBuffer,d=h.arrayCopy}m.prototype.toString=function(){return""+this.block+":"+this.offset};"undefined"!==typeof y&&(y.exports={unbgzf:s,readVob:e,reg2bin:x,reg2bins:p,Chunk:k})},{jszlib:60}],23:[function(h,y,r){function m(){this.featuresByChr={};this.maxLength=1;this.chrRing=null}function e(d){this.source=d;x.call(this);this.storeHolder=new p;this.parser=k(d.payload);
        if(!this.parser)throw"Unsupported memstore payload: "+d.payload;var c=this;this._load(function(b,d){if(b){for(var a=new m,e=[],k=b.split("\n"),h=c.parser.createSession(function(a){e.push(a)}),p=0;p<k.length;++p){var s=k[p];0<s.length&&h.parse(s)}h.flush();a.addFeatures(e);c.storeHolder.provide(a)}else c.error=d||"No data",c.storeHolder.provide(null)})}if("undefined"!==typeof h){y=h("./sourceadapters");var s=y.registerSourceAdapterFactory,k=y.makeParser,x=y.FeatureSourceBase;h("./das");h=h("./utils");
        var p=h.Awaited,z=h.textXHR}m.prototype.addFeatures=function(d){for(var c={},b=0;b<d.length;++b){var n=d[b],a=n.segment||n.chr,e=this.featuresByChr[a];e||(e=[],this.featuresByChr[a]=e);e.push(n);c[a]=!0;n=n.max-n.min+1;n>this.maxLength&&(this.maxLength=n)}for(a in c)e=this.featuresByChr[a],e.sort(function(a,b){var c=a.min-b.min;return 0!=c?c:a.max-b.max});this.chrRing=null};m.prototype._indexFor=function(d,c){for(var b=0,n=d.length;n>b;){var a=(b+n)/2|0;if(a>=d.length)return d.length;c<d[a].min?n=
        a:b=a+1}return n};m.prototype.fetch=function(d,c,b){var n=this.featuresByChr[d];n||(n=0==d.indexOf("chr")?this.featuresByChr[d.substring(3)]:this.featuresByChr["chr"+d]);if(!n)return[];var a=Math.max(0,this._indexFor(n,c-this.maxLength-1));d=Math.min(n.length-1,this._indexFor(n,b));for(var e=[];a<=d;++a){var k=n[a];k.min<=b&&k.max>=c&&e.push(k)}return e};m.prototype.findNextFeature=function(d,c,b){if(null==this.chrRing){this.chrRing=[];for(d in this.featuresByChr)this.chrRing.push(d);this.chrRing.sort()}var n=
        this.featuresByChr[d];n||(d=0==d.indexOf("chr")?d.substring(3):"chr"+d,n=this.featuresByChr[d]);if(!n)return null;var a=Math.max(0,Math.min(this._indexFor(n,c),n.length-1));if(0<b){for(;a<n.length;){var e=n[a++];if(e.min>c)return e}d=this.chrRing.indexOf(d)+1;d>=this.chrRing.length&&(d=0);return this.findNextFeature(this.chrRing[d],0,b)}for(;0<=a;)if(e=n[a--],e.max<c)return e;d=this.chrRing.indexOf(d)-1;0>d&&(d=this.chrRing.length-1);return this.findNextFeature(this.chrRing[d],1E10,b)};e.prototype=
        Object.create(x.prototype);e.prototype._load=function(d){if(this.source.blob){var c=new FileReader;c.onloadend=function(){return d(c.result,c.error)};c.readAsText(this.source.blob)}else z(this.source.uri,d,{})};e.prototype.fetch=function(d,c,b,n,a,e,k){var h=this;this.storeHolder.await(function(a){return a?(a=a.fetch(d,c,b),k(null,a,1E8)):k(h.error)})};e.prototype.getStyleSheet=function(d){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(d)};e.prototype.getDefaultFIPs=function(d){this.parser&&
    this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(d)};e.prototype.getScales=function(){return 1E8};e.prototype.findNextFeature=function(d,c,b,n){var a=this;this.storeHolder.await(function(e){return e?n(e.findNextFeature(d,c,b)):n(null,a.error)})};e.prototype.capabilities=function(){return{leap:!0}};s("memstore",function(d){return{features:new e(d)}})},{"./das":10,"./sourceadapters":32,"./utils":45}],24:[function(h,y,r){function m(e){return(e|0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}
        function e(e){e=""+e;var k=e.indexOf(".");if(0>k)return e;var h=2;"-"==e.substring(0,1)&&++h;return k>=h?e.substring(0,k):e.substring(0,k+2)}"undefined"!==typeof y&&(y.exports={formatLongInt:m,formatQuantLabel:e})},{}],25:[function(h,y,r){function m(e,h){this.sources=e;this.opts=h||{};this.activityListeners=[];this.readinessListeners=[];this.changeListeners=[];this.business=[];this.readiness=[];for(var d=0;d<this.sources.length;++d)this.initN(d);this.merge="concat"==h.merge?k:s}function e(e,k,d){this.source=
        e;this.callback=k;this.count=d;this.statusCount=this.returnCount=0;this.returns=[];this.features=[];this.statuses=[];this.scale=null}function s(e){for(var k=[],d=1;d<e.length;++d){for(var c={},b=e[d],n=0;n<b.length;++n)c[this.keyForFeature(b[n])]=b[n];k.push(c)}d=[];e=e[0];for(n=0;n<e.length;++n){for(var a=e[n],h=0;h<k.length;++h)if(c=k[h],b=c[this.keyForFeature(a)])for(var t in b)"score"===t?a.score2=b.score:"min"!==t&&"max"!==t&&"segment"!==t&&"_cachedStyle"!==t&&(a[t]=b[t]);d.push(a)}return d}
        function k(e){for(var k=[],d=0;d<e.length;++d)for(var c=e[d],b=this.sources[d].name,n=0;n<c.length;++n){var a=c[n];a.method=b;k.push(a)}return k}if("undefined"!==typeof h)var x=h("./utils").shallowCopy;m.prototype.initN=function(e){var k=this.sources[e],d=this;this.business[e]=0;k.addActivityListener&&k.addActivityListener(function(c){d.business[e]=c;d.notifyActivity()});k.addChangeListener&&k.addChangeListener(function(){d.notifyChange()});k.addReadinessListener&&k.addReadinessListener(function(c){d.readiness[e]=
            c;d.notifyReadiness()})};m.prototype.addReadinessListener=function(e){this.readinessListeners.push(e);this.notifyReadinessListener(e)};m.prototype.notifyReadiness=function(){for(var e=0;e<this.readinessListeners.length;++e)this.notifyReadinessListener(this.readinessListeners[e])};m.prototype.notifyReadinessListener=function(e){for(var k=null,d=0;d<this.readiness.length;++d)if(null!=this.readiness[d]){k=this.readiness[d];break}try{e(k)}catch(c){console.log(c)}};m.prototype.addActivityListener=function(e){this.activityListeners.push(e)};
        m.prototype.notifyActivity=function(){for(var e=0,k=0;k<this.business.length;++k)e+=this.business[k];for(k=0;k<this.activityListeners.length;++k)try{this.activityListeners[k](e)}catch(d){console.log(d)}};m.prototype.addChangeListener=function(e){this.changeListeners.push(e)};m.prototype.notifyChange=function(){for(var e=0;e<this.changeListeners.length;++e)try{this.changeListeners[e](this.busy)}catch(k){console.log(k)}};m.prototype.getScales=function(){return this.sources[0].getScales()};m.prototype.getStyleSheet=
            function(e){return this.sources[0].getStyleSheet(e)};m.prototype.capabilities=function(){var e={},k=this.sources[0];k.capabilities&&(e=x(k.capabilities()));for(k=1;k<this.sources.length;++k){var d=this.sources[k];d.capabilities&&(d=d.capabilities(),d.search&&(e.search=d.search))}return e};m.prototype.search=function(e,k){for(var d=0;d<this.sources.length;++d)if(sourceAdapterIsCapable(this.sources[d],"search"))return this.sources[d].search(e,k)};m.prototype.fetch=function(k,h,d,c,b,n,a){a=new e(this,
            a,this.sources.length);for(var m=0;m<this.sources.length;++m)this.fetchN(a,m,k,h,d,c,b,n)};m.prototype.fetchN=function(e,k,d,c,b,n,a,h){this.sources[k].fetch(d,c,b,n,a,h,function(a,b,c){return e.completed(k,a,b,c)})};m.prototype.quantFindNextFeature=function(e,k,d,c,b){return this.sources[0].quantFindNextFeature(e,k,d,c,b)};m.prototype.findNextFeature=function(e,k,d,c){return this.sources[0].findNextFeature(e,k,d,c)};e.prototype.completed=function(e,k,d,c){if(null==this.scale||0==e)this.scale=c;if(this.returns[e])throw"Multiple returns for source "+
            e;this.returns[e]=!0;this.returnCount++;this.features[e]=d;k&&(this.statuses[e]=k,this.statusCount++);if(this.returnCount==this.count){if(0<this.statusCount){e="";for(k=0;k<this.count;++k)if(d=this.statuses[k])0<e.length&&(e+=", "),e+=d;return this.callback(e,null,this.scale)}this.callback(null,this.source.merge(this.features),this.scale)}};m.prototype.getDefaultFIPs=function(e){for(var k=0;k<this.sources.length;++k){var d=this.sources[k];d.getDefaultFIPs&&d.getDefaultFIPs(e)}};m.prototype.keyForFeature=
            function(e){return""+e.min+".."+e.max};"undefined"!==typeof y&&(y.exports={OverlayFeatureSource:m})},{"./utils":45}],26:[function(h,y,r){function m(a,h,t){var w=/^\w+\s[0-9]+\s[0-9]+.*$/,F=/([^=]+)=\"?([^\"]+)\"?/,B=/^##\s*fileformat=VCFv4\..+/;(a.blob?new k(a.blob):new s(a.uri,{credentials:a.credentials})).slice(0,65536).salted().fetch(function(k,s){if(!k)return t||(a.credentials=!0,m(a,h,!0)),h(a,"Couldn't fetch data");var A=new Uint8Array(k),r=(new Uint32Array(k,0,1))[0];if(r==p||r==z){a.tier_type=
        "bwg";A=/\/?([^/]+?)(.bw|.bb|.bigWig|.bigBed)?$/;if(A=A.exec(a.uri||a.blob.name))a.name=A[1];return h(a,null)}if(r==b)return a.tier_type="bai",h(a,null);if(31==A[0]||139==A[1]){A=d(k);A=new Uint8Array(A);r=x(A,0);if(r==c){a.tier_type="bam";A=/\/?([^/]+?)(.bam)?$/;if(A=A.exec(a.uri||a.blob.name))a.name=A[1];return h(a,null)}if(r==n)return a.tier_type="tabix-index",h(a,null);if(1768301347==r){a.tier_type="tabix";a.payload="vcf";A=/\/?([^/]+?)(.vcf)?(.gz)?$/;if(A=A.exec(a.uri||a.blob.name))a.name=A[1];
        return h(a,null)}console.log("magic = "+r.toString(16));return h(a,"Unsupported format")}A=String.fromCharCode.apply(null,A).split("\n");if(0<A.length&&B.test(A[0]))return a.tier_type="memstore",a.payload="vcf",A=/\/?([^/]+?)(.vcf)?$/,(A=A.exec(a.uri||a.blob.name))&&!a.name&&(a.name=A[1]),h(a,null);for(var y=0;y<A.length;++y)if(r=A[y].replace("\r",""),0!=r.length&&0!=r.indexOf("browser")){if(0==r.indexOf("track")){A="bed";r=r.split(/\s/);for(y=1;y<r.length;++y){var O=F.exec(r[y]);O&&("type"==O[1]&&
        "wiggle_0"==O[2]?A="wig":"name"==O[0]&&(a.name=O[2]))}e(a,A);return h(a,null)}if(0==r.indexOf("fixedStep")||0==r.indexOf("variableStep"))return e(a,"wig"),h(a,null);if(w.test(r))return e(a,null),h(a,null);break}return h(a,"Unsupported format")})}function e(a,b){a.tier_type="memstore";var c=/\/?([^/]+?)(.(bed|wig))?$/.exec(a.uri||a.blob.name);c&&(a.name||(a.name=c[1]),!b&&c[3]&&(b=c[3]));a.payload=b||"bed"}if("undefined"!==typeof h){r=h("./bin");var s=r.URLFetchable,k=r.BlobFetchable,x=r.readInt;r=
        h("./bigwig");var p=r.BIG_WIG_MAGIC,z=r.BIG_BED_MAGIC,d=h("./lh3utils").unbgzf;r=h("./bam");var c=r.BAM_MAGIC,b=r.BAI_MAGIC,n=h("./tabix").TABIX_MAGIC}"undefined"!==typeof y&&(y.exports={probeResource:m})},{"./bam":1,"./bigwig":3,"./bin":4,"./lh3utils":22,"./tabix":37}],27:[function(h,y,r){function m(e){return p[e%p.length]*Math.pow(10,e/p.length|0)}function e(e,d,c){this.scale=e;this.cnt=this.tot=0;this.hasScore=!1;this.min=d;this.max=c;this.features=[]}function s(e,d){return e.min<d.min?-1:e.min>
        d.min?1:e.max<d.max?-1:d.max>e.max?1:0}function k(k,d){for(var c=0;m(c+1)<d;)++c;for(var c=m(c),b=[],n=-1E10,a=1E10,h=0;h<k.length;++h){var t=k[h];if(t.groups&&0<t.groups.length)return k;for(var p=t.min/c|0,s=t.max/c|0,n=Math.max(n,s),a=Math.min(a,p);p<=s;++p){var B=b[p];B||(B=new e(c,p*c,(p+1)*c-1),b[p]=B);B.feature(t)}}h=[];for(p=a;p<=n;++p)if(B=b[p])t=new x,t.segment=k[0].segment,t.min=p*c+1,t.max=(p+1)*c,t.score=B.score(),t.type="density",h.push(t);Date.now();return h}if("undefined"!==typeof h)var x=
        h("./das").DASFeature;var p=[1,2,5];e.prototype.score=function(){if(0==this.cnt)return 0;if(this.hasScore)return this.tot/this.cnt;var e=this.features;e.sort(s);for(var d=-1E10,c=0,b=0,n=1;n<e.length;++n){var a=e[n],k=Math.max(a.min,this.min),a=Math.min(a.max,this.max),b=b+(a-k+1);k>d?(c+=a-k+1,d=a):a>d&&(c+=a-d,d=a)}return 0<c?1*b/c:0};e.prototype.feature=function(e){void 0!==e.score&&(this.tot+=e.score,this.hasScore=!0);++this.cnt;this.features.push(e)};"undefined"!==typeof y&&(y.exports={downsample:k})},
        {"./das":10}],28:[function(h,y,r){function m(e,k){var d=parseFloat(e.replace(/,/g,""));return"k"===k||"K"===k?1E3*d|0:"m"==k||"M"===k?1E6*d|0:d|0}if("undefined"!==typeof h)var e=h("./cbrowser").Browser,s=h("./bin").URLFetchable,k=h("./trix").connectTrix;var x=/^([\d+,\w,\.,\_,\-]+):([0-9,\.]+?)([KkMmGg])?((-|\.\.)+([0-9,\.]+)([KkMmGg])?)?$/;e.prototype.search=function(e,h){var d=this,c=x.exec(e);if(c){var b=c[1],n;if(c[6])n=m(c[2],c[3]),c=m(c[6],c[7]);else{var a=this.viewEnd-this.viewStart+1;n=m(c[2],
        c[3])-a/2|0;c=n+a-1}this.setLocation(b,n,c,h)}else{if(!e||0==e.length)return!1;var u=0,t=!1,w=function(a,b){--u;if(b)return h(b);a||(a=[]);for(var c=5E8,n=-1E8,k=null,m=0;m<a.length;++m){var w=a[m];null==k&&(k=w.segment);c=Math.min(c,w.min);n=Math.max(n,w.max)}if(k)t=!0,d.highlightRegion(k,c,n),m=Math.max(2500,0.3*(n-c+1)|0),d.setLocation(k,c-m,n+m,h);else if(0==u&&!t)return h("no match for '"+e+"'")},F=function(a,b){b.lookup(e,function(b,c){if(null==b||2>b.length)return a.featureSource.search(e,
        w);var d=b[1].split(",")[0];return a.featureSource.search(d,w)})};if(this.searchEndpoint)return u=1,this.doDasSearch(d.searchEndpoint,e,w);for(b=0;b<this.tiers.length;++b)(function(a){d.sourceAdapterIsCapable(a.featureSource,"search")?a.dasSource.trixURI?(++u,a.trix?F(a,a.trix):k(new s(a.dasSource.trixURI),new s(a.dasSource.trixURI+"x"),function(b){a.trix=b;F(a,b)})):(++u,a.featureSource.search(e,w)):a.dasSource.provides_search&&(++u,d.doDasSearch(a.dasSource,e,w))})(this.tiers[b])}};e.prototype.doDasSearch=
        function(e,k,d){e.features(null,{group:k,type:"transcript"},function(c){c||(c=[]);for(var b=[],e=0;e<c.length;++e){var a=c[e];a.label.toLowerCase()==k.toLowerCase()&&b.push(a)}return d(b)},!1)}},{"./bin":4,"./cbrowser":6,"./trix":43}],29:[function(h,y,r){function m(c,b){b||(b=z);for(var e=d.length;c*d[e%d.length]*Math.pow(10,e/d.length|0)<b;)++e;return d[e%d.length]*Math.pow(10,e/d.length|0)}function e(c,b){var d=c.browser.retina&&1<window.devicePixelRatio,a=c.browser.scale,e=c.browser.viewStart-
        1E3/a|0,h=c.browser.viewEnd+2E3/a,p=c.browser.currentSeqMax,s=c.browser.featurePanelWidth+2E3;d&&(s*=2);var r=c.viewport.width|0;r<s-50&&(c.viewport.width=r=s);s=50;b&&b.seq&&(s+=25);var x=s;d&&(x*=2);c.viewport.height=x;c.viewport.style.height=""+s+"px";c.viewport.style.width=d?""+r/2+"px":""+r+"px";c.layoutHeight=s;c.updateHeight();s=c.viewport.getContext("2d");c.background&&(s.fillStyle=c.background,s.fillRect(0,0,r,c.viewport.height));d&&s.scale(2,2);s.translate(1E3,0);d=h;0<p&&p<h&&(d=p);r=m(a);
        x=Math.max(0,(e/r|0)*r);for(p=c.browser.viewStart;x<=d;)s.fillStyle=0==x/r%2?"white":"black",s.strokeStyle="black",s.fillRect((x-p)*a,8,r*a,3),s.strokeRect((x-p)*a,8,r*a,3),s.fillStyle="black",s.fillText(k(x),(x-p)*a,22),x+=r;if(b&&b.seq)for(;e<=h;++e)e>=b.start&&e<=b.end&&(d=b.seq.substr(e-b.start,1).toUpperCase(),(r=c.browser.baseColors[d])||(r="gray"),s.fillStyle=r,8<=a?s.fillText(d,(e-p)*a,52):s.fillRect((e-p)*a,42,a,12));c.norigin=c.browser.viewStart;c.viewportHolder.style.left="-1000px"}function s(c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     b){var d=c.browser.scale,a=c.browser.viewStart-1E3/d|0,e=c.browser.viewEnd+2E3/d,h=c.browser.currentSeqMax,w=e;0<h&&h<e&&(w=h);for(var s=m(d),r=Math.max(0,(a/s|0)*s),h=c.browser.viewStart,z=x(p,"g",[],{fontSize:"8pt"});r<=w;)z.appendChild(x(p,"rect",null,{x:(r-h)*d,y:8,width:s*d,height:3,fill:0==r/s%2?"white":"black",stroke:"black"})),z.appendChild(x(p,"text",k(r),{x:(r-h)*d,y:28,fill:"black",stroke:"none"})),r+=s;if(b&&b.seq)for(;a<=e;++a)a>=b.start&&a<=b.end&&(w=b.seq.substr(a-b.start,1).toUpperCase(),
        (s=c.browser.baseColors[w])||(s="gray"),8<=d?z.appendChild(x(p,"text",w,{x:(a-h)*d,y:52,fill:s})):z.appendChild(x(p,"rect",null,{x:(a-h)*d,y:42,width:d,height:12,fill:s})));return z}if("undefined"!==typeof h){r=h("./utils");var k=r.formatLongInt,x=r.makeElementNS,p=h("./svg-utils").NS_SVG,k=h("./numformats").formatLongInt}var z=100,d=[1,2,5],p="http://www.w3.org/2000/svg";"undefined"!==typeof y&&(y.exports={drawSeqTier:e,svgSeqTier:s})},{"./numformats":24,"./svg-utils":35,"./utils":45}],30:[function(h,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 y,r){if("undefined"!=typeof h){y=h("./cbrowser");var m=y.Browser,e=y.sourceDataURI,s=y.sourcesAreEqual,k=h("./version"),x=h("./utils").miniJSONify,p=h("./sha1").hex_sha1}m.prototype.nukeStatus=function(){delete localStorage["dalliance."+this.cookieKey+".view-chr"];delete localStorage["dalliance."+this.cookieKey+".view-start"];delete localStorage["dalliance."+this.cookieKey+".view-end"];delete localStorage["dalliance."+this.cookieKey+".current-seq-length"];delete localStorage["dalliance."+this.cookieKey+
        ".showing-alt-zoom"];delete localStorage["dalliance."+this.cookieKey+".saved-zoom"];delete localStorage["dalliance."+this.cookieKey+".sources"];delete localStorage["dalliance."+this.cookieKey+".hubs"];delete localStorage["dalliance."+this.cookieKey+".version"];delete localStorage["dalliance."+this.cookieKey+".reverse-scrolling"];delete localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"];delete localStorage["dalliance."+this.cookieKey+".ruler-location"]};m.prototype.storeStatus=function(){this.storeViewStatus();
        this.storeTierStatus()};m.prototype.storeViewStatus=function(){!this.cookieKey||this.noPersist||this.noPersistView||(localStorage["dalliance."+this.cookieKey+".view-chr"]=this.chr,localStorage["dalliance."+this.cookieKey+".view-start"]=this.viewStart|0,localStorage["dalliance."+this.cookieKey+".view-end"]=this.viewEnd|0,localStorage["dalliance."+this.cookieKey+".showing-alt-zoom"]=""+this.isSnapZooming,localStorage["dalliance."+this.cookieKey+".saved-zoom"]=this.savedZoom,this.currentSeqMax&&(localStorage["dalliance."+
        this.cookieKey+".current-seq-length"]=this.currentSeqMax))};m.prototype.storeTierStatus=function(){if(this.cookieKey&&!this.noPersist){for(var e=[],d=0;d<this.tiers.length;++d){var c=this.tiers[d];c.dasSource.noPersist||e.push({source:c.dasSource,config:c.config||{}})}localStorage["dalliance."+this.cookieKey+".sources"]=JSON.stringify(e);e={};d=[];for(c=0;c<this.hubObjects.length;++c){var b=this.hubObjects[c],n={url:b.hub.url,genome:b.genome};b.credentials&&(n.credentials=b.credentials);b.mapping&&
    (n.mapping=b.mapping);e[n.url]=!0;d.push(n)}for(c=0;c<this.hubs.length;++c)n=this.hubs[c],"string"===typeof n&&(n={url:n}),e[n.url]||d.push(n);localStorage["dalliance."+this.cookieKey+".hubs"]=JSON.stringify(d);localStorage["dalliance."+this.cookieKey+".reverse-scrolling"]=this.reverseScrolling;localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"]=this.reverseKeyScrolling;localStorage["dalliance."+this.cookieKey+".ruler-location"]=this.rulerLocation;localStorage["dalliance."+this.cookieKey+
        ".export-ruler"]=this.exportRuler;localStorage["dalliance."+this.cookieKey+".export-highlights"]=this.exportHighlights;localStorage["dalliance."+this.cookieKey+".version"]=k.CONFIG}};m.prototype.restoreStatus=function(){if(!this.noPersist){var h=localStorage["dalliance."+this.cookieKey+".version"];if(k.CONFIG==(h?h|0:-100)){var h=localStorage["dalliance."+this.cookieKey+".configHash"]||"",d=p(x({sources:this.sources,hubs:this.hubs}));if(d!=h)localStorage["dalliance."+this.cookieKey+".configHash"]=
        d;else{h={};for(d=0;d<this.sources.length;++d){var c=this.sources[d];if(c){var b=e(c),n=h[b];n||(h[b]=n=[]);n.push(c)}}if(!this.noPersistView&&(d=localStorage["dalliance."+this.cookieKey+".view-chr"],c=localStorage["dalliance."+this.cookieKey+".view-start"]|0,n=localStorage["dalliance."+this.cookieKey+".view-end"]|0,d&&c&&n)){this.chr=d;this.viewStart=c;this.viewEnd=n;if(d=localStorage["dalliance."+this.cookieKey+".current-seq-length"])this.currentSeqMax=d|0;this.isSnapZooming="true"==localStorage["dalliance."+
        this.cookieKey+".showing-alt-zoom"];d=parseFloat(localStorage["dalliance."+this.cookieKey+".saved-zoom"]);"number"!==typeof d||isNaN(d)||(this.savedZoom=d)}this.reverseScrolling=(d=localStorage["dalliance."+this.cookieKey+".reverse-scrolling"])&&"true"==d;this.reverseKeyScrolling=(d=localStorage["dalliance."+this.cookieKey+".reverse-key-scrolling"])&&"true"==d;if(d=localStorage["dalliance."+this.cookieKey+".ruler-location"])this.rulerLocation=d;if(d=localStorage["dalliance."+this.cookieKey+".export-ruler"])this.exportRuler=
        "true"===d;if(d=localStorage["dalliance."+this.cookieKey+".export-highlights"])this.exportHighlights="true"===d;if(d=localStorage["dalliance."+this.cookieKey+".sources"]){var a=JSON.parse(d);this.sources=[];this.restoredConfigs=[];for(d=0;d<a.length;++d)for(c=this.sources[d]=a[d].source,this.restoredConfigs[d]=a[d].config,b=e(c),n=h[b]||[],b=0;b<n.length;++b){var m=n[b];s(c,m)&&m.featureInfoPlugin&&(c.featureInfoPlugin=m.featureInfoPlugin)}}if(h=localStorage["dalliance."+this.cookieKey+".hubs"])this.hubs=
        JSON.parse(h);return!0}}}};m.prototype.reset=function(){for(var e=this.tiers.length-1;0<=e;--e)this.removeTier({index:e},!0);for(e=0;e<this.defaultSources.length;++e)this.defaultSources[e].disabled||this.addTier(this.defaultSources[e]);this.highlights.splice(0,this.highlights.length);this.setLocation(this.defaultChr,this.defaultStart,this.defaultEnd)}},{"./cbrowser":6,"./sha1":31,"./utils":45,"./version":47}],31:[function(h,y,r){function m(d){d=s(k(d));for(var c=p?"0123456789ABCDEF":"0123456789abcdef",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         b="",e,a=0;a<d.length;a++)e=d.charCodeAt(a),b+=c.charAt(e>>>4&15)+c.charAt(e&15);return b}function e(d){d=s(k(d));for(var c="",b=d.length,e=0;e<b;e+=3)for(var a=d.charCodeAt(e)<<16|(e+1<b?d.charCodeAt(e+1)<<8:0)|(e+2<b?d.charCodeAt(e+2):0),h=0;4>h;h++)c=8*e+6*h>8*d.length?c+z:c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>6*(3-h)&63);return c}function s(d){for(var c=Array(d.length>>2),b=0;b<c.length;b++)c[b]=0;for(b=0;b<8*d.length;b+=8)c[b>>5]|=(d.charCodeAt(b/8)&
        255)<<24-b%32;d=8*d.length;c[d>>5]|=128<<24-d%32;c[(d+64>>9<<4)+15]=d;d=Array(80);for(var b=1732584193,e=-271733879,a=-1732584194,k=271733878,h=-1009589776,m=0;m<c.length;m+=16){for(var p=b,s=e,r=a,y=k,A=h,z=0;80>z;z++){if(16>z)d[z]=c[m+z];else{var D=d[z-3]^d[z-8]^d[z-14]^d[z-16];d[z]=D<<1|D>>>31}var D=b<<5|b>>>27,O;O=20>z?e&a|~e&k:40>z?e^a^k:60>z?e&a|e&k|a&k:e^a^k;D=x(x(D,O),x(x(h,d[z]),20>z?1518500249:40>z?1859775393:60>z?-1894007588:-899497514));h=k;k=a;a=e<<30|e>>>2;e=b;b=D}b=x(b,p);e=x(e,s);
        a=x(a,r);k=x(k,y);h=x(h,A)}c=[b,e,a,k,h];d="";for(b=0;b<32*c.length;b+=8)d+=String.fromCharCode(c[b>>5]>>>24-b%32&255);return d}function k(d){for(var c="",b=-1,e,a;++b<d.length;)e=d.charCodeAt(b),a=b+1<d.length?d.charCodeAt(b+1):0,55296<=e&&56319>=e&&56320<=a&&57343>=a&&(e=65536+((e&1023)<<10)+(a&1023),b++),127>=e?c+=String.fromCharCode(e):2047>=e?c+=String.fromCharCode(192|e>>>6&31,128|e&63):65535>=e?c+=String.fromCharCode(224|e>>>12&15,128|e>>>6&63,128|e&63):2097151>=e&&(c+=String.fromCharCode(240|
        e>>>18&7,128|e>>>12&63,128|e>>>6&63,128|e&63));return c}function x(d,c){var b=(d&65535)+(c&65535);return(d>>16)+(c>>16)+(b>>16)<<16|b&65535}var p=0,z="";"undefined"!==typeof y&&(y.exports={b64_sha1:e,hex_sha1:m})},{}],32:[function(h,y,r){function m(a,f){ha[a]=f}function e(a,f){ga[a]=f}function s(a){if(ga[a])return ga[a](a)}function k(a){var f=this;this.source=a;this.cfsid="cfs"+ ++ia;a.name&&(this.name=a.name);a.addChangeListener&&a.addChangeListener(function(){f.cfsid="cfs"+ ++ia})}function x(){this.busy=
        0;this.activityListeners=[];this.readinessListeners=[];this.readiness=null}function p(a){this.dasSource=new q(a);this.busy=0;this.activityListeners=[]}function z(a){this.dasSource=new q(a);this.awaitedEntryPoints=new A;var f=this;this.dasSource.entryPoints(function(a){f.awaitedEntryPoints.provide(a)})}function d(a){var f=this;this.source=a;this.twoBit=new A;if(a.twoBitURI)a=new C(a.twoBitURI);else if(a.twoBitBlob)a=new J(a.twoBitBlob);else throw Error("No twoBitURI or twoBitBlob parameter");V(a,function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     b){b?console.log(b):f.twoBit.provide(a)})}function c(a){x.call(this);var f=this;this.readiness="Connecting";this.bwgSource=this.opts=a;f.bwgHolder=new A;if(this.opts.preflight){var b=ba[this.opts.preflight];if(!b){b=new A;ba[this.opts.preflight]=b;var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(200==c.status?b.provide("success"):b.provide("failure"))};c.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(c.withCredentials=!0);c.send("")}b.await(function(a){"success"===
    a&&f.init()})}else f.init()}function b(a,f){x.call(this);this.worker=f;this.readiness="Connecting";this.bwgSource=this.opts=a;this.keyHolder=new A;this.init()}function n(a,f){if(!(a.flag&S.SEGMENT_UNMAPPED)){var b;b=a.seq?a.seq.length:a.seqLength;if(a.cigar){b=0;for(var c=R(a.cigar),d=0;d<c.length;++d){var l=c[d];if("M"==l.op||"D"==l.op)b+=l.cnt}}c=new g;c.min=a.pos+1;c.max=a.pos+b;c.segment=a.segment;c.type="bam";c.id=a.readName;c.notes=["MQ="+a.mq];c.cigar=a.cigar;c.seq=a.seq;c.quals=a.quals;c.orientation=
            a.flag&S.REVERSE_COMPLEMENT?"-":"+";c.bamRecord=a;f&&a.flag&S.MULTIPLE_SEGMENTS&&(c.groups=[{id:a.readName,type:"readpair"}]);return c}}function a(a){x.call(this);var f=this;this.bamSource=a;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.bamHolder=new A;if(this.opts.preflight){var b=ba[this.opts.preflight];if(!b){b=new A;ba[this.opts.preflight]=b;var c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(200==c.status?b.provide("success"):b.provide("failure"))};
        c.open("get",this.opts.preflight+"?"+hex_sha1("salt"+Date.now()),!0);this.opts.credentials&&(c.withCredentials="true");c.send("")}b.await(function(a){"success"===a&&f.init()})}else f.init()}function u(a,f){x.call(this);this.bamSource=a;this.worker=f;this.opts={credentials:a.credentials,preflight:a.preflight,bamGroup:a.bamGroup};this.keyHolder=new A;this.init()}function t(a,f){this.source=a;this.mapping=f;this.activityListeners=[];this.busy=0}function w(){}function F(){}function B(a){this.store=new X(a.jbURI,
        a.jbQuery)}if("undefined"!==typeof h){var Q=h("./cbrowser").Browser,G=h("./tier").DasTier;r=h("./utils");var A=r.Awaited,P=r.arrayIndexOf,D=r.shallowCopy,O=r.resolveUrlToPage;r=h("./das");var E=r.DASStylesheet,f=r.DASStyle,q=r.DASSource,l=r.DASSegment,g=r.DASFeature,v=r.DASSequence,I=r.DASLink;r=h("./bin");var C=r.URLFetchable,J=r.BlobFetchable,V=h("./twoBit").makeTwoBit,H=h("./bigwig").makeBwg;r=h("./bam");var M=r.makeBam,S=r.BamFlags;r=h("./spans");var Z=r.Range,fa=r.union,R=h("./cigar").parseCigar,
        W=h("./overlay").OverlayFeatureSource,X=h("./jbjson").JBrowseStore}var ha={},ga={};G.prototype.initSources=function(){var a=this,f=new w,b;"sequence"==this.dasSource.tier_type||this.dasSource.twoBitURI||this.dasSource.twoBitBlob?b=this.dasSource.twoBitURI||this.dasSource.twoBitBlob?new d(this.dasSource):new z(this.dasSource):f=this.browser.createFeatureSource(this.dasSource);this.featureSource=f;this.sequenceSource=b;this.featureSource&&this.featureSource.addChangeListener&&this.featureSource.addChangeListener(function(){a.browser.refreshTier(a)})};
        Q.prototype.createFeatureSource=function(f){var g=this.sourceCache.get(f);if(g)return g;if(f.tier_type&&ha[f.tier_type])g=(0,ha[f.tier_type])(f).features;else if(f.bwgURI||f.bwgBlob)var d=this.getWorker(),g=d?new b(f,d):new c(f);else if(f.bamURI||f.bamBlob)g=(d=this.getWorker())?new u(f,d):new a(f);else if(f.jbURI)g=new B(f);else if(f.uri||f.features_uri)g=new p(f);if(f.overlay){d=[];g&&d.push(new k(g));for(g=0;g<f.overlay.length;++g)d.push(this.createFeatureSource(f.overlay[g]));g=new W(d,f)}f.mapping&&
        (g=new t(g,this.chains[f.mapping]));f.name&&!g.name&&(g.name=f.name);null!=g&&(g=new k(g),this.sourceCache.put(f,g));return g};G.prototype.fetchStylesheet=function(a){(this.dasSource.stylesheet_uri?new p(this.dasSource):this.getSource()).getStyleSheet(a)};var ia=0;k.prototype.addReadinessListener=function(a){if(this.source.addReadinessListener)return this.source.addReadinessListener(a);a(null)};k.prototype.search=function(a,f){if(this.source.search)return this.source.search(a,f)};k.prototype.getDefaultFIPs=
            function(a){if(this.source.getDefaultFIPs)return this.source.getDefaultFIPs(a)};k.prototype.getStyleSheet=function(a){this.source.getStyleSheet(a)};k.prototype.getScales=function(){return this.source.getScales()};k.prototype.addActivityListener=function(a){this.source.addActivityListener&&this.source.addActivityListener(a)};k.prototype.addChangeListener=function(a){this.source.addChangeListener&&this.source.addChangeListener(a)};k.prototype.findNextFeature=function(a,f,b,c){this.source.findNextFeature(a,
            f,b,c)};k.prototype.quantFindNextFeature=function(a,f,b,c,g){this.source.quantFindNextFeature(a,f,b,c,g)};k.prototype.capabilities=function(){return this.source.capabilities?this.source.capabilities():{}};k.prototype.fetch=function(a,f,b,c,g,d,l){if(null==d)throw"pool is null...";var e=d.awaitedFeatures[this.cfsid];e||(e=new A,d.awaitedFeatures[this.cfsid]=e,this.source.fetch(a,f,b,c,g,d,function(a,f,b,c){e.res||e.provide({status:a,features:f,scale:b,coverage:c})}));e.await(function(a){l(a.status,
            a.features,a.scale,a.coverage)})};x.prototype.addReadinessListener=function(a){this.readinessListeners.push(a);a(this.readiness)};x.prototype.notifyReadiness=function(){for(var a=0;a<this.readinessListeners.length;++a)try{this.readinessListeners[a](this.readiness)}catch(f){console.log(f)}};x.prototype.addActivityListener=function(a){this.activityListeners.push(a)};x.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(f){console.log(f)}};
        x.prototype.getScales=function(){return null};x.prototype.fetch=function(a,f,b,c,g,d,l){return l(null,[],1E9)};x.prototype.getStyleSheet=function(a){var b=new E,c=new f;c.glyph="BOX";c.BGCOLOR="blue";c.FGCOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};p.prototype.addActivityListener=function(a){this.activityListeners.push(a)};p.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(f){console.log(f)}};p.prototype.getStyleSheet=
            function(a){this.dasSource.stylesheet(function(f){a(f)},function(){a(null,"Couldn't fetch DAS stylesheet")})};p.prototype.fetch=function(a,f,b,c,g,d,e){if(g&&0==g.length)e(null,[],c);else if(this.dasSource.uri||this.dasSource.features_uri){if(this.dasSource.dasStaticFeatures&&this.cachedStaticFeatures)return e(null,this.cachedStaticFeatures,this.cachedStaticScale);var k=!1!==this.dasSource.maxbins;g={type:g};k&&(g.maxbins=1+((b-f)/c|0));var q=this;q.busy++;q.notifyActivity();this.dasSource.features(new l(a,
            f,b),g,function(a,f){q.busy--;q.notifyActivity();var b=c;k||(b=0.1);!f&&q.dasSource.dasStaticFeatures&&(q.cachedStaticFeatures=a,q.cachedStaticScale=b);e(f,a,b)})}};p.prototype.findNextFeature=this.sourceFindNextFeature=function(a,f,b,c){if(this.dasSource.capabilities&&0<=P(this.dasSource.capabilities,"das1:adjacent-feature")){var g=this;if(this.dasAdjLock)return console.log("Already looking for a next feature, be patient!");this.dasAdjLock=!0;a={adjacent:a+":"+(f|0)+":"+(0<b?"F":"B")};if(f=thisTier.getDesiredTypes(thisTier.browser.scale))a.types=
            f;thisTier.dasSource.features(null,a,function(a){g.dasAdjLock=!1;0<a.length&&null!=a[0]&&c(a[0])})}};z.prototype.fetch=function(a,f,b,c,g){this.dasSource.sequence(new l(a,f,b),function(a){return 1==a.length?g(null,a[0]):g("Didn't get sequence")})};z.prototype.getSeqInfo=function(a,f){this.awaitedEntryPoints.await(function(b){for(var c=0;c<b.length;++c)if(b[c].name==a)return f({length:b[c].end});return f()})};d.prototype.fetch=function(a,f,b,c,g){this.twoBit.await(function(c){c.fetch(a,f,b,function(c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   d){if(d)return g(d,null);var l=new v(a,f,b,"DNA",c);return g(null,l)})})};d.prototype.getSeqInfo=function(a,f){this.twoBit.await(function(b){b.getSeq(a)?b.getSeq(a).length(function(a){f({length:a})}):f()})};p.prototype.getScales=function(){return[]};var ba={};c.prototype=Object.create(x.prototype);c.prototype.init=function(){var a=this,f;f=this.bwgSource.bwgURI?new C(this.bwgSource.bwgURI,{credentials:this.opts.credentials}):new J(this.bwgSource.bwgBlob);H(f,function(f,b){b?(a.error=b,a.readiness=
            null,a.notifyReadiness(),a.bwgHolder.provide(null)):(a.bwgHolder.provide(f),a.readiness=null,a.notifyReadiness(),"bigbed"==f.type&&f.getExtraIndices(function(f){a.extraIndices=f}))})};c.prototype.capabilities=function(){var a={leap:!0};this.bwgHolder.res&&"bigwig"==this.bwgHolder.res.type&&(a.quantLeap=!0);if(this.extraIndices&&0<this.extraIndices.length){a.search=[];for(var f=0;f<this.extraIndices.length;++f)a.search.push(this.extraIndices[f].field)}return a};c.prototype.fetch=function(a,f,b,c,g,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        d,l){var e=this;this.bwgHolder.await(function(d){if(null==d)return l(e.error||"Can't access binary file",null,null);var q;q=!g||0==g.length||0<=P(g,"density");e.opts.clientBin&&(q=!1);if("bigwig"==d.type||q||"undefined"!==typeof e.opts.forceReduction){q=-1;for(var k=0;k<d.zoomLevels.length;++k)if(d.zoomLevels[k].reduction<=c)q=k;else break;"undefined"!==typeof e.opts.forceReduction&&(q=e.opts.forceReduction);q=0>q?d.getUnzoomedView():d.getZoomedView(q)}else q=d.getUnzoomedView();e.busy++;e.notifyActivity();
            q.readWigData(a,f,b,function(a){e.busy--;e.notifyActivity();var c=1E9;if("bigwig"===d.type){var g=(b-f)/a.length/2;g<c&&(c=g)}if(e.opts.link)for(g=0;g<a.length;++g){var q=a[g];q.label&&(q.links=[new I("Link",e.opts.link.replace(/\$\$/,q.label))])}l(null,a,c)})})};c.prototype.quantFindNextFeature=function(a,f,b,c,g){var d=this;d.busy++;d.notifyActivity();this.bwgHolder.res.thresholdSearch(a,f,b,c,function(a,f){d.busy--;d.notifyActivity();return g(a,f)})};c.prototype.findNextFeature=function(a,f,b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           c){var g=this;g.busy++;g.notifyActivity();this.bwgHolder.res.getUnzoomedView().getFirstAdjacent(a,f,b,function(a){g.busy--;g.notifyActivity();0<a.length&&null!=a[0]&&c(a[0])})};c.prototype.getScales=function(){var a=this.bwgHolder.res;if(a){for(var f=[1],b=0;b<a.zoomLevels.length;++b)f.push(a.zoomLevels[b].reduction);return f}return null};c.prototype.search=function(a,f){return this.extraIndices&&0!=this.extraIndices.length?this.extraIndices[0].lookup(a,f):f(null,"No indices available")};c.prototype.getDefaultFIPs=
            function(a){if(this.opts.noExtraFeatureInfo)return!0;this.bwgHolder.await(function(f){f&&f.schema&&f.definedFieldCount<f.schema.fields.length&&a(function(a,b){for(var c=0;c<b.hit.length;++c)if(b.hit[c].isSuperGroup)return;for(c=f.definedFieldCount;c<f.schema.fields.length;++c){var g=f.schema.fields[c];b.add(g.comment,a[g.name])}})})};c.prototype.getStyleSheet=function(a){this.bwgHolder.await(function(b){if(!b)return a(null,"bbi error");var c=new E;if("bigbed"==b.type){var g=new f;g.glyph="BOX";g.FGCOLOR=
            "black";g.BGCOLOR="blue";g.HEIGHT=8;g.BUMP=!0;g.LABEL=!0;g.ZINDEX=20;c.pushStyle({type:"bigwig"},null,g);g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="red";g.HEIGHT=10;g.BUMP=!0;g.ZINDEX=20;c.pushStyle({type:"translation"},null,g);g=new f;g.glyph="BOX";g.FGCOLOR="black";g.BGCOLOR="white";g.HEIGHT=10;g.ZINDEX=10;g.BUMP=!0;g.LABEL=!0;c.pushStyle({type:"transcript"},null,g);g=new f;g.glyph="HISTOGRAM";g.COLOR1="white";g.COLOR2="black";g.HEIGHT=30;c.pushStyle({type:"density"},null,g)}else g=new f,g.glyph=
            "HISTOGRAM",g.COLOR1="white",g.COLOR2="black",g.HEIGHT=30,c.pushStyle({type:"default"},null,g);12==b.definedFieldCount&&14<=b.fieldCount&&(c.geneHint=!0);return a(c)})};b.prototype=Object.create(x.prototype);b.prototype.init=function(){var a=this,f=this.bwgSource.uri||this.bwgSource.bwgURI,b=this.bwgSource.blob||this.bwgSource.bwgBlob,c=function(f,b){a.readiness=null;a.notifyReadiness();f?a.worker.postCommand({command:"meta",connection:f},function(b,c){c?(a.error=c,a.keyHolder.provide(null)):(a.meta=
            b,a.keyHolder.provide(f))}):(a.error=b,a.keyHolder.provide(null))};b?this.worker.postCommand({command:"connectBBI",blob:b},c):this.worker.postCommand({command:"connectBBI",uri:O(f),credentials:this.bwgSource.credentials},c)};b.prototype.capabilities=function(){var a={leap:!0};this.meta&&"bigwig"==this.meta.type&&(a.quantLeap=!0);if(this.meta&&this.meta.extraIndices&&0<this.meta.extraIndices.length){a.search=[];for(var f=0;f<this.meta.extraIndices.length;++f)a.search.push(this.meta.extraIndices[f].field)}return a};
        b.prototype.fetch=function(a,f,b,c,g,d,l){var e=this;e.busy++;e.notifyActivity();this.keyHolder.await(function(d){if(!d)return e.busy--,e.notifyActivity(),l(e.error||"Can't access binary file",null,null);var q=-1,k=!g||0==g.length||0<=P(g,"density");e.opts.clientBin&&(k=!1);if("bigwig"==e.meta.type||k||"undefined"!==typeof e.opts.forceReduction){for(k=1;k<e.meta.zoomLevels.length;++k)if(e.meta.zoomLevels[k]<=c)q=k-1;else break;"undefined"!==typeof e.opts.forceReduction&&(q=e.opts.forceReduction)}e.worker.postCommand({command:"fetch",
            connection:d,chr:a,min:f,max:b,zoom:q},function(a,c){e.busy--;e.notifyActivity();var g=1E9;if("bigwig"===e.meta.type){var d=(b-f)/a.length/2;d<g&&(g=d)}if(e.opts.link)for(d=0;d<a.length;++d){var q=a[d];q.label&&(q.links=[new I("Link",e.opts.link.replace(/\$\$/,q.label))])}l(c,a,g)})})};b.prototype.quantFindNextFeature=function(a,f,b,c,g){var d=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"quantLeap",connection:this.keyHolder.res,chr:a,pos:f,dir:b,threshold:c,under:!1},function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         f){console.log(a,f);d.busy--;d.notifyActivity();return g(a,f)})};b.prototype.findNextFeature=function(a,f,b,c){var g=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"leap",connection:this.keyHolder.res,chr:a,pos:f,dir:b},function(a,f){g.busy--;g.notifyActivity();0<a.length&&null!=a[0]&&c(a[0])})};b.prototype.getScales=function(){var a=this.meta;return a?a.zoomLevels:null};b.prototype.search=function(a,f){if(!this.meta.extraIndices||0==this.meta.extraIndices.length)return f(null,
            "No indices available");var b=this;this.busy++;this.notifyActivity();this.worker.postCommand({command:"search",connection:this.keyHolder.res,query:a,index:this.meta.extraIndices[0]},function(a,c){b.busy--;b.notifyActivity();f(a,c)})};b.prototype.getDefaultFIPs=function(a){if(this.opts.noExtraFeatureInfo)return!0;var f=this;this.keyHolder.await(function(b){var c=f.meta;c&&c.schema&&c.definedFieldCount<c.schema.fields.length&&a(function(a,f){for(var b=0;b<f.hit.length;++b)if(f.hit[b].isSuperGroup)return;
            for(b=c.definedFieldCount;b<c.schema.fields.length;++b){var g=c.schema.fields[b];f.add(g.comment,a[g.name])}})})};b.prototype.getStyleSheet=function(a){var b=this;this.keyHolder.await(function(c){c=b.meta;if(!c)return a(null,"bbi error");var g=new E;if("bigbed"==c.type){var d=new f;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="blue";d.HEIGHT=8;d.BUMP=!0;d.LABEL=!0;d.ZINDEX=20;g.pushStyle({type:"bigwig"},null,d);d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="red";d.HEIGHT=10;d.BUMP=!0;d.ZINDEX=20;g.pushStyle({type:"translation"},
            null,d);d=new f;d.glyph="BOX";d.FGCOLOR="black";d.BGCOLOR="white";d.HEIGHT=10;d.ZINDEX=10;d.BUMP=!0;d.LABEL=!0;g.pushStyle({type:"transcript"},null,d);d=new f;d.glyph="HISTOGRAM";d.COLOR1="white";d.COLOR2="black";d.HEIGHT=30;g.pushStyle({type:"density"},null,d)}else d=new f,d.glyph="HISTOGRAM",d.COLOR1="white",d.COLOR2="black",d.HEIGHT=30,g.pushStyle({type:"default"},null,d);12==c.definedFieldCount&&14<=c.fieldCount&&(g.geneHint=!0);return a(g)})};a.prototype=Object.create(x.prototype);a.prototype.init=
            function(){var a=this,f,b;this.bamSource.bamBlob?(f=new J(this.bamSource.bamBlob),b=new J(this.bamSource.baiBlob)):(f=new C(this.bamSource.bamURI,{credentials:this.opts.credentials}),b=new C(this.bamSource.baiURI||this.bamSource.bamURI+".bai",{credentials:this.opts.credentials}));M(f,b,function(f,b){a.readiness=null;a.notifyReadiness();f?a.bamHolder.provide(f):(a.error=b,a.bamHolder.provide(null))})};a.prototype.fetch=function(a,f,b,c,g,d,l){var e=g&&1==g.length&&"density"==g[0],q=this;q.busy++;q.notifyActivity();
            this.bamHolder.await(function(c){if(!c)return q.busy--,q.notifyActivity(),l(q.error||"Couldn't fetch BAM");c.fetch(a,f,b,function(a,f){q.busy--;q.notifyActivity();if(f)l(f,null,null);else{for(var b=[],c=0;c<a.length;++c){var g=n(a[c],q.opts.bamGroup);g&&b.push(g)}l(null,b,1E9)}},{light:e})})};a.prototype.getScales=function(){return 1E9};a.prototype.getStyleSheet=function(a){this.bamHolder.await(function(b){b=new E;var c=new f;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";c.HEIGHT=30;b.pushStyle({type:"density"},
            "low",c);b.pushStyle({type:"density"},"medium",c);c=new f;c.glyph="__SEQUENCE";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!1;c.ZINDEX=20;b.pushStyle({type:"bam"},"high",c);return a(b)})};u.prototype=Object.create(x.prototype);u.prototype.init=function(){var a=this,f=this.bamSource.uri||this.bamSource.bamURI,b=this.bamSource.indexUri||this.bamSource.baiURI||f+".bai",c=this.bamSource.bamBlob||this.bamSource.blob,g=this.bamSource.baiBlob||this.bamSource.indexBlob,d=function(f,b){a.readiness=
            null;a.notifyReadiness();f?a.keyHolder.provide(f):(a.error=b,a.keyHolder.provide(null))};c?this.worker.postCommand({command:"connectBAM",blob:c,indexBlob:g},d):this.worker.postCommand({command:"connectBAM",uri:O(f),indexUri:O(b),credentials:this.bamSource.credentials},d)};u.prototype.fetch=function(a,f,b,c,g,d,l){var e=g&&1==g.length&&"density"==g[0],q=this;q.busy++;q.notifyActivity();this.keyHolder.await(function(c){if(!c)return q.busy--,q.notifyActivity(),l(q.error||"Couldn't fetch BAM");q.worker.postCommand({command:"fetch",
            connection:c,chr:a,min:f,max:b,opts:{light:e}},function(a,f){q.busy--;q.notifyActivity();if(f)l(f,null,null);else{for(var b=[],c=0;c<a.length;++c){var g=n(a[c],q.opts.bamGroup);g&&b.push(g)}l(null,b,1E9)}})})};u.prototype.getScales=function(){return 1E9};u.prototype.getStyleSheet=function(a){this.keyHolder.await(function(b){b=new E;var c=new f;c.glyph="HISTOGRAM";c.COLOR1="black";c.COLOR2="red";c.HEIGHT=30;b.pushStyle({type:"density"},"low",c);b.pushStyle({type:"density"},"medium",c);c=new f;c.glyph=
            "__SEQUENCE";c.FGCOLOR="black";c.BGCOLOR="blue";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!1;c.ZINDEX=20;b.pushStyle({type:"bam"},"high",c);return a(b)})};t.prototype.addActivityListener=function(a){this.activityListeners.push(a)};t.prototype.notifyActivity=function(){for(var a=0;a<this.activityListeners.length;++a)try{this.activityListeners[a](this.busy)}catch(f){console.log(f)}};t.prototype.getStyleSheet=function(a){return this.source.getStyleSheet(a)};t.prototype.getScales=function(){return this.source.getScales()};
        t.prototype.simplifySegments=function(a,f){if(0==a.length)return a;a.sort(function(a,f){var b=a.name-f.name;return b?b:(b=a.start-f.start)?b:a.end-f.end});for(var b=[],c=a[0],g=0;g<a.length;++g){var d=a[g];d.name!=c.name||d.start>c.end+f?(b.push(c),c=d):c=new l(c.name,Math.min(c.start,d.start),Math.max(c.end,d.end))}b.push(c);return b};t.prototype.fetch=function(a,f,b,c,g,d,l){var e=this,q=b-f+1;e.busy++;e.notifyActivity();this.mapping.sourceBlocksForRange(a,f,b,function(f){if(0==f.length)e.busy--,
            e.notifyActivity(),l("No mapping available for this regions",[],c);else{f=e.simplifySegments(f,Math.max(100,0.05*q));var b=[],k=null,n=f.length,h;f.map(function(f){e.source.fetch(f.name,f.start,f.end,c,g,d,function(c,g,d){c&&!h&&(h=c);if(g)for(c=0;c<g.length;++c){var q=g[c],t=q.segment;0==t.indexOf("chr")&&(t=t.substr(3));var m=e.mapping.mapPoint(t,q.min),t=e.mapping.mapPoint(t,q.max);m&&t&&m.seq==t.seq&&m.seq==a?(q=D(q),q.segment=m.seq,q.min=m.pos,q.max=t.pos,q.min>q.max&&(t=q.max,q.max=q.min,q.min=
            t),m.flipped&&("-"==q.orientation?q.orientation="+":"+"==q.orientation&&(q.orientation="-")),b.push(q)):q.parts&&0<q.parts.length&&b.push(q)}g=e.mapping.mapPoint(f.name,f.start);c=e.mapping.mapPoint(f.name,f.end);g&&c&&(g=new Z(g.pos,c.pos),k=k?fa(k,g):g);--n;0==n&&(e.busy--,e.notifyActivity(),l(h,b,d,k))})})}})};w.prototype.getScales=function(){return null};w.prototype.fetch=function(a,f,b,c,g,d,l){return l(null,[],1E9)};w.prototype.getStyleSheet=function(a){var b=new E,c=new f;c.glyph="BOX";c.BGCOLOR=
            "blue";c.FGCOLOR="black";b.pushStyle({type:"default"},null,c);return a(b)};F.prototype.fetch=function(a,f,b,c,g){return g(null,null)};B.prototype.getScales=function(){return null};B.prototype.getStyleSheet=function(a){var b=new E,c=new f;c.glyph="BOX";c.FGCOLOR="black";c.BGCOLOR="green";c.HEIGHT=8;c.BUMP=!0;c.LABEL=!0;c.ZINDEX=20;b.pushStyle({type:"default"},null,c);return a(b)};B.prototype.fetch=function(a,f,b,c,g,d,e){g&&0==g.length?e(null,[],c):this.store.features(new l(a,f,b),{},function(a,f){e(f,
            a,1E5)})};Q.prototype.sourceAdapterIsCapable=function(a,f){return a.capabilities?a.capabilities()[f]:!1};"undefined"!==typeof y&&(y.exports={FeatureSourceBase:x,TwoBitSequenceSource:d,DASSequenceSource:z,MappedFeatureSource:t,CachingFeatureSource:k,BWGFeatureSource:c,RemoteBWGFeatureSource:b,BAMFeatureSource:a,RemoteBAMFeatureSource:u,DummyFeatureSource:w,DummySequenceSource:F,registerSourceAdapterFactory:m,registerParserFactory:e,makeParser:s},h("./ensembljson"),h("./tabix-source"),h("./memstore"),
            h("./bedwig"),h("./vcf"))},{"./bam":1,"./bedwig":2,"./bigwig":3,"./bin":4,"./cbrowser":6,"./cigar":8,"./das":10,"./ensembljson":12,"./jbjson":20,"./memstore":23,"./overlay":25,"./spans":33,"./tabix-source":36,"./tier":41,"./twoBit":44,"./utils":45,"./vcf":46}],33:[function(h,y,r){function m(d,c){if("number"!=typeof d||"number"!=typeof c)throw"Bad range "+d+","+c;this._min=d;this._max=c}function e(d){this._ranges=d}function s(d,c){d instanceof Array||(d=[d],c&&d.push(c));if(0==d.length)return null;
        if(1==d.length)return d[0];for(var b=[],k=0;k<d.length;++k)d[k]._pushRanges(b);for(var b=b.sort(z),k=[],a=b[0],a=new m(a._min,a._max),h=1;h<b.length;++h){var t=b[h];t._min>a._max+1?(k.push(a),a=new m(t._min,t._max)):t._max>a._max&&(a._max=t._max)}k.push(a);return 1==k.length?k[0]:new e(k)}function k(d,c){for(var b=d.ranges(),k=c.ranges(),a=b.length,h=k.length,t=0,p=0,s=[];t<a&&p<h;){d=b[t];c=k[p];var r=Math.max(d.min(),c.min()),x=Math.min(d.max(),c.max());x>=r&&s.push(new m(r,x));d.max()>c.max()?
        ++p:++t}return 0==s.length?null:1==s.length?s[0]:new e(s)}function x(d){var c=0;d=d.ranges();for(var b=0;b<d.length;++b)var e=d[b],c=c+(e.max()-e.min()+1);return c}function p(d,c){return d.min()<c.min()?-1:d.min()>c.min()?1:d.max()<c.max()?-1:c.max()>d.max()?1:0}function z(d,c){return d._min<c._min?-1:d._min>c._min?1:d._max<c._max?-1:c._max>d._max?1:0}m.prototype.min=function(){return this._min};m.prototype.max=function(){return this._max};m.prototype.contains=function(d){return d>=this._min&&d<=
        this._max};m.prototype.isContiguous=function(){return!0};m.prototype.ranges=function(){return[this]};m.prototype._pushRanges=function(d){d.push(this)};m.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"};e.prototype.min=function(){return this._ranges[0].min()};e.prototype.max=function(){return this._ranges[this._ranges.length-1].max()};e.prototype.contains=function(d){for(var c=0;c<this._ranges.length;++c)if(this._ranges[c].contains(d))return!0;return!1};e.prototype.isContiguous=
        function(){return 1<this._ranges.length};e.prototype.ranges=function(){return this._ranges};e.prototype._pushRanges=function(d){for(var c=0;c<this._ranges.length;++c)d.push(this._ranges[c])};e.prototype.toString=function(){for(var d="",c=0;c<this._ranges.length;++c)0<c&&(d+=","),d+=this._ranges[c].toString();return d};"undefined"!==typeof y&&(y.exports={Range:m,union:s,intersection:k,coverage:x,rangeOver:p,_rangeOrder:z})},{}],34:[function(h,y,r){if("undefined"!==typeof h){var m=h("./cbrowser").Browser,
        e=h("./utils").makeElementNS,s=h("./version"),k=h("./sequence-draw").svgSeqTier;y=h("./svg-utils");var x=y.NS_SVG,p=y.NS_XLINK,z=y.SVGPath,d=h("./numformats").formatQuantLabel}m.prototype.makeSVG=function(c){c=c||{};var b=c.minTierHeight||20,n=document.implementation.createDocument(x,"svg",null),a=e(x,"g",null,{fontFamily:"helvetica",fontSize:"8pt"});n.documentElement.appendChild(a);var h=e(x,"a",e(x,"text","Graphics from Dalliance "+s,{x:(this.featurePanelWidth+200+20)/2,y:30,strokeWidth:0,fontSize:"12pt",
        textAnchor:"middle",fill:"blue"}));h.setAttribute("xmlns:xlink",p);h.setAttribute("xlink:href","http://www.biodalliance.org/");a.appendChild(h);h=e(x,"rect",null,{x:200,y:50,width:this.featurePanelWidth,height:1E5});h=e(x,"clipPath",h,{id:"featureClip"});a.appendChild(h);for(var h=70,t=e(x,"g",null,{}),m=0;m<this.tiers.length;++m){var r=this.tiers[m],B=e(x,"g",null,{clipPath:"url(#featureClip)",clipRule:"nonzero"}),y=e(x,"g"),G=h,A=e(x,"rect",null,{x:0,y:G,width:"10000",height:50,fill:r.background});
        B.appendChild(A);if(r.sequenceSource){var P=k(r,r.currentSequence);B.appendChild(e(x,"g",P,{transform:"translate(200, "+h+")"}));h+=80}else{if(!r.subtiers)continue;for(var P=(r.glyphCacheOrigin-this.viewStart)*this.scale,D=!1,O=0;O<r.subtiers.length;++O){for(var h=h+3,E=r.subtiers[O],f=[],q=0;q<E.glyphs.length;++q)f.push(E.glyphs[q].toSVG());B.appendChild(e(x,"g",f,{transform:"translate("+(200+P)+", "+h+")"}));if(E.quant){var D=!0,f=E.quant,l=E.height,q=2;40<l&&(q=1+(l/20|0));var l=l/(q-1),g=(f.max-
            f.min)/(q-1),v=new z;v.moveTo(205,h);v.lineTo(200,h);v.lineTo(200,h+E.height);v.lineTo(205,h+E.height);for(var I=1;I<q-1;++I){var C=I*l;v.moveTo(200,h+C);v.lineTo(203,h+C)}y.appendChild(e(x,"path",null,{d:v.toPathData(),fill:"none",stroke:"black",strokeWidth:"2px"}));y.appendChild(e(x,"text",d(f.max),{x:197,y:h+7,textAnchor:"end"}));y.appendChild(e(x,"text",d(f.min),{x:197,y:h+E.height,textAnchor:"end"}));for(I=1;I<q-1;++I)C=I*l,y.appendChild(e(x,"text",d(1*f.max-I*g),{x:197,y:h+C+3,textAnchor:"end"}))}h+=
            E.height+3}h-G<b&&(h=G+b)}y.appendChild(e(x,"text","string"===typeof r.config.name?r.config.name:r.dasSource.name,{x:200-(D?20:12),y:(h+G+8)/2,fontSize:"10pt",textAnchor:"end"}));A.setAttribute("height",h-G);t.appendChild(e(x,"g",[B,y]))}if(c.highlights)for(b=this.highlights||[],D=0;D<b.length;++D)l=b[D],(l.chr==this.chr||l.chr=="chr"+this.chr)&&l.min<this.viewEnd&&l.max>this.viewStart&&(m=(Math.max(l.min,this.viewStart)-this.viewStart)*this.scale,r=(Math.min(l.max,this.viewEnd)-this.viewStart)*this.scale,
        t.appendChild(e(x,"rect",null,{x:200+m,y:70,width:r-m,height:h-70,stroke:"none",fill:this.defaultHighlightFill,fillOpacity:this.defaultHighlightAlpha})));b=-1;"center"==c.ruler?b=200+(this.viewEnd-this.viewStart+1)*this.scale/2:"left"==c.ruler?b=200:"right"==c.ruler&&(b=200+(this.viewEnd-this.viewStart+1)*this.scale);0<=b&&t.appendChild(e(x,"line",null,{x1:b,y1:70,x2:b,y2:h,stroke:"blue"}));a.appendChild(t);n.documentElement.setAttribute("width",this.featurePanelWidth+20+200);n.documentElement.setAttribute("height",
            h+50);return new Blob([(new XMLSerializer).serializeToString(n)],{type:"image/svg+xml"})}},{"./cbrowser":6,"./numformats":24,"./sequence-draw":29,"./svg-utils":35,"./utils":45,"./version":47}],35:[function(h,y,r){function m(){this.ops=[]}m.prototype.moveTo=function(e,h){this.ops.push("M "+e+" "+h)};m.prototype.lineTo=function(e,h){this.ops.push("L "+e+" "+h)};m.prototype.closePath=function(){this.ops.push("Z")};m.prototype.toPathData=function(){return this.ops.join(" ")};"undefined"!==typeof y&&(y.exports=
    {NS_SVG:"http://www.w3.org/2000/svg",NS_XLINK:"http://www.w3.org/1999/xlink",SVGPath:m})},{}],36:[function(h,y,r){function m(c){k.call(this);this.readiness="Connecting";this.source=c;this.tabixHolder=new z;var b=this,e=s(c.payload);if(e)this.parser=e;else throw"Unsuported tabix payload "+c.payload;var a;this.source.blob?(c=new p(this.source.blob),a=new p(this.source.indexBlob)):(c=new x(this.source.uri,{credentials:this.source.credentials}),a=new x(this.source.indexURI||this.source.uri+".tbi",{credentials:this.source.credentials}));
        d(c,a,function(a,c){b.tabixHolder.provide(a);a.fetchHeader(function(a,b){if(a){for(var c=e.createSession(function(){}),d=0;d<a.length;++d)c.parse(a[d]);c.flush()}});b.readiness=null;b.notifyReadiness()})}if("undefined"!==typeof h){y=h("./sourceadapters");var e=y.registerSourceAdapterFactory,s=y.makeParser,k=y.FeatureSourceBase;y=h("./bin");var x=y.URLFetchable,p=y.BlobFetchable,z=h("./utils").Awaited,d=h("./tabix").connectTabix}m.prototype=Object.create(k.prototype);m.prototype.fetch=function(c,b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          d,a,e,k,h){var m=this;m.busy++;m.notifyActivity();this.tabixHolder.await(function(a){a.fetch(c,b,d,function(a,b){m.busy--;m.notifyActivity();for(var c=[],d=m.parser.createSession(function(a){c.push(a)}),e=0;e<a.length;++e)d.parse(a[e]);d.flush();h(null,c,1E9)})})};m.prototype.getStyleSheet=function(c){this.parser&&this.parser.getStyleSheet&&this.parser.getStyleSheet(c)};m.prototype.getDefaultFIPs=function(c){this.parser&&this.parser.getDefaultFIPs&&this.parser.getDefaultFIPs(c)};e("tabix",function(c){return{features:new m(c)}})},
        {"./bin":4,"./sourceadapters":32,"./tabix":37,"./utils":45}],37:[function(h,y,r){function m(){}function e(c,b,d){var a=new m;a.data=c;a.tbi=b;a.tbi.fetch(function(b){if(!b)return d(null,"Couldn't access Tabix");b=p(b,b.byteLength);var c=new Uint8Array(b);if(k(c,0)!=s)return d(null,"Not a tabix index");var e=k(c,4);a.format=k(c,8);a.colSeq=k(c,12);a.colStart=k(c,16);a.colEnd=k(c,20);a.meta=k(c,24);a.skip=k(c,28);k(c,32);a.indices=[];var h=36;a.chrToIndex={};a.indexToChr=[];for(var m=0;m<e;++m){for(var r=
        "";;){var y=c[h++];if(0==y)break;r+=String.fromCharCode(y)}a.chrToIndex[r]=m;0==r.indexOf("chr")?a.chrToIndex[r.substring(3)]=m:a.chrToIndex["chr"+r]=m;a.indexToChr.push(r)}r=1E9;for(y=0;y<e;++y){for(var A=h,z=k(c,h),h=h+4,m=0;m<z;++m){k(c,h);var D=k(c,h+4),h=h+(8+16*D)}for(var D=k(c,h),O=h+=4,m=0;m<D;++m){var E=x(c,O),O=O+8;if(E){m=E.block;0<E.offset&&(m+=65536);m<r&&(r=m);break}}h+=8*D;0<z&&(a.indices[y]=new Uint8Array(b,A,h-A))}a.headerMax=r;d(a)})}var s=21578324;if("undefined"!==typeof h){h("./spans");
        var k=h("./bin").readInt;h=h("./lh3utils");var x=h.readVob,p=h.unbgzf,z=h.reg2bins,d=h.Chunk}m.prototype.blocksForRange=function(c,b,e){var a=this.indices[c];if(!a)return[];c=z(b,e);for(var h=[],t=0;t<c.length;++t)h[c[t]]=!0;c=[];for(var m=[],t=k(a,0),p=4,s=0;s<t;++s){var r=k(a,p),y=k(a,p+4),p=p+8;if(h[r])for(var A=0;A<y;++A){var P=x(a,p),D=x(a,p+8);(4681>r?m:c).push(new d(P,D));p+=16}else p+=16*y}t=k(a,p);h=null;b=Math.min(b>>14,t-1);e=Math.min(e>>14,t-1);for(t=b;t<=e;++t)(b=x(a,p+4+8*t))&&(!h||
        b.block<h.block||b.offset<h.offset)&&(h=b);a=[];if(null!=h)for(t=0;t<m.length;++t)e=m[t],e.maxv.block>=h.block&&e.maxv.offset>=h.offset&&a.push(e);m=a;a=[];for(t=0;t<m.length;++t)a.push(m[t]);for(t=0;t<c.length;++t)a.push(c[t]);a.sort(function(a,b){var f=a.minv.block-b.minv.block;return 0!=f?f:a.minv.offset-b.minv.offset});c=[];if(0<a.length){m=a[0];for(t=1;t<a.length;++t)e=a[t],e.minv.block==m.maxv.block?m=new d(m.minv,e.maxv):(c.push(m),m=e);c.push(m)}return c};m.prototype.fetch=function(c,b,d,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       a){function e(){if(r>=m.length)return a(s);if(x){var c=new Uint8Array(x);k.readRecords(c,m[r].minv.offset,s,b,d,h);x=null;++r;return e()}var y=m[r],c=y.minv.block;k.data.slice(c,y.maxv.block+65536-c).fetch(function(a){x=p(a,y.maxv.block-y.minv.block+1);return e()})}var k=this;c=this.chrToIndex[c];if(void 0==c)return a([]);var h=this.indexToChr[c],m;void 0===c?m=[]:(m=this.blocksForRange(c,b,d))||a(null,"Error in index fetch");var s=[],r=0,x;e()};m.prototype.readRecords=function(c,b,d,a,e,k){a:for(;;){for(var h=
        "";b<c.length;){var m=c[b++];if(10==m){m=h.split("\t");if(m[this.colSeq-1]==k){var p=parseInt(m[this.colStart-1]),s=p;0<this.colEnd&&(s=parseInt(m[this.colEnd-1]));this.format&65536&&++p;p<=e&&s>=a&&d.push(h)}continue a}else h+=String.fromCharCode(m)}break}};m.prototype.fetchHeader=function(c){var b=this;b.data.slice(0,b.headerMax).fetch(function(d){if(!d)return c(null,"Fetch failed");d=new Uint8Array(p(d,d.byteLength));for(var a=0,e="",k=[];a<d.length;){var h=d[a++];if(10==h)if(e.charCodeAt(0)==
        b.meta)k.push(e),e="";else return c(k);else e+=String.fromCharCode(h)}c(k)})};"undefined"!==typeof y&&(y.exports={connectTabix:e,TABIX_MAGIC:s})},{"./bin":4,"./lh3utils":22,"./spans":33}],38:[function(h,y,r){function m(a){this.genomes={};this.url=a}function e(){}function s(a){this.hub=a}function k(b,c,d){d=d||{};d.salt=!0;p(b,function(e,k){if(k)return c(null,k);var h=e.split(a),u=new m(b);d.credentials&&(u.credentials=d.credentials);for(var r=0;r<h.length-2;r+=3)u[h[r+1]]=h[r+2];if(u.genomesFile){var x=
        z(b,u.genomesFile);p(x,function(b,e){if(e)return c(null,e);for(var f=b.split(n),q=0;q<f.length;++q){var l=f[q].split(a),g=new s(u);d.credentials&&(g.credentials=d.credentials);for(var k=0;k<l.length-2;k+=3)g[l[k+1]]=l[k+2];g.twoBitPath&&(g.twoBitPath=z(x,g.twoBitPath));g.genome&&g.trackDb&&(g.absURL=z(x,g.trackDb),u.genomes[g.genome]=g)}c(u)},d)}else c(null,"No genomesFile")},d)}function x(a,b){return a.priority&&b.priority?1*a.priority-1*b.priority:a.priority?1:b.priority?-1:a.shortLabel.localeCompare(b.shortLabel)}
        if("undefined"!==typeof h){r=h("./utils");var p=r.textXHR,z=r.relativeURL,d=r.shallowCopy;h=h("./das");var c=h.DASStylesheet,b=h.DASStyle}var n=/\n\s*\n/,a=/(\w+) +(.+)\n?/,u=/subGroup[1-9]/;e.prototype.get=function(a){if(this[a])return this[a];if(this._parent)return this._parent.get(a)};s.prototype.getTracks=function(b){var c=this;if(this._tracks)return b(this._tracks);p(this.absURL,function(d,k){if(k)return b(null,k);d=d.replace("\\\n"," ");for(var h=[],m={},p=d.split(n),s=0;s<p.length;++s){var r=
            p[s].replace(/\#.*/g,"").split(a),x=new e;x._db=c;for(var y=0;y<r.length-2;y+=3){var f=r[y+1],q=r[y+2];if(f.match(u)){x.subgroups||(x.subgroups={});for(var f=q.split(/\s/),q=f[0],l={name:f[1],tags:[],titles:[]},g=2;g<f.length;++g){var v=f[g].split(/=/);l.tags.push(v[0]);l.titles.push(v[1])}x.subgroups[q]=l}else if("subGroups"===f)for(f=q.split(/(\w+)=(\w+)/),x.sgm={},g=0;g<f.length-2;g+=3)x.sgm[f[g+1]]=f[g+2];else x[r[y+1]]=r[y+2]}x.track&&(x.type||x.container||x.view||x.bigDataUrl)&&(h.push(x),m[x.track]=
            x)}p=[];s=[];for(f=0;f<h.length;++f)x=h[f],r=!0,x.parent&&(y=x.parent.split(/\s+/),(q=m[y[0]])?(x._parent=q,q.children||(q.children=[]),q.children.push(x),q&&(r=!1)):console.log("Couldn't find parent "+y[0]+"("+x.parent+")")),x.compositeTrack?s.push(x):r&&p.push(x);for(h=0;h<s.length;++h)if(m=s[h],m.children){x=!1;for(r=0;r<m.children.length;++r)f=m.children[r],f.view&&(f.shortLabel=m.shortLabel+": "+f.shortLabel,p.push(f),x=!0);x||p.push(m)}c._tracks=p;return b(c._tracks,null)},{credentials:this.credentials,
            salt:!0})};e.prototype.toDallianceSource=function(){var a={name:this.shortLabel,desc:this.longLabel};this._db.mapping&&(a.mapping=this._db.mapping);var b=this.get("pennantIcon");b&&(b=b.split(/\s+/),a.pennant="http://genome.ucsc.edu/images/"+b[0]);if(b=this.get("searchTrix"))a.trixURI=z(this._db.absURL,b);if("multiWig"==this.container){a.merge="concat";a.overlay=[];b=this.children||[];a.style=[];a.noDownsample=!0;for(var c=0;c<b.length;++c){var d=b[c],e=d.toDallianceSource();a.overlay.push(e);if(e.style)for(var k=
            0;k<e.style.length;++k){var h=e.style[k];h.method=d.shortLabel;"transparentOverlay"==this.aggregate&&(h.style.ALPHA=0.5);a.style.push(h)}}return a}b=this.type;if(!b){for(b=this;b._parent&&!b.type;)b=b._parent;b=b.type}if(b){c=b.split(/\s+/);if("bigBed"==c[0]&&this.bigDataUrl)return b=c[1]|0,c="+"==c[2],a.bwgURI=z(this._db.absURL,this.bigDataUrl),a.style=this.bigbedStyles(),this._db.credentials&&(a.credentials=!0),12<=b&&c&&(a.collapseSuperGroups=!0),a;if("bigWig"==c[0]&&this.bigDataUrl)return a.bwgURI=
            z(this._db.absURL,this.bigDataUrl),a.style=this.bigwigStyles(),a.noDownsample=!0,this.yLineOnOff&&"on"==this.yLineOnOff&&(a.quantLeapThreshold=void 0!==this.yLineMark?1*this.yLineMark:0),this._db.credentials&&(a.credentials=!0),a;if("bam"==c[0]&&this.bigDataUrl)return a.bamURI=z(this._db.absURL,this.bigDataUrl),this._db.credentials&&(a.credentials=!0),a;if("vcfTabix"==c[0]&&this.bigDataUrl)return a.uri=z(this._db.absURL,this.bigDataUrl),a.tier_type="tabix",a.payload="vcf",this._db.credentials&&(a.credentials=
            !0),a;console.log("Unsupported "+this.type)}};e.prototype.bigwigStyles=function(){var a=this.type;if(!a){for(a=this;a._parent&&!a.type;)a=a._parent;a=a.type}if(a){var a=a.split(/\s+/),d,e;3<=a.length&&(d=1*a[1],e=1*a[2]);var k;this.maxHeightPixels&&(a=this.maxHeightPixels.split(/:/),3==a.length?k=a[1]|0:console.log("maxHeightPixels should be of the form max:default:min"));a="bars";this.graphTypeDefault&&(a=this.graphTypeDefault);var h="black",n=null;this.color&&(h="rgb("+this.color+")");this.altColor&&
        (n="rgb("+this.altColor+")");var m=new c,p=new b;p.glyph="points"==a?"POINT":"HISTOGRAM";n?(p.COLOR1=h,p.COLOR2=n):p.BGCOLOR=h;p.HEIGHT=k||30;if(d||e)p.MIN=d,p.MAX=e;m.pushStyle({type:"default"},null,p);return m.styles}};e.prototype.bigbedStyles=function(){var a="on"==(""+this.get("itemRgb")).toLowerCase(),e=this.get("visibility")||"full",k=this.get("color"),k=k?"rgb("+k+")":"blue",h=new c,n=new b;n.glyph="BOX";n.FGCOLOR="black";n.BGCOLOR=k;n.HEIGHT="full"==e||"pack"==e?12:8;n.BUMP="full"==e||"pack"==
            e;n.LABEL="full"==e||"pack"==e;n.ZINDEX=20;a&&(n.BGITEM=!0);(e=this.get("colorByStrand"))?(e=e.split(/\s+/),k=d(n),k.BGCOLOR="rgb("+e[0]+")",h.pushStyle({type:"bigwig",orientation:"+"},null,k),n=d(n),n.BGCOLOR="rgb("+e[1]+")",h.pushStyle({type:"bigwig",orientation:"-"},null,n)):h.pushStyle({type:"bigwig"},null,n);n=new b;n.glyph="BOX";n.FGCOLOR="black";a&&(n.BGITEM=!0);n.BGCOLOR="red";n.HEIGHT=10;n.BUMP=!0;n.ZINDEX=20;h.pushStyle({type:"translation"},null,n);a=new b;a.glyph="BOX";a.FGCOLOR="black";
            a.BGCOLOR="white";a.HEIGHT=10;a.ZINDEX=10;a.BUMP=!0;a.LABEL=!0;h.pushStyle({type:"transcript"},null,a);return h.styles};"undefined"!==typeof y&&(y.exports={connectTrackHub:k,THUB_COMPARE:x})},{"./das":10,"./utils":45}],39:[function(h,y,r){if("undefined"!==typeof h)var m=h("./cbrowser").Browser,e=h("./utils").shallowCopy;m.prototype.mergeSelectedTiers=function(){for(var h=[],k=[],m=0;m<this.selectedTiers.length;++m){var p=this.tiers[this.selectedTiers[m]];h.push(e(p.dasSource));for(var r=p.stylesheet.styles,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      d=0;d<r.length;++d){var c=r[d],b=e(c);b.method=p.dasSource.name.replace(/[()+*?]/g,"\\$&");b._methodRE=null;b.style=e(c.style);void 0===b.style.ZINDEX&&(b.style.ZINDEX=m);p.forceMin&&(b.style.MIN=p.forceMin);p.forceMax&&(b.style.MAX=p.forceMax);k.push(b)}}this.addTier({name:"Merged",merge:"concat",overlay:h,noDownsample:!0,style:k});this.setSelectedTier(this.tiers.length-1)}},{"./cbrowser":6,"./utils":45}],40:[function(h,y,r){function m(d){for(var c=0;c<d.styles.length;++c){var b=d.styles[c].style;
        if("__SEQUENCE"===b.glyph)return b}}if("undefined"!==typeof h){var e=h("./cbrowser").Browser,s=h("./utils").makeElement;y=h("./das");var k=y.isDasBooleanTrue,x=y.copyStylesheet,p=h("./color").dasColourForName}var z={DOT:!0,EX:!0,STAR:!0,SQUARE:!0,CROSS:!0,TRIANGLE:!0,PLIMSOLL:!0};e.prototype.openTierPanel=function(d){if("tier"===this.uiMode&&this.manipulatingTier===d)this.hideToolPanel(),this.setUiMode("none");else{var c=function(a){a.BGGRAD||(1==E?("LINEPLOT"==a.glyph||z[a.glyph]?a.FGCOLOR=Q.value:
        a.BGCOLOR=Q.value,a.COLOR1=a.COLOR2=a.COLOR3=null):(a.COLOR1=Q.value,a.COLOR2=G.value,a.COLOR3=2<E?A.value:null),a._gradient=null)},b=function(a){for(var f=x(d.stylesheet),b=d.browser.zoomForCurrentScale(),c=0;c<f.styles.length;++c){var g=f.styles[c];g.zoom&&g.zoom!=b||a(g.style)}return f},e=function(a){d.mergeConfig({stylesheet:b(c)})};this.manipulatingTier=d;var a=s("div",null,{className:"tier-edit"});if(d.dasSource.mapping){var h=this.chains[d.dasSource.mapping].coords;a.appendChild(s("div","Mapped from "+
        h.auth+h.version,null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center"}))}var t=s("div","Editing styles for current zoom level",null,{background:"gray",paddingBottom:"5px",marginBottom:"5px",textAlign:"center",display:"none"});a.appendChild(t);var r=s("input",null,{type:"text"}),y=s("input",null,{type:"checkbox",disabled:this.disablePinning}),B=s("select");B.appendChild(s("option","Histogram",{value:"HISTOGRAM"}));B.appendChild(s("option","Line Plot",{value:"LINEPLOT"}));
        B.appendChild(s("option","Ribbon",{value:"GRADIENT"}));B.appendChild(s("option","Scatter",{value:"SCATTER"}));var Q=s("input",null,{type:"text",value:"#dd00dd"}),G=s("input",null,{type:"text",value:"#dd00dd"}),A=s("input",null,{type:"text",value:"#dd00dd"});try{Q.type=G.type=A.type="color"}catch(P){}var D=[Q,G,A],h=s("i",null,{className:"fa fa-plus-circle"}),O=s("i",null,{className:"fa fa-minus-circle"}),E=1,f=s("td",D),q=function(a){E=a;for(var f=0;f<a;++f)D[f].style.display="block";for(f=a;f<D.length;++f)D[f].style.display=
            "none"};h.addEventListener("click",function(a){3>E&&(q(E+1),e(null))},!1);O.addEventListener("click",function(a){1<E&&(q(E-1),e(null))},!1);var l=s("input",null,{type:"text",value:"0.0"}),g=s("input",null,{type:"text",value:"10.0"}),v=s("input",null,{type:"checkbox"}),I=s("input",null,{type:"checkbox"}),C=s("input",null,{type:"checkbox",checked:void 0!==d.quantLeapThreshold}),J=s("input",null,{type:"text",value:d.quantLeapThreshold,disabled:!C.checked}),V=s("input",null,{type:"text",value:"50"}),
            H=s("input",null,{type:"checkbox"}),M=s("input",null,{type:"text"}),S=s("input",null,{type:"checkbox"}),Z=null;0<d.stylesheet.styles.length&&(Z=d.stylesheet.styles[0].style);var fa=function(){r.value="string"===typeof d.config.name?d.config.name:d.dasSource.name;y.checked=d.pinned;d.forceHeight?V.value=""+d.forceHeight:Z&&Z.HEIGHT&&(V.value=""+Z.HEIGHT);"number"==typeof d.quantLeapThreshold?(C.checked=!0,J.disabled=!1,parseFloat(J.value)!=d.quantLeapThreshold&&(J.value=d.quantLeapThreshold)):(C.checked=
            !1,J.disabled=!0);M.value="number"==typeof d.subtierMax?""+d.subtierMax:""+(d.dasSource.subtierMax||d.browser.defaultSubtierMax);if(0<d.stylesheet.styles.length){for(var a=null,f=!1,b=!1,b=d.browser.zoomForCurrentScale(),c=0,e=0;e<d.stylesheet.styles.length;++e){var h=d.stylesheet.styles[e];if(!h.zoom||h.zoom==b)if(++c,h=d.stylesheet.styles[e].style,a||(a=Z=h),"LINEPLOT"==h.glyph||"HISTOGRAM"==h.glyph||"GRADIENT"==h.glyph||k(h.SCATTER))f||(a=Z=h),f=!0}if(!a)return;t.style.display=c==d.stylesheet.styles.length?
            "none":"block";b=f&&1==c;f?(ba.style.display="table-row",ja.style.display="table-row",ma.style.display="none",ka.style.display="none"):(ba.style.display="none",ja.style.display="none",ma.style.display="table-row",H.checked=k(Z.BUMP),M.disabled=!k(Z.BUMP),ka.style.display="table-row",S.checked=k(Z.LABEL));b?(ga.style.display="table-row",ia.style.display="table-row"):(ga.style.display="none",ia.style.display="none");b=1;a.COLOR1?(Q.value=p(a.COLOR1).toHexString(),a.COLOR2&&(G.value=p(a.COLOR2).toHexString(),
            a.COLOR3?(A.value=p(a.COLOR3).toHexString(),b=3):b=2)):"LINEPLOT"==a.glyph||"DOT"==a.glyph&&a.FGCOLOR?Q.value=p(a.FGCOLOR).toHexString():a.BGCOLOR&&(Q.value=p(a.BGCOLOR).toHexString());q(b);k(a.SCATTER)?B.value="SCATTER":B.value=a.glyph;var n,s;void 0!==a.MIN&&(b=parseFloat(a.MIN),isNaN(b)||(n=b));d.forceMinDynamic||void 0===a.MIN&&void 0===d.forceMin?(v.checked=!1,l.disabled=!0):(v.checked=!0,l.disabled=!1);void 0!==a.MAX&&(b=parseFloat(a.MAX),isNaN(b)||(s=b));d.forceMaxDynamic||void 0===a.MAX&&
            void 0===d.forceMax?(I.checked=!1,g.disabled=!0):(I.checked=!0,g.disabled=!1);void 0!=d.forceMin&&(n=d.forceMin);void 0!=d.forceMax&&(s=d.forceMax);"number"==typeof n&&n!=parseFloat(l.value)&&(l.value=n);"number"==typeof s&&s!=parseFloat(g.value)&&(g.value=s);(a=m(d.stylesheet))?(W.style.display="table-row",R.checked="mismatch"===a.__SEQCOLOR,ha.style.display="table-row",X.checked=k(a.__INSERTIONS)):(W.style.display="none",ha.style.display="none")}f&&d.browser.sourceAdapterIsCapable(d.featureSource,
            "quantLeap")?Y.style.display="table-row":Y.style.display="none"},R=s("input",null,{type:"checkbox"}),W=s("tr",[s("th","Color mismatches"),s("td",R)]);R.addEventListener("change",function(a){a=x(d.stylesheet);m(a).__SEQCOLOR=R.checked?"mismatch":"base";d.mergeConfig({stylesheet:a})});var X=s("input",null,{type:"checkbox"}),ha=s("tr",[s("th","Show insertions"),s("td",X)]);X.addEventListener("change",function(a){a=x(d.stylesheet);m(a).__INSERTIONS=X.checked?"yes":"no";d.mergeConfig({stylesheet:a})});
        var ga=s("tr",[s("th","Style"),s("td",B)]),ia=s("tr",[s("th",["Colour(s)",h,O]),f]),ba=s("tr",[s("th","Min value"),s("td",[v," ",l])]),ja=s("tr",[s("th","Max value"),s("td",[I," ",g])]),Y=s("tr",[s("th","Threshold leap:"),s("td",[C," ",J])]),ma=s("tr",[s("th","Bump overlaps"),s("td",[H," limit: ",M])]),ka=s("tr",[s("th","Label features"),s("td",S)]),h=s("table",[s("tr",[s("th","Name",{},{width:"150px",textAlign:"right"}),r]),s("tr",[s("th","Pin to top"),y]),s("tr",[s("th","Height"),s("td",V)]),ga,
            ia,ba,ja,Y,ma,ka,W,ha]);fa();a.appendChild(h);h=s("button","Reset track",{className:"btn"},{marginLeft:"auto",marginRight:"auto",display:"block"});h.addEventListener("click",function(a){d.setConfig({})},!1);a.appendChild(h);r.addEventListener("input",function(a){d.mergeConfig({name:r.value})},!1);y.addEventListener("change",function(a){d.mergeConfig({pinned:y.checked})},!1);for(h=0;h<D.length;++h)D[h].addEventListener("change",e,!1);B.addEventListener("change",function(a){a=b(function(a){"SCATTER"===
        B.value?(a.SCATTER=!0,a.glyph="DOT",a.SIZE="3"):(a.glyph=B.value,a.SCATTER=void 0);c(a)});d.mergeConfig({stylesheet:a})},!1);v.addEventListener("change",function(a){a={forceMinDynamic:!v.checked};l.disabled=!v.checked;var f=parseFloat(l.value);v.checked&&"number"==typeof f&&!isNaN(f)&&(a.forceMin=parseFloat(f));d.mergeConfig(a)});l.addEventListener("input",function(a){a=parseFloat(l.value);"number"!=typeof a||isNaN(a)||d.mergeConfig({forceMin:a})},!1);I.addEventListener("change",function(a){a={forceMaxDynamic:!I.checked};
            g.disabled=!I.checked;var f=parseFloat(g.value);I.checked&&"number"==typeof f&&!isNaN(f)&&(a.forceMax=parseFloat(f));d.mergeConfig(a)});g.addEventListener("input",function(a){a=parseFloat(g.value);"number"!=typeof a||isNaN(a)||d.mergeConfig({forceMax:a})},!1);V.addEventListener("input",function(a){a=parseFloat(V.value);"number"!=typeof a||isNaN(a)||d.mergeConfig({height:Math.min(500,a|0)})},!1);var na=function(){J.disabled=!C.checked;if(C.checked){var a=parseFloat(J.value);"number"!=typeof a||isNaN(a)||
        d.mergeConfig({quantLeapThreshold:parseFloat(J.value)})}else d.mergeConfig({quantLeapThreshold:null})};C.addEventListener("change",function(a){na()},!1);J.addEventListener("input",function(a){na()},!1);S.addEventListener("change",function(a){a=b(function(a){a.LABEL=S.checked?"yes":"no"});d.mergeConfig({stylesheet:a})},!1);H.addEventListener("change",function(a){a=b(function(a){a.BUMP=H.checked?"yes":"no"});d.mergeConfig({stylesheet:a})},!1);M.addEventListener("input",function(a){a=parseInt(M.value);
            "number"==typeof a&&0<a&&d.mergeConfig({subtierMax:a})},!1);this.showToolPanel(a);this.setUiMode("tier");d.addTierListener(fa);var ca=d.browser.scale;d.browser.addViewListener(function(){d.browser.scale!=ca&&(ca=d.browser.scale,fa())})}}},{"./cbrowser":6,"./color":9,"./das":10,"./utils":45}],41:[function(h,y,r){function m(b,c,a,d){this.config=a||{};this.id="tier"+ ++z;this.browser=b;this.dasSource=s(c);this.background=d;this.viewport=e("canvas",null,{width:""+((this.browser.featurePanelWidth|0)+2E3),
        height:"30",className:"viewport_12_5"},{position:"inline-block",margin:"0px",border:"0px"});this.viewportHolder=e("div",this.viewport,{className:"viewport-holder_12_5"},{background:d,position:"absolute",padding:"0px",margin:"0px",border:"0px",left:"-1000px",minHeight:"200px"});this.overlay=e("canvas",null,{width:+((this.browser.featurePanelWidth|0)+2E3),height:"30",className:"viewport-overlay"});this.notifier=e("div","",{className:"notifier"});this.notifierHolder=e("div",this.notifier,{className:"notifier-holder"});
        this.quantOverlay=e("canvas",null,{width:"50",height:"56",className:"quant-overlay"});this.removeButton=e("i",null,{className:"fa fa-times"});this.bumpButton=e("i",null,{className:"fa fa-plus-circle"});this.loaderButton=b.makeLoader(16);this.loaderButton.style.display="none";this.infoElement=e("div",this.dasSource.desc,{className:"track-label-info"});this.nameButton=e("div",[],{className:"tier-tab"});this.nameButton.appendChild(this.removeButton);c.pennant&&this.nameButton.appendChild(e("img",null,
            {src:c.pennant,width:"16",height:"16"}));this.nameElement=e("span",c.name);this.nameButton.appendChild(e("span",[this.nameElement,this.infoElement],{className:"track-name-holder"}));this.nameButton.appendChild(this.bumpButton);this.nameButton.appendChild(this.loaderButton);this.label=e("span",[this.nameButton],{className:"btn-group track-label"});this.row=e("div",[this.viewportHolder,this.overlay,this.quantOverlay],{className:"tier"});d||(this.row.style.background="none");b.noDefaultLabels||this.row.appendChild(this.label);
        this.row.appendChild(this.notifierHolder);this.layoutHeight=25;this.bumped=!0;this.styleIdSeed=0;c.quantLeapThreshold&&(this.quantLeapThreshold=c.quantLeapThreshold);this.dasSource.collapseSuperGroups&&(this.bumped=!1);this.layoutWasDone=!1;c.featureInfoPlugin&&this.addFeatureInfoPlugin(c.featureInfoPlugin);this.initSources();var k=this;this.featureSource&&this.featureSource.getDefaultFIPs&&!c.noSourceFeatureInfo&&this.featureSource.getDefaultFIPs(function(a){a&&k.addFeatureInfoPlugin(a)});this.featureSource&&
        this.featureSource.addReadinessListener&&this.featureSource.addReadinessListener(function(a){k.notify(a,-1)});this.listeners=[];this.featuresLoadedListeners=[]}if("undefined"!==typeof h){r=h("./utils");var e=r.makeElement,s=r.shallowCopy,k=r.pushnew;r=h("./das");var x=r.DASStylesheet,p=r.DASStyle}var z=0;m.prototype.setBackground=function(b){this.background=b;this.viewportHolder.style.background=b};m.prototype.toString=function(){return this.id};m.prototype.addFeatureInfoPlugin=function(b){this.featureInfoPlugins||
    (this.featureInfoPlugins=[]);this.featureInfoPlugins.push(b)};m.prototype.init=function(){var b=this;b.dasSource.style?(this.setStylesheet({styles:b.dasSource.style}),this.browser.refreshTier(this)):(b.status="Fetching stylesheet",b.fetchStylesheet(function(c,a){if(a||!c){b.error="No stylesheet";c=new x;var d=new p;d.glyph="BOX";d.BGCOLOR="blue";d.FGCOLOR="black";c.pushStyle({type:"default"},null,d);b.setStylesheet(c)}else b.setStylesheet(c),c.geneHint&&(b.dasSource.collapseSuperGroups=!0,b.bumped=
        !1,b.updateLabel());b.browser.refreshTier(b)}))};m.prototype.setStylesheet=function(b){this.baseStylesheet=s(b);for(b=0;b<this.baseStylesheet.styles.length;++b){var c=this.baseStylesheet.styles[b]=s(this.baseStylesheet.styles[b]);c._methodRE=c._labelRE=c._typeRE=null;c.style=s(c.style);c.style.id="style"+ ++this.styleIdSeed}this._updateFromConfig()};m.prototype.getSource=function(){return this.featureSource};m.prototype.getDesiredTypes=function(b){b=[];var c=!1,a=this.browser.zoomForCurrentScale();
        if(this.stylesheet){for(var d=this.stylesheet.styles,e=0;e<d.length;++e){var h=d[e];if(!h.zoom||h.zoom==a)if(h.type&&"default"!=h.type)k(b,h.type);else{c=!0;break}}return c?null:b}};m.prototype.needsSequence=function(b){return this.sequenceSource&&5>b||(this.dasSource.bamURI||this.dasSource.bamBlob)&&20>b?!0:!1};m.prototype.viewFeatures=function(b,c,a,d,e){this.currentFeatures=d;this.currentSequence=e;this.notifyFeaturesLoaded();this.knownChr=b;this.knownCoverage=c;this.status&&(this.status=null,
        this._notifierToStatus());this.draw()};m.prototype.draw=function(){var b=this.currentSequence;this.sequenceSource?c(this,b):d(this);this.paint();this.originHaxx=0;this.browser.arrangeTiers()};m.prototype.findNextFeature=function(b,c,a,d,e){if(this.quantLeapThreshold)c=c+(this.browser.viewEnd-this.browser.viewStart+1)*a/2|0,this.featureSource.quantFindNextFeature(b,c,a,this.quantLeapThreshold,e);else{if(this.knownCoverage&&c>=this.knownCoverage.min()&&c<=this.knownCoverage.max()&&this.currentFeatures){for(var h=
        null,k=0;k<this.currentFeatures.length;++k){var m=this.currentFeatures[k];if(m.min&&m.max&&!(m.parents&&0<m.parents.length))if(0>a)if(1==d&&m.max>=c&&m.min<c){if(!h||m.min>h.min||m.min==h.min&&m.max<h.max)h=m}else m.max<c&&(!h||m.max>h.max||m.max==h.max&&m.min<h.min||m.min==h.mmin&&h.max>=c)&&(h=m);else if(1==d&&m.min<=c&&m.max>c){if(!h||m.max<h.max||m.max==h.max&&m.min>h.min)h=m}else m.min>c&&(!h||m.min<h.min||m.min==h.min&&m.max>h.max||m.max==h.max&&h.min<=c)&&(h=m)}if(h)return e(h);c=0>a?this.browser.knownSpace.min:
        this.browser.knownSpace.max}this.trySourceFNF(b,c,a,e)}};m.prototype.trySourceFNF=function(b,c,a,d){var e=this;this.featureSource.findNextFeature(b,c,a,function(b){b||d(b);var c=e.browser.getSequenceSource();c||d(b);c.getSeqInfo(b.segment,function(c){c?d(b):e.trySourceFNF(b.segment,0<a?1E10:0,a,d)})})};m.prototype.updateLabel=function(){this.bumpButton.className=this.bumped?"fa fa-minus-circle":"fa fa-plus-circle";this.bumpButton.style.display=this.dasSource.collapseSuperGroups?"inline-block":"none"};
        m.prototype.updateHeight=function(){this.currentHeight=Math.max(Math.max(this.layoutHeight,this.label.clientHeight+2),this.browser.minTierHeight);this.row.style.height=""+this.currentHeight+"px";this.browser.updateHeight()};m.prototype.drawOverlay=function(){var b=this.browser,c=b.retina&&1<window.devicePixelRatio,a=this.overlay.getContext("2d");this.overlay.height=this.viewport.height;this.overlay.width=this.viewport.width;c&&a.scale(2,2);for(var c=b.viewStart-1E3/b.scale,d=b.viewStart-1E3/b.scale,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            e=b.viewEnd+1E3/b.scale,h=0;h<b.highlights.length;++h){var k=b.highlights[h];(k.chr===b.chr||k.chr==="chr"+b.chr)&&k.min<e&&k.max>d&&(a.globalAlpha=b.defaultHighlightAlpha,a.fillStyle=b.defaultHighlightFill,a.fillRect((k.min-c)*b.scale,0,(k.max-k.min)*b.scale,this.overlay.height))}this.oorigin=b.viewStart;this.overlay.style.width=this.viewport.style.width;this.overlay.style.height=this.viewport.style.height;this.overlay.style.left="-1000px"};m.prototype.updateStatus=function(b){b?(this.status=b,this.currentFeatures=
            [],this.currentSequence=null,this.draw(),this.updateHeight(),this._notifierToStatus()):this.status&&(this.status=null,this._notifierToStatus())};m.prototype.notify=function(b,c){"number"!==typeof c&&(c=2E3);this.notifierFadeTimeout&&(clearTimeout(this.notifierFadeTimeout),this.notifierFadeTimeout=null);if(b){if(this._notifierOn(b),0<c){var a=this;this.notifierFadeTimeout=setTimeout(function(){a._notifierToStatus()},c)}}else this._notifierToStatus()};m.prototype._notifierOn=function(b){this.notifier.textContent=
            b;this.notifier.style.opacity=0.8};m.prototype._notifierOff=function(){this.notifier.style.opacity=0};m.prototype._notifierToStatus=function(){this.status?this._notifierOn(this.status):this._notifierOff()};m.prototype.setConfig=function(b){this.config=b||{};this._updateFromConfig();this.notifyTierListeners()};m.prototype.mergeConfig=function(b){for(var c in b)this.config[c]=b[c];this._updateFromConfig();this.notifyTierListeners()};m.prototype._updateFromConfig=function(){var b=!1,c=!1;this.nameElement.textContent=
                "string"===typeof this.config.name?this.config.name:this.dasSource.name;var a=this.config.height||this.dasSource.forceHeight;a!=this.forceHeight&&(this.forceHeight=a,b=!0);this.forceMinDynamic!=this.config.forceMinDynamic&&(this.forceMinDynamic=this.config.forceMinDynamic,b=!0);a=void 0!=this.config.forceMin?this.config.forceMin:this.dasSource.forceMin;this.forceMin!=a&&(this.forceMin=a,b=!0);this.forceMaxDynamic!=this.config.forceMaxDynamic&&(this.forceMaxDynamic=this.config.forceMaxDynamic,b=!0);
            a=void 0!=this.config.forceMax?this.config.forceMax:this.dasSource.forceMax;this.forceMax!=a&&(this.forceMax=a,b=!0);a=null;void 0!==this.config.quantLeapThreshold?a=this.config.quantLeapThreshold:void 0!==this.dasSource.quantLeapThreshold&&(a=this.dasSource.quantLeapThreshold);a!=this.quantLeapThreshold&&(this.quantLeapThreshold=a,b=!0);a=this.config.stylesheet||this.baseStylesheet;this.stylesheet!==a&&(this.stylesheet=a,b=!0);a=void 0!==this.config.pinned?this.config.pinned:this.dasSource.pinned;
            a!==this.pinned&&(this.pinned=a,c=!0);a=typeof("number"===this.config.subtierMax)?this.config.subtierMax:this.dasSource.subtierMax||this.browser.defaultSubtierMax;a!=this.subtierMax&&(this.subtierMax=a,b=!0);b&&this.scheduleRedraw();c&&this.browser.reorderTiers()};m.prototype.scheduleRedraw=function(){if(this.currentFeatures){var b=this;this.redrawTimeout||(this.redrawTimeout=setTimeout(function(){b.draw();b.redrawTimeout=null},10))}};m.prototype.addTierListener=function(b){this.listeners.push(b)};
        m.prototype.notifyTierListeners=function(b){for(var c=0;c<this.listeners.length;++c)try{this.listeners[c](b)}catch(a){console.log(a)}this.browser.notifyTier()};m.prototype.addFeaturesLoadedListener=function(b){this.featuresLoadedListeners.push(b)};m.prototype.notifyFeaturesLoaded=function(){for(var b=0;b<this.featuresLoadedListeners.length;++b)try{this.featuresLoadedListeners[b].call(this)}catch(c){console.log(c)}};if("undefined"!==typeof y){y.exports={DasTier:m};var d=h("./feature-draw").drawFeatureTier,
            c=h("./sequence-draw").drawSeqTier}},{"./das":10,"./feature-draw":16,"./sequence-draw":29,"./utils":45}],42:[function(h,y,r){function m(a,b){for(var c=0;c<a.length;++c){var d=a[c];d===b?d.classList.add("active"):d.classList.remove("active")}}if("undefined"!==typeof h){y=h("./cbrowser");var e=y.Browser,s=y.sourcesAreEqual;y=h("./utils");var k=y.makeElement,x=y.removeChildren,p=y.Observed;y=h("./thub");var z=y.THUB_COMPARE,d=y.connectTrackHub,c=h("./domui").makeTreeTableSection,b=h("./probe").probeResource;
        y=h("./bin");var n=y.URLFetchable,a=y.BlobFetchable,u=y.readInt,t=h("./lh3utils").unbgzf,w=h("./bam").BAI_MAGIC,F=h("./tabix").TABIX_MAGIC;h=h("./das");var B=h.DASSource,Q=h.DASSegment,G=h.DASRegistry}e.prototype.currentlyActive=function(a){for(var b=0;b<this.tiers.length;++b)if(s(this.tiers[b].dasSource,a))return this.tiers[b];return!1};e.prototype.makeButton=function(a,b){var c=k("a",a,{href:"#"});b&&this.makeTooltip(c,b);return k("li",c)};e.prototype.showTrackAdder=function(e){function h(a){aa.style.display=
        "none";L.style.display="none";ea.style.display="none";T=!1;x(K);for(var f=k("div",null,{},{width:"100%"}),b=[],g=0;g<a.length;++g)b.push(a[g]);b.sort(function(a,f){return a.shortLabel.toLowerCase().trim().localeCompare(f.shortLabel.toLowerCase().trim())});a=[];for(var d=[],g=0;g<b.length;++g){var e=b[g];e.children&&0<e.children.length&&"multiWig"!=e.container?a.push(e):d.push(e)}0<d.length&&a.push({shortLabel:"Others",priority:-1E8,children:d});a.sort(z);for(var l=[],b=0;b<a.length;++b){e=d=a[b];
        !e.dimensions&&e._parent&&e._parent.dimensions&&(e=e._parent);g={};if(e.dimensions)for(var q=e.dimensions.split(/(\w+)=(\w+)/),n=0;n<q.length-2;n+=3)g[q[n+1]]=q[n+2];if(g.dimX&&g.dimY){for(var m=g.dimX,p=g.dimY,g=e.subgroups[m],q=e.subgroups[p],n={},t=0;t<d.children.length;++t){var v=d.children[t],e=v.sgm[m],s=v.sgm[p];n[e]||(n[e]={});n[e][s]=v}p=k("table",null,{className:"table table-striped table-condensed"},{tableLayout:"fixed"});e=k("tr");e.appendChild(k("th",null,{},{width:"150px",height:"100px"}));
            for(s=0;s<g.titles.length;++s)m=k("th",k("div",g.titles[s],{},{transform:"rotate(-60deg)",transformOrigin:"0% 100%",webkitTransform:"rotate(-60deg) translate(20px,10px)",webkitTransformOrigin:"0% 100%",textAlign:"left"}),{},{width:"35px",height:"100px",verticalAlign:"bottom"}),e.appendChild(m);p.appendChild(e);for(var r=k("tbody",null,{className:"table table-striped table-condensed"}),u=0;u<q.titles.length;++u){var s=q.tags[u],w=k("tr");w.appendChild(k("th",q.titles[u]),{});for(var y=0;y<g.titles.length;++y){var e=
                g.tags[y],J=k("td");if(n[e]&&n[e][s]){e=n[e][s];t=e.toDallianceSource();if(!t)continue;m=k("tr");v=k("td");v.style.textAlign="center";var A=k("input");A.type="checkbox";A.dalliance_source=t;oa&&(A.dalliance_mapping=oa);l.push(A);J.appendChild(A);A.addEventListener("change",function(a){a.target.checked?C.addTier(a.target.dalliance_source):C.removeTier(a.target.dalliance_source)})}w.appendChild(J)}r.appendChild(w)}p.appendChild(r);f.appendChild(c(d.shortLabel,p,0==b))}else{q=k("tbody",null,{className:"table table-striped table-condensed"});
            n=k("table",q,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"});s=0;d.children.sort(z);for(g=0;g<d.children.length;++g)if(e=d.children[g],t=e.toDallianceSource())m=k("tr"),v=k("td",null,{},{width:"30px"}),v.style.textAlign="center",A=k("input"),A.type="checkbox",A.dalliance_source=t,oa&&(A.dalliance_mapping=oa),l.push(A),v.appendChild(A),A.addEventListener("change",function(a){a.target.checked?C.addTier(a.target.dalliance_source):C.removeTier(a.target.dalliance_source)}),
                m.appendChild(v),p=k("td"),p.appendChild(document.createTextNode(e.shortLabel)),e.longLabel&&0<e.longLabel.length&&C.makeTooltip(p,e.longLabel),m.appendChild(p),q.appendChild(m),++s;1<a.length||"Others"!==d.shortLabel?f.appendChild(c(d.shortLabel,n,0==b)):f.appendChild(n)}}var I=function(){for(var a=0;a<l.length;++a){var f=l[a],b=C.currentlyActive(f.dalliance_source);b?(f.checked=!0,f.disabled=null!=b.sequenceSource):f.checked=!1}};I();C.addTierListener(function(a){I()});K.appendChild(f)}function s(){m(J,
        ia);T="bin";aa.style.display="none";L.style.display="inline";ea.style.display="none";x(K);var a=k("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(k("h3","Add custom URL-based data"));a.appendChild(k("p",["You can add indexed binary data hosted on an web server that supports CORS (",k("a","full details",{href:"http://www.biodalliance.org/bin.html"}),").  Currently supported formats are bigwig, bigbed, and indexed BAM."]));a.appendChild(k("br"));a.appendChild(document.createTextNode("URL: "));
        Y=k("input","",{size:80,value:"http://www.biodalliance.org/datasets/ensGene.bb"},{width:"100%"});a.appendChild(Y);a.appendChild(k("br"));a.appendChild(k("b","- or -"));a.appendChild(k("br"));a.appendChild(document.createTextNode("File: "));ca=k("input",null,{type:"file",multiple:"multiple"});a.appendChild(ca);a.appendChild(k("p",'Clicking the "Add" button below will initiate a series of test queries.'));K.appendChild(a);Y.focus()}function r(){m(J,ba);aa.style.display="none";L.style.display="inline";
        ea.style.display="none";T="hub-connect";aa.style.visibility="hidden";x(K);var a=k("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(k("h3","Connect to a track hub."));a.appendChild(k("p",['Enter the top-level URL (usually points to a file called "hub.txt") of a UCSC-style track hub']));Y=k("input","",{size:120,value:"http://www.biodalliance.org/datasets/testhub/hub.txt"},{width:"100%"});a.appendChild(Y);K.appendChild(a);Y.focus()}function y(){m(J,ga);aa.style.display="none";L.style.display=
        "inline";ea.style.display="none";T="das";x(K);var a=k("div",null,{},{paddingLeft:"10px",paddingRight:"10px"});a.appendChild(k("h3","Add custom DAS data"));a.appendChild(k("p","This interface is intended for adding custom or lab-specific data.  Public data can be added more easily via the registry interface."));a.appendChild(document.createTextNode("URL: "));a.appendChild(k("br"));Y=k("input","",{size:80,value:"http://www.derkholm.net:8080/das/medipseq_reads/"},{width:"100%"});a.appendChild(Y);a.appendChild(k("p",
        'Clicking the "Add" button below will initiate a series of test queries.  If the source is password-protected, you may be prompted to enter credentials.'));K.appendChild(a);Y.focus()}function f(){if(T)if("das"===T){var a=Y.value.trim();/^.+:\/\//.exec(a)||(a="http://"+a);var f=new B({name:"temporary",uri:a});ta(f)}else if("bin"===T)if((a=ca.files)&&0<a.length){f=U=[];T="multiple";for(var b=0;b<a.length;++b){var c=a[b];c&&f.push({blob:c})}for(b=0;b<f.length;++b)da(f[b]);pa()}else a=Y.value.trim(),
        /^.+:\/\//.exec(a)||(a="http://"+a),ua({uri:a});else if("reset"===T)y();else if("reset-bin"===T)s();else if("reset-hub"===T)r();else if("prompt-bai"===T)(a=ca.files)&&0<a.length&&a[0]?($.baiBlob=a[0],g($)):(a=$,aa.style.display="none",L.style.display="inline",ea.style.display="inline",x(K),T="prompt-bai",K.appendChild(k("h2","Select an index file")),K.appendChild(k("p","Dalliance requires a BAM index (.bai) file when displaying BAM data.  These normally accompany BAM files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
        K.appendChild(document.createTextNode("Index file: ")),ca=k("input",null,{type:"file"}),K.appendChild(ca),$=a);else if("prompt-tbi"===T)(a=ca.files)&&0<a.length&&a[0]?($.indexBlob=a[0],v($)):(a=$,aa.style.display="none",L.style.display="inline",ea.style.display="inline",x(K),T="prompt-tbi",K.appendChild(k("h2","Select an index file")),K.appendChild(k("p","Dalliance requires a Tabix index (.tbi) file when displaying VCF data.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate BAI file")),
        K.appendChild(document.createTextNode("Index file: ")),ca=k("input",null,{type:"file"}),K.appendChild(ca),$=a);else if("finalize"===T||"finalize-bin"===T)$.name=ma.value,a=ka.value,$.mapping="__default__"!=a?a:void 0,na&&($.maxbins=na.checked),1<ra.value.length&&1<sa.value.length&&($.xUser=ra.value,$.xPass=sa.value),C.addTier($),"finalize-bin"==T?s():y();else if("hub-connect"===T)a=Y.value.trim(),/^.+:\/\//.exec(a)||(a="http://"+a),q(a);else{if("multiple"===T){for(a=0;a<U.length;++a)if(f=U[a],!f.hidden&&
        ("bam"!=f.tier_type||f.indexBlob||f.indexUri)&&("tabix"!=f.tier_type||f.indexBlob||f.indexUri)&&(f=N(f)))f.noPersist=!0,C.addTier(f);s()}}else C.removeAllPopups()}function q(a,f,b){f=f||{};for(var c=0;c<C.hubObjects.length;++c){var g=C.hubObjects[c];if(g.hub.url==a){for(c=0;c<J.length;++c)J[c].hub==g&&m(J,J[c]);g.getTracks(function(a,f){f&&console.log(f);h(a)});return}}d(a,function(c,g){if(g){if(!b)return q(a,{credentials:!0},!0);x(K);K.appendChild(k("h2","Error connecting to track hub"));K.appendChild(k("p",
        g));T="reset-hub"}else{var d=null,e=null,l;for(l in c.genomes){var n=null,p=!1;if(l==C.coordSystem.ucscName)p=!0;else for(var t in C.chains)l==C.chains[t].coords.ucscName&&(n=t,p=!0);p&&(p={url:a,genome:l},f.credentials&&(p.credentials=!0),n&&(p.mapping=n,c.genomes[l].mapping=n),C.hubs.push(p),C.hubObjects.push(c.genomes[l]),p=W(c.genomes[l]),ja.appendChild(p),n&&d||(d=c.genomes[l],e=p))}d?(C.notifyTier(),m(J,e),d.getTracks(function(a,f){h(a)})):(x(K),K.appendChild(k("h2","No data for this genome")),
        K.appendChild(k("p","This URL appears to be a valid track-hub, but it doesn't contain any data for the coordinate system of this browser")),K.appendChild(k("p","coordSystem.ucscName = "+C.coordSystem.ucscName)),T="reset-hub")}},f)}function l(a,f){var b=a.uri;if(f){var c=/(.+)\/[^\/]+\/?/.exec(b);c&&(b=c[1]+"/sources")}(new G(b,{credentials:a.credentials})).sources(function(b){if(!b||0==b.length)return f?la(a):l(a,!0);var c=null;if(1==b.length)c=b[0];else for(var g=0;g<b.length;++g)if(b[g].uri===a.uri){c=
        b[g];break}g=b=!1;if(c&&(a.name=c.name,a.desc=c.desc,a.maxbins=c.maxbins?!0:!1,c.capabilities&&(a.capabilities=c.capabilities),g=!0,c.coords&&1==c.coords.length))if(c=c.coords[0],coordsMatch(c,C.coordSystem))b=!0;else if(C.chains)for(var d in C.chains)coordsMatch(c,C.chains[d].coords)&&(a.mapping=d,b=!0);return la(a,b,g)},function(){return f?la(a):l(a,!0)})}function g(f){(f.baiBlob?new a(f.baiBlob):new n(f.bamURI+".bai")).slice(0,256).fetch(function(a){var b=!1;a&&(a=new Uint8Array(a),b=u(a,0)==w);
        return b?la(f,!1,!1,!0):I("You have selected a valid BAM file, but a corresponding index (.bai) file was not found.  Please index your BAM (samtools index) and place the BAI file in the same directory")})}function v(f){(f.indexBlob?new a(f.indexBlob):new n(f.uri+".tbi")).slice(0,65536).fetch(function(a){var b=!1;if(a){var c=new Uint8Array(a);if(31==c[0]||139==c[1])a=t(a),c=new Uint8Array(a),b=u(c,0)==F}return b?la(f,!1,!1,!0):I('You have selected a valid VCF file, but a corresponding index (.tbi) file was not found.  Please index your VCF ("tabix -p vcf -f myfile.vcf.gz") and place the .tbi file in the same directory')})}
        function I(a){aa.style.display="none";L.style.display="inline";ea.style.display="inline";x(K);a=a||"Custom data format not recognized";K.appendChild(k("h2","Error adding custom data"));K.appendChild(k("p",a));K.appendChild(k("p","Currently supported formats are bigBed, bigWig, and BAM."));T="reset-bin"}if("add"===this.uiMode)this.hideToolPanel(),this.setUiMode("none");else{var C=this;e=k("div",null,{className:"dalliance"},{width:"100%",display:"inline-block",boxSizing:"border-box",MozBoxSizing:"border-box",
            verticalAlign:"top",paddingRight:"15px"});var J=[],V,H;if(!this.noRegistryTabs){var M=this.makeButton("Registry","Browse compatible datasources from the DAS registry");J.push(M);for(var S in this.mappableSources)(function(a){var f=C.makeButton(C.chains[a].srcTag,"Browse datasources mapped from "+C.chains[a].srcTag);J.push(f);f.addEventListener("click",function(b){b.preventDefault();b.stopPropagation();m(J,f);V(C.mappableSources[a],a)},!1)})(S)}S={};for(var Z=0;Z<this.defaultSources.length;++Z){var fa=
            this.defaultSources[Z],R=fa.group||"Defaults";S[R]?S[R].push(fa):S[R]=[fa]}var W=function(a){var f=a.hub,b=k("i",null,{className:"fa fa-list-alt"},{cursor:"context-menu"}),c=f.shortLabel||"Unknown";a.mapping&&(c=c+" ("+a.genome+")");var c=k("span",[c," ",b]),g=C.makeButton(c,f.longLabel);g.hub=a;J.push(g);g.addEventListener("click",function(f){f.preventDefault();f.stopPropagation();m(J,g);x(K);f=C.makeLoader(24);f.style.marginLeft="auto";f.style.marginRight="auto";f.style.marginTop="100px";K.appendChild(k("div",
            f,null,{textAlign:"center"}));aa.style.display="none";L.style.display="none";ea.style.display="none";a.getTracks(function(a,f){f&&console.log(f);h(a)})},!1);b.addEventListener("click",function(f){f.preventDefault();f.stopPropagation();var b=k("li",k("a","Remove hub")),c=k("li",k("a","Enable all")),d=k("li",k("a","Disable all")),e=k("ul",[b,c,d],{className:"dropdown-menu"},{display:"block"}),l=f.clientX;f=f.clientY;l+=document.documentElement.scrollLeft||document.body.scrollLeft;f+=document.documentElement.scrollTop||
            document.body.scrollTop;e.style.position="absolute";e.style.top=""+(f+10)+"px";e.style.left=""+(l-30)+"px";C.hPopupHolder.appendChild(e);var h=function(a){console.log("cc");document.body.removeEventListener("click",h,!0);C.hPopupHolder.removeChild(e)};document.body.addEventListener("click",h,!0);b.addEventListener("click",function(f){for(f=0;f<C.hubObjects.length;++f)if(C.hubObjects[f].absURL==a.absURL){C.hubObjects.splice(f,1);break}for(f=0;f<C.hubs.length;++f){var b=C.hubs[f];"string"===typeof b&&
        (b={url:b});if(b.url==a.hub.url&&!b.genome||b.genome==a.genome){C.hubs.splice(f,1);break}}C.notifyTier();ja.removeChild(g);m(J,ba);r()},!1);c.addEventListener("click",function(f){a.getTracks(function(a,f){f&&console.log(f);for(var b=0;b<a.length;++b){var c=a[b].toDallianceSource();C.currentlyActive(c)||C.addTier(c)}})},!1);d.addEventListener("click",function(f){a.getTracks(function(a,f){f&&console.log(f);for(var b=0;b<a.length;++b){var c=a[b].toDallianceSource();C.currentlyActive(c)&&C.removeTier(c)}})},
            !1)},!1);return g},X=null,ha=null;for(R in S)(function(a,f){var b=C.makeButton(a,"Browse the default set of data for this browser");b.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();m(J,b);V(new p(f))},!1);J.push(b);X||(X=b,ha=f)})(R,S[R]);var ga=this.makeButton("DAS","Add arbitrary DAS data");J.push(ga);var ia=this.makeButton("Binary","Add data in bigwig or bigbed format");J.push(ia);for(R=0;R<this.hubObjects.length;++R)W(this.hubObjects[R]);var ba=this.makeButton("+",
            "Connect to a new track-hub");J.push(ba);var ja=k("ul",J,{className:"nav nav-tabs"},{marginBottom:"0px"});e.appendChild(ja);var Y,ma,ka,na,ca,ra,sa,T=!1,$=null,R=k("form",null,{},{display:"inline-block",width:"100%"});R.addEventListener("submit",function(a){a.stopPropagation();a.preventDefault();f();return!1},!0);var K=k("div");K.style.position="relative";K.style.overflow="scroll";R.appendChild(K);var oa,qa;V=function(a,f){aa.style.display="none";L.style.display="none";ea.style.display="none";qa&&
        qa.removeListener(H);oa=f;qa=a;qa.addListenerAndFire(H)};H=function(a){T=!1;var f=[];x(K);if(a){for(var b=k("tbody",null,{className:"table table-striped table-condensed"},{width:"100%"}),c=k("table",b,{className:"table table-striped table-condensed"},{width:"100%",tableLayout:"fixed"}),g=0,d=[],e=0;e<a.length;++e)d.push(a[e]);d.sort(function(a,f){return a.name.toLowerCase().trim().localeCompare(f.name.toLowerCase().trim())});for(e=0;e<d.length;++e){a=d[e];var l=k("tr"),h=k("td",null,{},{width:"30px"});
            h.style.textAlign="center";if(!a.props||a.props.cors){var q=k("input");q.type="checkbox";q.dalliance_source=a;oa&&(q.dalliance_mapping=oa);h.appendChild(q);f.push(q);q.addEventListener("change",function(a){a.target.checked?C.addTier(a.target.dalliance_source):C.removeTier(a.target.dalliance_source)})}else h.appendChild(document.createTextNode("!")),C.makeTooltip(h,k("span",["This data source isn't accessible because it doesn't support ",k("a","CORS",{href:"http://www.w3.org/TR/cors/"}),"."]));l.appendChild(h);
            h=k("td");h.appendChild(document.createTextNode(a.name));a.desc&&0<a.desc.length&&C.makeTooltip(h,a.desc);l.appendChild(h);b.appendChild(l);++g}var n=function(){for(var a=0;a<f.length;++a){var b=f[a];C.currentlyActive(b.dalliance_source)?b.checked=!0:b.checked=!1}};n();C.addTierListener(function(a){n()});K.appendChild(c)}else K.appendChild(k("p","Dalliance was unable to retrieve data source information from the DAS registry, please try again later"))};M&&M.addEventListener("click",function(a){a.preventDefault();
            a.stopPropagation();m(J,M);V(C.availableSources)},!1);ia.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();s()},!1);ba.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();r()},!1);ga.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();y()},!1);var L=k("button","Add",{className:"btn btn-primary"});L.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();f()},!1);var ta=function(a,f){var b=C.knownSpace;if(b){var c=
            Math.max(b.min,(b.min+b.max-100)/2)|0,b=new Q(b.chr,c,Math.min(c+99,b.max));a.features(b,{},function(b,c){if(c)f?(x(K),K.appendChild(k("h2","Custom data not found")),K.appendChild(k("p","DAS uri: "+a.uri+" is not answering features requests")),T="reset"):(a.credentials=!0,ta(a,!0));else{var g=/\/([^/]+)\/?$/.exec(a.uri);g&&(a.name=g[1]);l(a)}})}else alert("Can't confirm track-addition to an uninit browser.")},N=function(a){var f={name:a.name};a.credentials&&(f.credentials=a.credentials);a.mapping&&
            "__default__"!=a.mapping&&(f.mapping=a.mapping);if("bwg"==a.tier_type)return a.blob?f.bwgBlob=a.blob:a.uri&&(f.bwgURI=a.uri),f;if("bam"==a.tier_type)return a.blob?(f.bamBlob=a.blob,f.baiBlob=a.indexBlob):(f.bamURI=a.uri,f.baiURI=a.indexUri),f;if("tabix"==a.tier_type)return f.tier_type="tabix",f.payload=a.payload,a.blob?(f.blob=a.blob,f.indexBlob=a.indexBlob):(f.uri=a.uri,f.indexUri=a.indexUri),f;if("memstore"==a.tier_type)return f.tier_type="memstore",f.payload=a.payload,a.blob?f.blob=a.blob:f.uri=
            a.uri,f},ua=function(a){b(a,function(a,f){if(f)x(K),K.appendChild(k("h2","Couldn't access custom data")),K.appendChild(k("p",""+f)),T="reset-bin";else{var b=N(a);return"bam"==a.tier_type?g(b):"tabix"==a.tier_type?v(b):la(b,!1,!1,!0)}})},la=function(a,f,b,c){aa.style.display="none";L.style.display="inline";ea.style.display="inline";x(K);K.appendChild(k("h2","Add custom data: step 2"));K.appendChild(document.createTextNode("Label: "));ma=k("input","",{value:a.name});K.appendChild(ma);ra=k("input","");
            sa=k("input","");K.appendChild(k("br"));K.appendChild(k("br"));K.appendChild(k("h4","Coordinate system: "));ka=k("select",null);ka.appendChild(k("option",C.nameForCoordSystem(C.coordSystem),{value:"__default__"}));if(C.chains)for(var g in C.chains)ka.appendChild(k("option",C.nameForCoordSystem(C.chains[g].coords),{value:g}));ka.value=a.mapping||"__default__";K.appendChild(ka);f?K.appendChild(k("p","(Based on server response, probably doesn't need changing.)")):(K.appendChild(k("p",[k("b","Warning: "),
                "unable to determine the correct value from server responses.  Please check carefully."])),K.appendChild(k("p","If you don't see the mapping you're looking for, please contact thomas@biodalliance.org")));c||(K.appendChild(document.createTextNode("Quantitative: ")),na=k("input",null,{type:"checkbox",checked:!0}),"undefined"!==typeof a.maxbins&&(na.checked=a.maxbins),K.appendChild(na),b?K.appendChild(k("p","(Based on server response, probably doesn't need changing.)")):K.appendChild(k("p",[k("b","Warning: "),
                "unable to determine correct value.  If in doubt, leave checked."])));a.bwgBlob&&K.appendChild(k("p",[k("b","Warning: "),"data added from local file.  Due to the browser security model, the track will disappear if you reload Dalliance."]));ma.focus();T="bin"===T||"prompt-bai"===T||"prompt-tbi"===T?"finalize-bin":"finalize";$=a},U=null,da=function(a){b(a,function(a,f){f&&(a.error=f);for(var b=[],c={},g={},d=0;d<U.length;++d){var e=U[d];"bam"!=e.tier_type||e.indexBlob||(c[e.blob.name]=e);"tabix"!=e.tier_type||
        e.indexBlob||(g[e.blob.name]=e)}for(d=0;d<U.length;++d)if(e=U[d],"bai"===e.tier_type){var l=/(.+)\.bai$/.exec(e.blob.name);l&&c[l[1]]&&(c[l[1]].indexBlob=e.blob,b.push(d))}else"tabix-index"===e.tier_type&&(l=/(.+)\.tbi$/.exec(e.blob.name))&&g[l[1]]&&(g[l[1]].indexBlob=e.blob,b.push(d));for(c=b.length-1;0<=c;--c)U.splice(b[c],1);pa()})},pa=function(){x(K);var a=!1,f=k("table",U.filter(function(a){return!a.hidden}).map(function(f){k("tr").appendChild(k("td",f.name||f.blob.name));var b;b=f.error?k("span",
            "Error",null,{color:"red"}):f.tier_type?f.payload||f.tier_type:C.makeLoader(16);var c,g="unknown";"bwg"==f.tier_type||"memstore"==f.tier_type?g="okay":"bam"==f.tier_type?g=f.indexBlob?"okay":"needs-index":"tabix"==f.tier_type&&(g=f.indexBlob?"okay":"needs-index");if("okay"==g){c=k("select",null,null,{width:"150px"});c.appendChild(k("option",C.nameForCoordSystem(C.coordSystem),{value:"__default__"}));if(C.chains)for(var d in C.chains)c.appendChild(k("option",C.nameForCoordSystem(C.chains[d].coords),
            {value:d}));c.value=f.mapping||"__default__";c.addEventListener("change",function(a){f.mapping=c.value;console.log(f)},!1)}else"needs-index"==g&&(c=k("span","Needs index",{},{color:"red"}),a=!0);return k("tr",[k("td",f.name||f.blob.name),k("td",b),k("td",c)])}),{className:"table table-striped table-condensed"});K.appendChild(f);if(a){K.appendChild(k("p","Some of these files are missing required index (.bai or .tbi) files.  For security reasons, web applications like Dalliance can only access local files which you have explicity selected.  Please use the file chooser below to select the appropriate index file"));
            K.appendChild(document.createTextNode("Index file(s): "));var b=k("input",null,{type:"file",multiple:"multiple"});K.appendChild(b);b.addEventListener("change",function(a){console.log("fileset changed");a=b.files||[];for(var f=0;f<a.length;++f){var c=a[f];c&&(c={blob:c,hidden:!0},U.push(c),da(c))}},!1)}},ea=k("button","Cancel",{className:"btn"});ea.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();"finalize-bin"===T?s():y()},!1);var aa=k("button","Refresh",{className:"btn"});
            aa.addEventListener("click",function(a){a.stopPropagation();a.preventDefault();C.queryRegistry(oa)},!1);this.makeTooltip(aa,"Click to re-fetch data from the DAS registry");S=k("div",[L," ",ea," ",aa]);S.style.margin="10px";R.appendChild(S);e.appendChild(R);V(C.availableSources);this.showToolPanel(e);this.setUiMode("add");X&&(m(J,X),V(new p(ha)))}}},{"./bam":1,"./bin":4,"./cbrowser":6,"./das":10,"./domui":11,"./lh3utils":22,"./probe":26,"./tabix":37,"./thub":38,"./utils":45}],43:[function(h,y,r){function m(h,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           k,m){k.fetchAsText(function(k){if(!k)return m(null,"Couldn't fetch index-index");k=k.split(/(.+)([0-9A-F]{10})\n/);for(var r=[],d=[],c=1;c<k.length;c+=3)r.push(k[c]),d.push(parseInt(k[c+1],16));return m(new e(r,d,h))})}function e(e,h,m){this.keys=e;this.offsets=h;this.ix=m}e.prototype.lookup=function(e,h){for(var m,p=(e+"     ").substring(0,5).toLowerCase(),r=0;r<this.keys.length;++r)if(0>p.localeCompare(this.keys[r])){m=this.ix.slice(this.offsets[r-1],this.offsets[r]-this.offsets[r-1]);break}m||
    (m=this.ix.slice(this.offsets[this.offsets.length-1]));m.fetchAsText(function(d){d=d.split("\n");for(var c=0;c<d.length;++c)if(0==d[c].indexOf(e.toLowerCase()+" "))return h(d[c].split(" "));return h(null)})};"undefined"!==typeof y&&(y.exports={connectTrix:m})},{}],44:[function(h,y,r){function m(){}function e(a,d){var e=new m;e.data=a;e.data.slice(0,12500).fetch(function(a){if(!a)return d(null,"Couldn't access data");var h=new Uint8Array(a);a=k(h,0);if(a==c)e.readInt=k;else if(a==b)e.readInt=x;else return d(null,
            "Not a .2bit file, magic=0x"+a.toString(16));a=e.readInt(h,4);if(0!=a)return d(null,"Unsupported version "+a);e.seqCount=e.readInt(h,8);e.seqDict={};var n=16,m=0,p=0,r=function(){for(;m<e.seqCount;){var a=h[n];if(n+a+6>=h.length)return e.data.slice(p+n,12500).fetch(function(a){p+=n;n=0;h=new Uint8Array(a);r()});++n;for(var b="",c=1;c<=a;++c)b+=String.fromCharCode(h[n++]);a=e.readInt(h,n);n+=4;e.seqDict[b]=new s(e,a);++m}return d(e)};r()})}function s(a,b){this.tbf=a;this.offset=b}if("undefined"!==
        typeof h){r=h("./bin");var k=r.readInt,x=r.readIntBE;h=h("./spans");var p=h.Range,z=h.union,d=h.intersection}var c=440477507,b=1126646042;m.prototype.getSeq=function(a){var b=this.seqDict[a];b||(b=this.seqDict["chr"+a]);return b};m.prototype.fetch=function(a,b,c,d){var e=this.getSeq(a);if(e){if(c<=b)return d("");e.fetch(b,c,d)}else return d(null,"Couldn't find "+a)};s.prototype.init=function(a){if(this.seqOffset)return a();var b=this;b.tbf.data.slice(b.offset,8).fetch(function(c){if(!c)return a("Fetch failed");
        c=new Uint8Array(c);b._length=b.tbf.readInt(c,0);b.nBlockCnt=b.tbf.readInt(c,4);b.tbf.data.slice(b.offset+8,8*b.nBlockCnt+4).fetch(function(c){if(!c)return a("Fetch failed");c=new Uint8Array(c);for(var d=null,e=0;e<b.nBlockCnt;++e)var h=b.tbf.readInt(c,4*e),k=b.tbf.readInt(c,4*(e+b.nBlockCnt)),h=new p(h,h+k-1),d=d?z(d,h):h;b.nBlocks=d;b.mBlockCnt=b.tbf.readInt(c,8*b.nBlockCnt);b.seqLength=(b._length+3)/4|0;b.seqOffset=b.offset+16+8*(b.nBlockCnt+b.mBlockCnt);return a()})})};var n=["T","C","A","G"];
        s.prototype.fetch=function(a,b,c){--a;--b;var e=this;this.init(function(h){if(h)return c(null,h);var k=a>>2;h=b+3>>2;if(0>k||h>e.seqLength)return c("Coordinates out of bounds: "+a+":"+b);e.tbf.data.slice(e.seqOffset+k,h-k).salted().fetch(function(h){function m(a){for(;x<=a;){var b=x&3,c=s[(x>>2)-k];y+=n[0==b?c>>6&3:1==b?c>>4&3:2==b?c>>2&3:c&3];++x}}if(null==h)return c("SeqFetch failed");var s=new Uint8Array(h);h=[];if(e.nBlocks){var r=d(new p(a,b),e.nBlocks);r&&(h=r.ranges())}for(var y="",x=a,r=0;r<
            h.length;++r){var z=h[r];if(x>z.min())throw"N mismatch...";for(x<z.min()&&m(z.min()-1);x<=z.max();)y+="N",++x}x<=b&&m(b);return c(y)})})};s.prototype.length=function(a){var b=this;this.init(function(c){return c?a(null,c):a(b._length)})};"undefined"!==typeof y&&(y.exports={makeTwoBit:e})},{"./bin":4,"./spans":33}],45:[function(h,y,r){function m(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function e(a,b,c){a[b]?a[b].push(c):a[b]=[c]}function s(a,b,c){var d=a[b];if(d){for(a=0;a<d.length;++a)if(d[a]==
        c)return;d.push(c)}else a[b]=[c]}function k(a,b,c,d){if(a)return a;if(b)return b;if(c)return c;if(d)return d}function m(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return;a.push(b)}function x(a,b){if(!a)return-1;for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}function p(a,b,c,d){a=document.createElement(a);if(b){b instanceof Array||(b=[b]);for(var e=0;e<b.length;++e){var h=b[e];"string"==typeof h&&(h=document.createTextNode(h));a.appendChild(h)}}if(c)for(var f in c)try{a[f]=c[f]}catch(k){throw console.log("error setting "+
        f),k;}if(d)for(f in d)a.style[f]=d[f];return a}function z(a,b,c,d){a=document.createElementNS(a,b);if(c)for(c instanceof Array||(c=[c]),b=0;b<c.length;++b){var e=c[b];"string"==typeof e&&(e=document.createTextNode(e));a.appendChild(e)}if(d)for(var h in d){c=a;b=h;var e=d[h],f=B[b];if(!f){for(var f="",k=0;k<b.length;++k)var l=b.substring(k,k+1),g=l.toLowerCase(),f=g!=l?f+"-"+g:f+l;B[b]=f}c.setAttribute(f,e)}return a}function d(a){if(a&&a.childNodes)for(;0<a.childNodes.length;)a.removeChild(a.firstChild)}
        function c(a,b){if("undefined"===typeof a)return"undefined";if(null==a)return"null";if("string"==typeof a)return"'"+a+"'";if("number"==typeof a||"boolean"==typeof a)return""+a;if("object"==typeof a){if(a instanceof Array){for(var d=null,e=0;e<a.length;++e)d=(null==d?"":d+", ")+c(a[e],b);return"["+(d?d:"")+"]"}b=b||{};d=null;for(e in a)b[e]||void 0!=e&&"function"!=typeof a[e]&&(d=(null==d?"":d+", ")+e+": "+c(a[e],b));return"{"+(d?d:"")+"}"}return typeof a}function b(a){var b={},c;for(c in a)b[c]=a[c];
            return b}function n(a){this.value=a;this.listeners=[]}function a(){this.queue=[]}function u(a,b,c){c.salt&&(a=a+"?salt="+F(""+Date.now()+","+ ++Q));var d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(300<=d.status?b(null,"Error code "+d.status):b(d.responseText))};d.open("GET",a,!0);d.responseType="text";c&&c.credentials&&(d.withCredentials=!0);d.send("")}function t(a,b){if(0==b.indexOf("http:")||0==b.indexOf("https:"))return b;var c=a.lastIndexOf("/");return 0<=c?a.substr(0,
                c+1)+b:b}function w(a){return p("a",null,{href:a}).href}if("undefined"!==typeof h)var F=h("./sha1").b64_sha1;var B={};n.prototype.addListener=function(a){this.listeners.push(a)};n.prototype.addListenerAndFire=function(a){this.listeners.push(a);a(this.value)};n.prototype.removeListener=function(a){var b=this.listeners;a=x(b,a);0<=a&&b.splice(a,1)};n.prototype.get=function(){return this.value};n.prototype.set=function(a){this.value=a;for(var b=0;b<this.listeners.length;++b)this.listeners[b](a)};a.prototype.provide=
            function(a){if(void 0!==this.res)throw"Resource has already been provided.";this.res=a;for(var b=0;b<this.queue.length;++b)this.queue[b](a);this.queue=null};a.prototype.await=function(a){if(void 0!==this.res)return a(this.res),this.res;this.queue.push(a)};var Q=0;"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")});"undefined"!==typeof y&&(y.exports={textXHR:u,relativeURL:t,resolveUrlToPage:w,shallowCopy:b,pusho:e,pushnew:m,pushnewo:s,arrayIndexOf:x,
            pick:k,makeElement:p,makeElementNS:z,removeChildren:d,miniJSONify:c,Observed:n,Awaited:a})},{"./sha1":31}],46:[function(h,y,r){function m(){this.info=[]}function e(b,c){this.parser=b;this.sink=c}if("undefined"!==typeof h){var s=h("./sourceadapters").registerParserFactory;h=h("./das");var k=h.DASStylesheet,x=h.DASStyle,p=h.DASFeature}var z=/([^;=]+)(=([^;]+))?;?/,d=/##INFO=<([^>]+)>/,c=/([^,=]+)=([^,]+|"[^"]+"),?/;m.prototype.createSession=function(b){return new e(this,b)};e.prototype.parse=function(b){if(0!=
        b.length)if("#"==b[0]){if(1<b.length&&"#"==b[1]&&(b=d.exec(b))){var e=b[1].split(c),a=null,h=null;for(b=0;b<e.length-1;b+=3){var k=e[b+1],m=e[b+2].replace(/"/g,"");"ID"==k?a=m:"Description"==k&&(h=m)}a&&h&&this.parser.info.push({id:a,desc:h})}}else{e=b.split("\t");a=new p;a.segment=e[0];a.id=e[2];a.refAllele=e[3];a.altAlleles=e[4].split(",");a.min=parseInt(e[1]);a.max=a.min+a.refAllele.length-1;e=e[7].split(z);a.info={};for(b=0;b<e.length;b+=4)a.info[e[b+1]]=e[b+3];b=a.altAlleles[0];e=a.refAllele;
        b.length>e.length?(a.type="insertion",0==b.indexOf(e)?(a.insertion=b.substr(e.length),a.min+=e.length,a.max=a.min-1):a.insertion=b):a.type=b.length<e.length?"deletion":"substitution";this.sink(a)}};e.prototype.flush=function(){};m.prototype.getStyleSheet=function(b){var c=new k,a=new x;a.glyph="__INSERTION";a.BUMP="yes";a.LABEL="no";a.FGCOLOR="rgb(50,80,255)";a.BGCOLOR="#888888";a.STROKECOLOR="black";c.pushStyle({type:"insertion"},null,a);a=new x;a.glyph="PLIMSOLL";a.BUMP="yes";a.LABEL="no";a.FGCOLOR=
        "rgb(255, 60, 60)";a.BGCOLOR="#888888";a.STROKECOLOR="black";c.pushStyle({type:"deletion"},null,a);a=new x;a.glyph="PLIMSOLL";a.BUMP="yes";a.LABEL="no";a.FGCOLOR="rgb(50,80,255)";a.BGCOLOR="#888888";a.STROKECOLOR="black";c.pushStyle({type:"default"},null,a);return b(c)};m.prototype.getDefaultFIPs=function(b){var c=this;b(function(a,b){b.add("Ref. allele",a.refAllele);b.add("Alt. alleles",a.altAlleles.join(","));if(a.info)for(var d=0;d<c.info.length;++d){var e=c.info[d],h=a.info[e.id];void 0!==h&&
    b.add(e.desc,h)}})};s("vcf",function(){return new m})},{"./das":10,"./sourceadapters":32}],47:[function(h,y,r){h={CONFIG:5,MAJOR:0,MINOR:12,MICRO:9,PATCH:"",BRANCH:"",toString:function(){var h=""+this.MAJOR+"."+this.MINOR+"."+this.MICRO;this.PATCH&&(h+=this.PATCH);this.BRANCH&&""!=this.BRANCH&&(h=h+"-"+this.BRANCH);return h}};"undefined"!==typeof y&&(y.exports=h)},{}],48:[function(h,y,r){y=h("./promise/promise").Promise;h=h("./promise/polyfill").polyfill;r.Promise=y;r.polyfill=h},{"./promise/polyfill":53,
        "./promise/promise":54}],49:[function(h,y,r){var m=h("./utils").isArray,e=h("./utils").isFunction;r.all=function(h){if(!m(h))throw new TypeError("You must pass an array to all.");return new this(function(k,m){function p(b){return function(a){r[b]=a;0===--d&&k(r)}}var r=[],d=h.length,c;0===d&&k([]);for(var b=0;b<h.length;b++)(c=h[b])&&e(c.then)?c.then(p(b),m):(r[b]=c,0===--d&&k(r))})}},{"./utils":58}],50:[function(h,y,r){(function(h,e){function s(){return function(){h.nextTick(p)}}function k(){var a=
        0,b=new d(p),c=document.createTextNode("");b.observe(c,{characterData:!0});return function(){c.data=a=++a%2}}function y(){return function(){c.setTimeout(p,1)}}function p(){for(var a=0;a<b.length;a++){var c=b[a];(0,c[0])(c[1])}b=[]}var z="undefined"!==typeof window?window:{},d=z.MutationObserver||z.WebKitMutationObserver,c="undefined"!==typeof e?e:void 0===this?window:this,b=[],n;n="undefined"!==typeof h&&"[object process]"==={}.toString.call(h)?s():d?k():y();r.asap=function(a,c){1===b.push([a,c])&&
    n()}}).call(this,h("1YiZ5S"),"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"1YiZ5S":59}],51:[function(h,y,r){r.cast=function(h){return h&&"object"===typeof h&&h.constructor===this?h:new this(function(e){e(h)})}},{}],52:[function(h,y,r){var m={instrument:!1};r.config=m;r.configure=function(e,h){if(2===arguments.length)m[e]=h;else return m[e]}},{}],53:[function(h,y,r){(function(m){var e=h("./promise").Promise,s=h("./utils").isFunction;r.polyfill=function(){var h;h="undefined"!==
        typeof m?m:"undefined"!==typeof window&&window.document?window:self;"Promise"in h&&"cast"in h.Promise&&"resolve"in h.Promise&&"reject"in h.Promise&&"all"in h.Promise&&"race"in h.Promise&&function(){var e;new h.Promise(function(h){e=h});return s(e)}()||(h.Promise=e)}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./promise":54,"./utils":58}],54:[function(h,y,r){function m(a){if(!t(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");
        if(!(this instanceof m))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[];e(a,this)}function e(a,b){function f(a){z(b,a)}function d(a){c(b,a)}try{a(f,d)}catch(e){d(e)}}function s(a,b,f,d){var e=t(f),g,h,k,n;if(e)try{g=f(d),k=!0}catch(m){n=!0,h=m}else g=d,k=!0;p(b,g)||(e&&k?z(b,g):n?c(b,h):a===P?z(b,g):a===D&&c(b,g))}function k(a,b,f,c){a=a._subscribers;var d=a.length;a[d]=b;a[d+P]=f;a[d+
        D]=c}function x(a,b){for(var f,c,d=a._subscribers,g=a._detail,e=0;e<d.length;e+=3)f=d[e],c=d[e+b],s(b,f,c,g);a._subscribers=null}function p(a,b){var f=null,e;try{if(a===b)throw new TypeError("A promises callback cannot return that same promise.");if(u(b)&&(f=b.then,t(f)))return f.call(b,function(f){if(e)return!0;e=!0;b!==f?z(a,f):d(a,f)},function(f){if(e)return!0;e=!0;c(a,f)}),!0}catch(l){if(e)return!0;c(a,l);return!0}return!1}function z(a,b){a===b?d(a,b):p(a,b)||d(a,b)}function d(c,d){c._state===
    G&&(c._state=A,c._detail=d,a.async(b,c))}function c(b,c){b._state===G&&(b._state=A,b._detail=c,a.async(n,b))}function b(a){x(a,a._state=P)}function n(a){x(a,a._state=D)}var a=h("./config").config;h("./config");var u=h("./utils").objectOrFunction,t=h("./utils").isFunction;h("./utils");y=h("./cast").cast;var w=h("./all").all,F=h("./race").race,B=h("./resolve").resolve,Q=h("./reject").reject;h=h("./asap").asap;a.async=h;var G=void 0,A=0,P=1,D=2;m.prototype={constructor:m,_state:void 0,_detail:void 0,
        _subscribers:void 0,then:function(b,c){var f=this,d=new this.constructor(function(){});if(this._state){var e=arguments;a.async(function(){s(f._state,d,e[f._state-1],f._detail)})}else k(this,d,b,c);return d},"catch":function(a){return this.then(null,a)}};m.all=w;m.cast=y;m.race=F;m.resolve=B;m.reject=Q;r.Promise=m},{"./all":49,"./asap":50,"./cast":51,"./config":52,"./race":55,"./reject":56,"./resolve":57,"./utils":58}],55:[function(h,y,r){var m=h("./utils").isArray;r.race=function(e){if(!m(e))throw new TypeError("You must pass an array to race.");
        return new this(function(h,k){for(var m,p=0;p<e.length;p++)(m=e[p])&&"function"===typeof m.then?m.then(h,k):h(m)})}},{"./utils":58}],56:[function(h,y,r){r.reject=function(h){return new this(function(e,s){s(h)})}},{}],57:[function(h,y,r){r.resolve=function(h){return new this(function(e,s){e(h)})}},{}],58:[function(h,y,r){function m(e){return"function"===typeof e}h=Date.now||function(){return(new Date).getTime()};r.objectOrFunction=function(e){return m(e)||"object"===typeof e&&null!==e};r.isFunction=
        m;r.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};r.now=h},{}],59:[function(h,y,r){function m(){}h=y.exports={};h.nextTick=function(){if("undefined"!==typeof window&&window.setImmediate)return function(e){return window.setImmediate(e)};if("undefined"!==typeof window&&window.postMessage&&window.addEventListener){var e=[];window.addEventListener("message",function(h){var k=h.source;k!==window&&null!==k||"process-tick"!==h.data||(h.stopPropagation(),0<e.length&&e.shift()())},
        !0);return function(h){e.push(h);window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}();h.title="browser";h.browser=!0;h.env={};h.argv=[];h.on=m;h.addListener=m;h.once=m;h.off=m;h.removeListener=m;h.removeAllListeners=m;h.emit=m;h.binding=function(e){throw Error("process.binding is not supported");};h.cwd=function(){return"/"};h.chdir=function(e){throw Error("process.chdir is not supported");}},{}],60:[function(h,y,r){function m(){}function e(){this.was=[0]}function s(a,b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         d){this.hufts=new Int32Array(3*c);this.window=new Uint8Array(d);this.end=d;this.checkfn=b;this.mode=w;this.reset(a,null);this.index=this.table=this.left=0;this.blens=null;this.bb=new Int32Array(1);this.tb=new Int32Array(1);this.codes=new k;this.check=this.write=this.read=this.bitb=this.bitk=this.last=0;this.inftree=new x}function k(){}function x(){}function p(a,b,c,d,e){if(0!=e){if(!a)throw"Undef src";if(!c)throw"Undef dest";if(0==b&&e==a.length)c.set(a,d);else if(E)a=a.subarray(b,b+e),c.set(a,d);
    else if(1==a.BYTES_PER_ELEMENT&&100<e)a=new Uint8Array(a.buffer,a.byteOffset+b,e),c.set(a,d);else for(var h=0;h<e;++h)c[d+h]=a[b+h]}}function z(f,c,e,g){f=c?e?new Uint8Array(f,c,e):new Uint8Array(f,c,f.byteLength-c):new Uint8Array(f);e=new m;e.inflateInit(d,!0);e.next_in=f;e.next_in_index=0;e.avail_in=f.length;f=[];for(var h=0;;){var k=new Uint8Array(32E3);e.next_out=k;e.next_out_index=0;e.avail_out=k.length;var t=e.inflate(b);if(t!=n&&t!=a&&t!=u)throw e.msg;if(0!=e.avail_out){var s=new Uint8Array(k.length-
        e.avail_out);p(k,0,s,0,k.length-e.avail_out);k=s}f.push(k);h+=k.length;if(t==a||t==u)break}g&&(g[0]=(c||0)+e.next_in_index);if(1==f.length)return f[0].buffer;c=new Uint8Array(h);for(e=g=0;e<f.length;++e)h=f[e],p(h,0,c,g,h.length),g+=h.length;return c.buffer}var d=15,c=1440,b=0,n=0,a=1,u=-5,t=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],w=0,F=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,
        88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,
        7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,
        57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,
        0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,
        9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,
        0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,
        7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,
        192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],B=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,
        5,24577],Q=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],G=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],A=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];m.prototype.inflateInit=function(a,b){a||(a=d);b&&(b=!1);this.istate=new e;return this.istate.inflateInit(this,b?-a:a)};m.prototype.inflate=
        function(a){return null==this.istate?-2:this.istate.inflate(this,a)};m.prototype.inflateEnd=function(){if(null==this.istate)return-2;var a=istate.inflateEnd(this);this.istate=null;return a};m.prototype.inflateSync=function(){return istate.inflateSync(this)};m.prototype.inflateSetDictionary=function(a,b){return istate.inflateSetDictionary(this,a,b)};e.prototype.inflateReset=function(a){if(null==a||null==a.istate)return-2;a.total_in=a.total_out=0;a.msg=null;a.istate.mode=0!=a.istate.nowrap?7:0;a.istate.blocks.reset(a,
        null);return n};e.prototype.inflateEnd=function(a){null!=this.blocks&&this.blocks.free(a);this.blocks=null;return n};e.prototype.inflateInit=function(a,b){this.blocks=a.msg=null;nowrap=0;0>b&&(b=-b,nowrap=1);if(8>b||15<b)return this.inflateEnd(a),-2;this.wbits=b;a.istate.blocks=new s(a,0!=a.istate.nowrap?null:this,1<<b);this.inflateReset(a);return n};e.prototype.inflate=function(b,c){var d,g;if(null==b||null==b.istate||null==b.next_in)return-2;c=4==c?u:n;for(d=u;;)switch(b.istate.mode){case 0:if(0==
        b.avail_in)return d;d=c;b.avail_in--;b.total_in++;if(8!=((b.istate.method=b.next_in[b.next_in_index++])&15)){b.istate.mode=13;b.msg="unknown compression method";b.istate.marker=5;break}if((b.istate.method>>4)+8>b.istate.wbits){b.istate.mode=13;b.msg="invalid window size";b.istate.marker=5;break}b.istate.mode=1;case 1:if(0==b.avail_in)return d;d=c;b.avail_in--;b.total_in++;g=b.next_in[b.next_in_index++]&255;if(0!=((b.istate.method<<8)+g)%31){b.istate.mode=13;b.msg="incorrect header check";b.istate.marker=
        5;break}if(0==(g&32)){b.istate.mode=7;break}b.istate.mode=2;case 2:if(0==b.avail_in)return d;d=c;b.avail_in--;b.total_in++;b.istate.need=(b.next_in[b.next_in_index++]&255)<<24&4278190080;b.istate.mode=3;case 3:if(0==b.avail_in)return d;d=c;b.avail_in--;b.total_in++;b.istate.need+=(b.next_in[b.next_in_index++]&255)<<16&16711680;b.istate.mode=4;case 4:if(0==b.avail_in)return d;d=c;b.avail_in--;b.total_in++;b.istate.need+=(b.next_in[b.next_in_index++]&255)<<8&65280;b.istate.mode=5;case 5:if(0==b.avail_in)return d;
        b.avail_in--;b.total_in++;b.istate.need+=b.next_in[b.next_in_index++]&255;b.adler=b.istate.need;b.istate.mode=6;return 2;case 6:return b.istate.mode=13,b.msg="need dictionary",b.istate.marker=0,-2;case 7:d=b.istate.blocks.proc(b,d);if(-3==d){b.istate.mode=13;b.istate.marker=0;break}d==n&&(d=c);if(d!=a)return d;d=c;b.istate.blocks.reset(b,b.istate.was);if(0!=b.istate.nowrap){b.istate.mode=12;break}b.istate.mode=8;case 8:if(0==b.avail_in)return d;d=c;b.avail_in--;b.total_in++;b.istate.need=(b.next_in[b.next_in_index++]&
        255)<<24&4278190080;b.istate.mode=9;case 9:if(0==b.avail_in)return d;d=c;b.avail_in--;b.total_in++;b.istate.need+=(b.next_in[b.next_in_index++]&255)<<16&16711680;b.istate.mode=10;case 10:if(0==b.avail_in)return d;d=c;b.avail_in--;b.total_in++;b.istate.need+=(b.next_in[b.next_in_index++]&255)<<8&65280;b.istate.mode=11;case 11:if(0==b.avail_in)return d;d=c;b.avail_in--;b.total_in++;b.istate.need+=b.next_in[b.next_in_index++]&255;if(b.istate.was[0]!=b.istate.need){b.istate.mode=13;b.msg="incorrect data check";
        b.istate.marker=5;break}b.istate.mode=12;case 12:return a;case 13:return-3;default:return-2}};e.prototype.inflateSetDictionary=function(a,b,c){var d=0,e=c;if(null==a||null==a.istate||6!=a.istate.mode)return-2;if(a._adler.adler32(1,b,0,c)!=a.adler)return-3;a.adler=a._adler.adler32(0,null,0,0);e>=1<<a.istate.wbits&&(e=(1<<a.istate.wbits)-1,d=c-e);a.istate.blocks.set_dictionary(b,d,e);a.istate.mode=7;return n};var D=[0,0,255,255];e.prototype.inflateSync=function(a){var b,c,d;if(null==a||null==a.istate)return-2;
        13!=a.istate.mode&&(a.istate.mode=13,a.istate.marker=0);if(0==(b=a.avail_in))return u;c=a.next_in_index;for(d=a.istate.marker;0!=b&&4>d;)a.next_in[c]==D[d]?d++:d=0!=a.next_in[c]?0:4-d,c++,b--;a.total_in+=c-a.next_in_index;a.next_in_index=c;a.avail_in=b;a.istate.marker=d;if(4!=d)return-3;b=a.total_in;c=a.total_out;this.inflateReset(a);a.total_in=b;a.total_out=c;a.istate.mode=7;return n};e.prototype.inflateSyncPoint=function(a){return null==a||null==a.istate||null==a.istate.blocks?-2:a.istate.blocks.sync_point()};
        var O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];s.prototype.reset=function(a,b){b&&(b[0]=this.check);6==this.mode&&this.codes.free(a);this.mode=w;this.read=this.write=this.bitb=this.bitk=0;this.checkfn&&(a.adler=this.check=a._adler.adler32(0,null,0,0))};s.prototype.proc=function(b,c){var d,e,h,k,m,s,r;k=b.next_in_index;m=b.avail_in;e=this.bitb;h=this.bitk;s=this.write;for(r=s<this.read?this.read-s-1:this.end-s;;)switch(this.mode){case w:for(;3>h;){if(0!=m)c=n;else return this.bitb=e,this.bitk=
            h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=k,this.write=s,this.inflate_flush(b,c);m--;e|=(b.next_in[k++]&255)<<h;h+=8}d=e&7;this.last=d&1;switch(d>>>1){case 0:e>>>=3;h-=3;d=h&7;e>>>=d;h-=d;this.mode=1;break;case 1:var u=new Int32Array(1),y=new Int32Array(1),x=[],z=[];d=y;var A=x,D=z;u[0]=9;d[0]=5;A[0]=F;D[0]=B;this.codes.init(u[0],y[0],x[0],0,z[0],0,b);e>>>=3;h-=3;this.mode=6;break;case 2:e>>>=3;h-=3;this.mode=3;break;case 3:return e>>>=3,h-=3,this.mode=13,b.msg="invalid block type",
            c=-3,this.bitb=e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=k,this.write=s,this.inflate_flush(b,c)}break;case 1:for(;32>h;){if(0!=m)c=n;else return this.bitb=e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=k,this.write=s,this.inflate_flush(b,c);m--;e|=(b.next_in[k++]&255)<<h;h+=8}if((~e>>>16&65535)!=(e&65535))return this.mode=13,b.msg="invalid stored block lengths",c=-3,this.bitb=e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=
            k,this.write=s,this.inflate_flush(b,c);this.left=e&65535;e=h=0;this.mode=0!=this.left?2:0!=this.last?7:w;break;case 2:if(0==m)return this.bitb=e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=k,write=s,this.inflate_flush(b,c);if(0==r&&(s==end&&0!=read&&(s=0,r=s<this.read?this.read-s-1:this.end-s),0==r&&(this.write=s,c=this.inflate_flush(b,c),s=this.write,r=s<this.read?this.read-s-1:this.end-s,s==this.end&&0!=this.read&&(s=0,r=s<this.read?this.read-s-1:this.end-s),0==r)))return this.bitb=
            e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=k,this.write=s,this.inflate_flush(b,c);c=n;d=this.left;d>m&&(d=m);d>r&&(d=r);p(b.next_in,k,this.window,s,d);k+=d;m-=d;s+=d;r-=d;if(0!=(this.left-=d))break;this.mode=0!=this.last?7:w;break;case 3:for(;14>h;){if(0!=m)c=n;else return this.bitb=e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=k,this.write=s,this.inflate_flush(b,c);m--;e|=(b.next_in[k++]&255)<<h;h+=8}this.table=d=e&16383;if(29<(d&31)||29<(d>>
            5&31))return this.mode=9,b.msg="too many length or distance symbols",c=-3,this.bitb=e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=k,this.write=s,this.inflate_flush(b,c);d=258+(d&31)+(d>>5&31);if(null==this.blens||this.blens.length<d)this.blens=new Int32Array(d);else for(r=0;r<d;r++)this.blens[r]=0;e>>>=14;h-=14;this.index=0;mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;3>h;){if(0!=m)c=n;else return this.bitb=e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,
            b.next_in_index=k,this.write=s,this.inflate_flush(b,c);m--;e|=(b.next_in[k++]&255)<<h;h+=8}this.blens[O[this.index++]]=e&7;e>>>=3;h-=3}for(;19>this.index;)this.blens[O[this.index++]]=0;this.bb[0]=7;d=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,b);if(d!=n)return c=d,-3==c&&(this.blens=null,this.mode=9),this.bitb=e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=k,write=s,this.inflate_flush(b,c);this.index=0;this.mode=5;case 5:for(;;){d=this.table;if(!(this.index<
            258+(d&31)+(d>>5&31)))break;for(d=this.bb[0];h<d;){if(0!=m)c=n;else return this.bitb=e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=k,this.write=s,this.inflate_flush(b,c);m--;e|=(b.next_in[k++]&255)<<h;h+=8}d=this.hufts[3*(this.tb[0]+(e&t[d]))+1];y=this.hufts[3*(this.tb[0]+(e&t[d]))+2];if(16>y)e>>>=d,h-=d,this.blens[this.index++]=y;else{r=18==y?7:y-14;for(u=18==y?11:3;h<d+r;){if(0!=m)c=n;else return this.bitb=e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=
            k,this.write=s,this.inflate_flush(b,c);m--;e|=(b.next_in[k++]&255)<<h;h+=8}e>>>=d;h-=d;u+=e&t[r];e>>>=r;h-=r;r=this.index;d=this.table;if(r+u>258+(d&31)+(d>>5&31)||16==y&&1>r)return this.blens=null,this.mode=9,b.msg="invalid bit length repeat",c=-3,this.bitb=e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=k,this.write=s,this.inflate_flush(b,c);y=16==y?this.blens[r-1]:0;do this.blens[r++]=y;while(0!=--u);this.index=r}}this.tb[0]=-1;u=new Int32Array(1);y=new Int32Array(1);x=
            new Int32Array(1);z=new Int32Array(1);u[0]=9;y[0]=6;d=this.table;d=this.inftree.inflate_trees_dynamic(257+(d&31),1+(d>>5&31),this.blens,u,y,x,z,this.hufts,b);if(d!=n)return-3==d&&(this.blens=null,this.mode=13),c=d,this.bitb=e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=k,this.write=s,this.inflate_flush(b,c);this.codes.init(u[0],y[0],this.hufts,x[0],this.hufts,z[0],b);this.mode=6;case 6:this.bitb=e;this.bitk=h;b.avail_in=m;b.total_in+=k-b.next_in_index;b.next_in_index=k;
            this.write=s;if((c=this.codes.proc(this,b,c))!=a)return this.inflate_flush(b,c);c=n;this.codes.free(b);k=b.next_in_index;m=b.avail_in;e=this.bitb;h=this.bitk;s=this.write;r=s<this.read?this.read-s-1:this.end-s;if(0==this.last){this.mode=w;break}this.mode=7;case 7:this.write=s;c=this.inflate_flush(b,c);s=this.write;if(this.read!=this.write)return this.bitb=e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=k,this.write=s,this.inflate_flush(b,c);mode=12;case 8:return c=a,this.bitb=
            e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=k,this.write=s,this.inflate_flush(b,c);case 9:return c=-3,this.bitb=e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=k,this.write=s,this.inflate_flush(b,c);default:return c=-2,this.bitb=e,this.bitk=h,b.avail_in=m,b.total_in+=k-b.next_in_index,b.next_in_index=k,this.write=s,this.inflate_flush(b,c)}};s.prototype.free=function(a){this.reset(a,null);this.hufts=this.window=null};s.prototype.set_dictionary=
            function(a,b,c){p(a,b,window,0,c);this.read=this.write=c};s.prototype.sync_point=function(){return 1==this.mode};s.prototype.inflate_flush=function(a,b){var c,d,e;d=a.next_out_index;e=this.read;c=(e<=this.write?this.write:this.end)-e;c>a.avail_out&&(c=a.avail_out);0!=c&&b==u&&(b=n);a.avail_out-=c;a.total_out+=c;null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,e,c));p(this.window,e,a.next_out,d,c);d+=c;e+=c;e==this.end&&(e=0,this.write==this.end&&(this.write=0),c=this.write-
            e,c>a.avail_out&&(c=a.avail_out),0!=c&&b==u&&(b=n),a.avail_out-=c,a.total_out+=c,null!=this.checkfn&&(a.adler=this.check=a._adler.adler32(this.check,this.window,e,c)),p(this.window,e,a.next_out,d,c),d+=c,e+=c);a.next_out_index=d;this.read=e;return b};k.prototype.init=function(a,b,c,d,e,h,k){this.mode=0;this.lbits=a;this.dbits=b;this.ltree=c;this.ltree_index=d;this.dtree=e;this.dtree_index=h;this.tree=null};k.prototype.proc=function(b,c,d){var e,h,k=0,m=0,p=0,s,r,u,p=c.next_in_index;s=c.avail_in;k=
            b.bitb;m=b.bitk;r=b.write;for(u=r<b.read?b.read-r-1:b.end-r;;)switch(this.mode){case 0:if(258<=u&&10<=s&&(b.bitb=k,b.bitk=m,c.avail_in=s,c.total_in+=p-c.next_in_index,c.next_in_index=p,b.write=r,d=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,b,c),p=c.next_in_index,s=c.avail_in,k=b.bitb,m=b.bitk,r=b.write,u=r<b.read?b.read-r-1:b.end-r,d!=n)){this.mode=d==a?7:9;break}this.need=this.lbits;this.tree=this.ltree;this.tree_index=this.ltree_index;this.mode=
            1;case 1:for(e=this.need;m<e;){if(0!=s)d=n;else return b.bitb=k,b.bitk=m,c.avail_in=s,c.total_in+=p-c.next_in_index,c.next_in_index=p,b.write=r,b.inflate_flush(c,d);s--;k|=(c.next_in[p++]&255)<<m;m+=8}e=3*(this.tree_index+(k&t[e]));k>>>=this.tree[e+1];m-=this.tree[e+1];h=this.tree[e];if(0==h){this.lit=this.tree[e+2];this.mode=6;break}if(0!=(h&16)){this.get=h&15;this.len=this.tree[e+2];this.mode=2;break}if(0==(h&64)){this.need=h;this.tree_index=e/3+this.tree[e+2];break}if(0!=(h&32)){this.mode=7;break}this.mode=
            9;c.msg="invalid literal/length code";d=-3;b.bitb=k;b.bitk=m;c.avail_in=s;c.total_in+=p-c.next_in_index;c.next_in_index=p;b.write=r;return b.inflate_flush(c,d);case 2:for(e=this.get;m<e;){if(0!=s)d=n;else return b.bitb=k,b.bitk=m,c.avail_in=s,c.total_in+=p-c.next_in_index,c.next_in_index=p,b.write=r,b.inflate_flush(c,d);s--;k|=(c.next_in[p++]&255)<<m;m+=8}this.len+=k&t[e];k>>=e;m-=e;this.need=this.dbits;this.tree=this.dtree;this.tree_index=this.dtree_index;this.mode=3;case 3:for(e=this.need;m<e;){if(0!=
            s)d=n;else return b.bitb=k,b.bitk=m,c.avail_in=s,c.total_in+=p-c.next_in_index,c.next_in_index=p,b.write=r,b.inflate_flush(c,d);s--;k|=(c.next_in[p++]&255)<<m;m+=8}e=3*(this.tree_index+(k&t[e]));k>>=this.tree[e+1];m-=this.tree[e+1];h=this.tree[e];if(0!=(h&16)){this.get=h&15;this.dist=this.tree[e+2];this.mode=4;break}if(0==(h&64)){this.need=h;this.tree_index=e/3+this.tree[e+2];break}this.mode=9;c.msg="invalid distance code";d=-3;b.bitb=k;b.bitk=m;c.avail_in=s;c.total_in+=p-c.next_in_index;c.next_in_index=
            p;b.write=r;return b.inflate_flush(c,d);case 4:for(e=this.get;m<e;){if(0!=s)d=n;else return b.bitb=k,b.bitk=m,c.avail_in=s,c.total_in+=p-c.next_in_index,c.next_in_index=p,b.write=r,b.inflate_flush(c,d);s--;k|=(c.next_in[p++]&255)<<m;m+=8}this.dist+=k&t[e];k>>=e;m-=e;this.mode=5;case 5:for(e=r-this.dist;0>e;)e+=b.end;for(;0!=this.len;){if(0==u&&(r==b.end&&0!=b.read&&(r=0,u=r<b.read?b.read-r-1:b.end-r),0==u&&(b.write=r,d=b.inflate_flush(c,d),r=b.write,u=r<b.read?b.read-r-1:b.end-r,r==b.end&&0!=b.read&&
            (r=0,u=r<b.read?b.read-r-1:b.end-r),0==u)))return b.bitb=k,b.bitk=m,c.avail_in=s,c.total_in+=p-c.next_in_index,c.next_in_index=p,b.write=r,b.inflate_flush(c,d);b.window[r++]=b.window[e++];u--;e==b.end&&(e=0);this.len--}this.mode=0;break;case 6:if(0==u&&(r==b.end&&0!=b.read&&(r=0,u=r<b.read?b.read-r-1:b.end-r),0==u&&(b.write=r,d=b.inflate_flush(c,d),r=b.write,u=r<b.read?b.read-r-1:b.end-r,r==b.end&&0!=b.read&&(r=0,u=r<b.read?b.read-r-1:b.end-r),0==u)))return b.bitb=k,b.bitk=m,c.avail_in=s,c.total_in+=
            p-c.next_in_index,c.next_in_index=p,b.write=r,b.inflate_flush(c,d);d=n;b.window[r++]=this.lit;u--;this.mode=0;break;case 7:7<m&&(m-=8,s++,p--);b.write=r;d=b.inflate_flush(c,d);r=b.write;if(b.read!=b.write)return b.bitb=k,b.bitk=m,c.avail_in=s,c.total_in+=p-c.next_in_index,c.next_in_index=p,b.write=r,b.inflate_flush(c,d);this.mode=8;case 8:return d=a,b.bitb=k,b.bitk=m,c.avail_in=s,c.total_in+=p-c.next_in_index,c.next_in_index=p,b.write=r,b.inflate_flush(c,d);case 9:return d=-3,b.bitb=k,b.bitk=m,c.avail_in=
            s,c.total_in+=p-c.next_in_index,c.next_in_index=p,b.write=r,b.inflate_flush(c,d);default:return d=-2,b.bitb=k,b.bitk=m,c.avail_in=s,c.total_in+=p-c.next_in_index,c.next_in_index=p,b.write=r,b.inflate_flush(c,d)}};k.prototype.free=function(a){};k.prototype.inflate_fast=function(b,c,d,e,h,k,m,r){var s,u,y,x,w,z,A,B,D,F,E,G;z=r.next_in_index;A=r.avail_in;x=m.bitb;w=m.bitk;B=m.write;D=B<m.read?m.read-B-1:m.end-B;b=t[b];F=t[c];do{for(;20>w;)A--,x|=(r.next_in[z++]&255)<<w,w+=8;s=x&b;u=d;y=e;G=3*(y+s);if(0==
            (c=u[G]))x>>=u[G+1],w-=u[G+1],m.window[B++]=u[G+2],D--;else{do{x>>=u[G+1];w-=u[G+1];if(0!=(c&16)){c&=15;E=u[G+2]+(x&t[c]);x>>=c;for(w-=c;15>w;)A--,x|=(r.next_in[z++]&255)<<w,w+=8;s=x&F;u=h;y=k;G=3*(y+s);c=u[G];do if(x>>=u[G+1],w-=u[G+1],0!=(c&16)){for(c&=15;w<c;)A--,x|=(r.next_in[z++]&255)<<w,w+=8;s=u[G+2]+(x&t[c]);x>>=c;w-=c;D-=E;if(B>=s)s=B-s,m.window[B++]=m.window[s++],m.window[B++]=m.window[s++],E-=2;else{s=B-s;do s+=m.end;while(0>s);c=m.end-s;if(E>c){E-=c;if(0<B-s&&c>B-s){do m.window[B++]=m.window[s++];
        while(0!=--c)}else p(m.window,s,m.window,B,c),B+=c;s=0}}do m.window[B++]=m.window[s++];while(0!=--E);break}else if(0==(c&64))s+=u[G+2],s+=x&t[c],G=3*(y+s),c=u[G];else return r.msg="invalid distance code",E=r.avail_in-A,E=w>>3<E?w>>3:E,A+=E,z-=E,w-=E<<3,m.bitb=x,m.bitk=w,r.avail_in=A,r.total_in+=z-r.next_in_index,r.next_in_index=z,m.write=B,-3;while(1);break}if(0==(c&64)){if(s+=u[G+2],s+=x&t[c],G=3*(y+s),0==(c=u[G])){x>>=u[G+1];w-=u[G+1];m.window[B++]=u[G+2];D--;break}}else{if(0!=(c&32))return E=r.avail_in-
            A,E=w>>3<E?w>>3:E,A+=E,z-=E,w-=E<<3,m.bitb=x,m.bitk=w,r.avail_in=A,r.total_in+=z-r.next_in_index,r.next_in_index=z,m.write=B,a;r.msg="invalid literal/length code";E=r.avail_in-A;E=w>>3<E?w>>3:E;A+=E;z-=E;w-=E<<3;m.bitb=x;m.bitk=w;r.avail_in=A;r.total_in+=z-r.next_in_index;r.next_in_index=z;m.write=B;return-3}}while(1)}}while(258<=D&&10<=A);E=r.avail_in-A;E=w>>3<E?w>>3:E;z-=E;m.bitb=x;m.bitk=w-(E<<3);r.avail_in=A+E;r.total_in+=z-r.next_in_index;r.next_in_index=z;m.write=B;return n};x.prototype.huft_build=
            function(a,b,d,e,h,k,m,r,s,t,y){var x,w,z,A,B,D,E,F,G;D=0;w=d;do this.c[a[b+D]]++,D++,w--;while(0!=w);if(this.c[0]==d)return m[0]=-1,r[0]=0,n;B=r[0];for(z=1;15>=z&&0==this.c[z];z++);A=z;B<z&&(B=z);for(w=15;0!=w&&0==this.c[w];w--);t=w;B>w&&(B=w);r[0]=B;for(r=1<<z;z<w;z++,r<<=1)if(0>(r-=this.c[z]))return-3;if(0>(r-=this.c[w]))return-3;this.c[w]+=r;this.x[1]=z=0;D=1;for(E=2;0!=--w;)this.x[E]=z+=this.c[D],E++,D++;D=w=0;do 0!=(z=a[b+D])&&(this.v[this.x[z]++]=w),D++;while(++w<d);d=this.x[t];D=this.x[0]=
                w=0;b=-1;F=-B;for(G=E=this.u[0]=0;A<=t;A++)for(a=this.c[A];0!=a--;){for(;A>F+B;){b++;F+=B;G=t-F;G=G>B?B:G;if((x=1<<(z=A-F))>a+1&&(x-=a+1,E=A,z<G))for(;++z<G&&!((x<<=1)<=this.c[++E]);)x-=this.c[E];G=1<<z;if(this.hn[0]+G>c)return-3;this.u[b]=E=this.hn[0];this.hn[0]+=G;0!=b?(this.x[b]=w,this.r[0]=z,this.r[1]=B,z=w>>>F-B,this.r[2]=E-this.u[b-1]-z,p(this.r,0,s,3*(this.u[b-1]+z),3)):m[0]=E}this.r[1]=A-F;D>=d?this.r[0]=192:y[D]<e?(this.r[0]=256>this.v[D]?0:96,this.r[2]=this.v[D++]):(this.r[0]=k[this.v[D]-
                e]+16+64,this.r[2]=h[this.v[D++]-e]);x=1<<A-F;for(z=w>>>F;z<G;z+=x)p(this.r,0,s,3*(E+z),3);for(z=1<<A-1;0!=(w&z);z>>>=1)w^=z;w^=z;for(z=(1<<F)-1;(w&z)!=this.x[b];)b--,F-=B,z=(1<<F)-1}return 0!=r&&1!=t?u:n};x.prototype.inflate_trees_bits=function(a,b,c,d,e){this.initWorkArea(19);this.hn[0]=0;a=this.huft_build(a,0,19,19,null,null,c,b,d,this.hn,this.v);if(-3==a)e.msg="oversubscribed dynamic bit lengths tree";else if(a==u||0==b[0])e.msg="incomplete dynamic bit lengths tree",a=-3;return a};x.prototype.inflate_trees_dynamic=
            function(a,b,c,d,e,h,k,m,p){this.initWorkArea(288);this.hn[0]=0;h=this.huft_build(c,0,a,257,Q,G,h,d,m,this.hn,this.v);if(h!=n||0==d[0])return-3==h?p.msg="oversubscribed literal/length tree":-4!=h&&(p.msg="incomplete literal/length tree",h=-3),h;this.initWorkArea(288);h=this.huft_build(c,a,b,0,A,P,k,e,m,this.hn,this.v);return h!=n||0==e[0]&&257<a?(-3==h?p.msg="oversubscribed distance tree":h==u?(p.msg="incomplete distance tree",h=-3):-4!=h&&(p.msg="empty distance tree with lengths",h=-3),h):n};x.prototype.initWorkArea=
            function(a){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(a),this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16));this.v.length<a&&(this.v=new Int32Array(a));for(var b=0;b<a;b++)this.v[b]=0;for(b=0;16>b;b++)this.c[b]=0;for(b=0;3>b;b++)this.r[b]=0;p(this.c,0,this.u,0,15);p(this.c,0,this.x,0,16)};var E="function"===typeof(new Uint8Array(1)).subarray;"undefined"!==typeof y&&(y.exports={inflateBuffer:z,arrayCopy:p})},{}]},{},[15]);